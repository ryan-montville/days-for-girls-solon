import{i as w,a as b,g as E,s as y,p as B,t as T,e as u,f as I,b as r,h as k,T as p,j as C,k as L,l as q,m as R,n as S}from"./app-Cuif3Vld.js";const g=document.getElementById("add-inventory-backdrop"),c=document.getElementById("add-inventory-modal"),m=document.getElementById("previous-entries-card");function h(e){const t=L(e,["entryDate","componentType","quantity","whoDonated"],"entryId",5,"shortDate"),d=t.querySelector("button");return d&&d.addEventListener("click",()=>{const a=q(e,"Are you sure you want to delete this entry?");if(a){const n=a.children[0],i=a.children[1];i&&i.addEventListener("click",async()=>{u("delete-item-backdrop");try{const l=await R(e.entryId);r(`Deleted entry ${S(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),t.remove()}catch(l){r(l,"main-message","error")}}),n&&n.addEventListener("click",()=>{u("delete-item-backdrop")})}}),t}async function v(){let e=[];try{e=await I("donated"),console.log(e)}catch(t){r(t,"main-message","error")}if(e.length===0){let t=document.createElement("p"),d=document.createTextNode("No previous entries");t.appendChild(d),m.appendChild(t)}else{const t=["Date","Component","Quantity","Destination","Delete"],d=document.getElementById("inventory-table-container");d&&d.remove();const a=document.createElement("div");a.setAttribute("id","inventory-table-container"),a.setAttribute("class","table-container");const n=k("previous-entries-table",t);let i=e.reduceRight((l,D)=>{const f=h(D);return l.appendChild(f),l},document.createElement("tbody"));i.setAttribute("id","donatedTableBody"),n.appendChild(i),a.appendChild(n),m.appendChild(a)}const s=document.getElementById("newDonatedEntryButton"),o=document.getElementById("loading");o&&o.remove(),s.classList.contains("hide")&&s.classList.remove("hide"),m.classList.contains("hide")&&m.classList.remove("hide")}async function M(){r("Submitting entry log data...","donate-modal-message","info");const e=new FormData(c);let s={entryId:"",entryDate:p.fromDate(new Date(0)),componentType:"",quantity:0,whoDonated:""};const o=e.get("date");if(o===null||o===""){r("Please enter the date the components were donated","donate-modal-message","error");return}else{const n=new Date(o.toString());s.entryDate=p.fromDate(n)}const t=e.get("componentType");if(t===null||t.toString().trim()===""){r("Please select what component you are donating","donate-modal-message","error");return}else s.componentType=t.toString();const d=e.get("quantity");if(d===null){r("Please enter the quantity of the components being donated","donate-modal-message","error");return}else{const n=+d;if(n<1){r("Please enter a quantity greater that 0","donate-modal-message","error");return}else s.quantity=n}const a=e.get("whoDonated");if(a===null||a.toString().trim()===""){r("Please enter who donated the components","donate-modal-message","error");return}else s.whoDonated=a.toString();try{await C(s),u("add-inventory-backdrop"),c.reset(),r("The inventory has successfully been updated","main-message","check_circle");const n=document.getElementById("donatedTableBody");if(n){const i=h(s);n.prepend(i)}else v()}catch(n){r(n,"donate-modal-message","error")}}w("Inventory").then(async()=>{b.onAuthStateChanged(async o=>{o?await E(o.uid)!=="admin"&&(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"):(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html")}),await v(),c.addEventListener("submit",o=>{o.preventDefault(),M()}),document.getElementById("newDonatedEntryButton").addEventListener("click",()=>{B("componentType"),g.style.display="flex",c.setAttribute("aria-modal","true"),document.getElementById("date").focus(),T(c,g)}),document.getElementById("cancel").addEventListener("click",()=>{u("add-inventory-backdrop")})});
