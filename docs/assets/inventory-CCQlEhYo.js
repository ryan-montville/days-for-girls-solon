import{i as L,z as R,a as N,g as k,r as T,f as g,o as x,A as E,b as m,j as w,q as h,c as S,B as q,l as D,m as $,C as M,D as P}from"./app-BMqO3iXT.js";const u=document.getElementById("generateForm"),H=document.getElementById("maincontent"),f=document.getElementById("current-inventory-card"),b=document.getElementById("manage-inventory-card"),F=document.getElementById("manage-inventory-backdrop"),v=document.getElementById("manage-inventory-modal");function I(r,t){const o=["componentType","quantity"],n="componentId";if(t==="admin"){const d=D(r,o,n,3,"componentItem"),e=d.querySelector("button");return e&&e.addEventListener("click",()=>{const a=$(r,"Are you sure you want to delete this component?");if(a){const i=a.children[0],l=a.children[1];l&&l.addEventListener("click",async()=>{g("delete-item-backdrop");try{await M(r.componentId),m(`Deleted component "${r.componentType}"`,"main-message","delete"),d.remove()}catch(s){m(s,"main-message","error")}}),i&&i.addEventListener("click",()=>{g("delete-item-backdrop")})}}),d}else return D(r,o,n,2,"componentItem")}async function B(r){let t=[];try{t=await E()}catch(n){m(n,"main-message","error");return}if(t.length===0){const n=document.createElement("p"),d=document.createTextNode("There are not items currently in the inventory.");n.appendChild(d),f.appendChild(n)}else{let n=[];r==="admin"?n=["Component","Quantity","Delete"]:n=["Component","Quantity"];const d=document.getElementById("inventory-table-container");d&&d.remove();const e=document.createElement("div");e.setAttribute("id","inventory-table-container"),e.setAttribute("class","table-container");const a=w("current-inventory-table",n),i=t.reduce((l,s)=>{const c=I(s,r);return l.appendChild(c),l},document.createElement("tbody"));i.setAttribute("id","currentInventoryTableBody"),a.appendChild(i),e.appendChild(a),f.appendChild(e)}const o=document.getElementById("loading");o&&o.remove(),f.classList.remove("hide")}async function V(r,t){let o=[];try{o=await P()}catch{m("Error generating report. Please try reloading the page","main-message","error");return}return o.filter(e=>e.entryDate.toDate()>=r&&e.entryDate.toDate()<=t).sort((e,a)=>e.entryDate.toDate().getTime()-a.entryDate.toDate().getTime())}async function z(r){let t=[];try{t=await E()}catch(n){m(n,"main-message","error");return}return t.reduce((n,d)=>{const e={componentType:d.componentType,quantityDonated:0,quantityDistributed:0};return r.filter(i=>i.componentType===e.componentType).forEach(i=>{i.whoDonated?e.quantityDonated+=i.quantity:e.quantityDistributed+=i.quantity}),n.push(e),n},[])}function G(r){const t=document.createElement("div");t.setAttribute("id","summary-table-container"),t.setAttribute("class","table-container");const o=w("summary-table",["Total Donated","Total Distributed"]),n=r.reduce((d,e)=>{let a=document.createElement("tr"),i=document.createElement("td"),l=document.createTextNode(`${e.componentType}: ${e.quantityDonated}`);i.appendChild(l),a.appendChild(i);let s=document.createElement("td"),c=document.createTextNode(`${e.componentType}: ${e.quantityDistributed}`);return s.appendChild(c),a.appendChild(s),d.appendChild(a),d},document.createElement("tbody"));return o.appendChild(n),t.appendChild(o),t}function Q(r){const t=document.createElement("div");t.setAttribute("id","entries-table-container"),t.setAttribute("class","table-container");const o=w("entries-table",["Date","Entry"]),n=r.reduce((d,e)=>{const a=document.createElement("tr"),i=document.createElement("td"),l=document.createTextNode(h(e.entryDate,"shortDate"));i.appendChild(l),a.appendChild(i);const s=document.createElement("td");if(e.whoDonated){const c=document.createTextNode(`${e.quantity} ${e.componentType} donated by ${e.whoDonated}`);s.appendChild(c)}else{const c=document.createTextNode(`${e.quantity} ${e.componentType} distributed to ${e.destination}`);s.appendChild(c)}return a.appendChild(s),d.appendChild(a),d},document.createElement("tbody"));return o.appendChild(n),t.appendChild(o),t}async function U(){m("Generating inventory report...","report-message","info");let r=new FormData(u),t=r.get("startDate"),o=r.get("endDate");if(t&&o){if(new Date(t.toString())>new Date(o.toString())){m("Please make sure the end date is a later date than the start date","report-message","error");return}}else if(!t&&!o){m("Please select start and end dates","report-message","error");return}else if(!t&&o){m("Please select a start date","report-message","error");return}else if(t&&!o){m("Please select an end date","report-message","error");return}if(u.style.display="none",t&&o){let n=new Date(t.toString()),d=new Date(o.toString()),e=document.createElement("article");e.setAttribute("class","card");let a=await V(n,d);if(a){if(a.length===0){let s=document.createElement("h2"),c=document.createTextNode("No results");s.appendChild(c),e.appendChild(s);let p=document.createElement("p"),y=document.createTextNode(`No items where donated or distributed ${h(t.toString(),"shortDate")} to ${h(o.toString(),"shortDate")}`);p.appendChild(y),e.appendChild(p)}else{let s=document.createElement("h2"),c=document.createTextNode(`${h(t.toString(),"shortDate")} to ${h(o.toString(),"shortDate")} Report`);s.appendChild(c),e.appendChild(s);let p=await z(a);if(p){const y=G(p);e.appendChild(y);const C=Q(a);e.appendChild(C)}else return}const i=document.createElement("div");i.setAttribute("class","form-row");const l=T("Generate New Report","button","newReport","primary fulll");l.addEventListener("click",()=>{e.remove(),u.style.display="block"}),i.appendChild(l),e.appendChild(i),S(),H.appendChild(e),e.scrollIntoView({behavior:"smooth"})}}else return}async function j(r){const t={componentId:"",componentType:"",quantity:0},o=r.get("nameInput");if(o===null||o.toString().trim()===""){m("Please enter the name of the new component type","manage-inventory-message","error");return}else{t.componentType=o.toString().trim();try{const n=await q(t);if(g("manage-inventory-backdrop"),n){t.componentId=n,m(`Added '${t.componentType}' to inventory`,"main-message","check_circle"),t.componentId=n;const d=document.getElementById("currentInventoryTableBody");if(d){const e=I(t,"admin");d.appendChild(e)}else B("admin")}else m("Failed to add new component. Please try again.","main-message","error")}catch(n){m(n,"main-message","error")}}}async function K(r){let t=null;if(r){if(t=await k(r.uid),t==="admin"){u.classList.contains("hide")&&u.classList.remove("hide");const o=document.getElementById("inventory-log-links");o.classList.contains("hide")&&o.classList.remove("hide"),b.classList.contains("hide")&&b.classList.remove("hide")}}else b.classList.contains("hide")||b.classList.add("hide"),u.classList.contains("hide")||u.classList.add("hide");B(t),t==="admin"&&(u.addEventListener("submit",n=>{n.preventDefault(),U()}),document.getElementById("add-new-type").addEventListener("click",()=>{v.innerHTML="";const n=document.createElement("form"),d=document.createElement("h2"),e=document.createTextNode("Add a New Component Type");d.appendChild(e),n.appendChild(d);const a=document.createElement("section");a.setAttribute("class","form-row");const i=document.createElement("label");i.setAttribute("for","nameInput");const l=document.createTextNode("Name of new component type:");i.appendChild(l),a.appendChild(i);const s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("id","nameInput"),s.setAttribute("name","nameInput"),a.appendChild(s),n.appendChild(a);const c=document.createElement("section");c.setAttribute("class","button-row");const p=T("Cancel","button","cancelButton","secondary");p.addEventListener("click",()=>{g("manage-inventory-backdrop")}),c.appendChild(p);const y=T("Submit","submt","submitButton","primary");c.appendChild(y),n.appendChild(c),n.addEventListener("submit",C=>{C.preventDefault();const A=new FormData(n);j(A)}),v.appendChild(n),x(F,v,"nameInput")}))}L("Inventory","Inventory").then(async()=>{await R(),N.onAuthStateChanged(async r=>{await K(r)})});
