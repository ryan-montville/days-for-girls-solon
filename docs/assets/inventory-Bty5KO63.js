import{i as L,x as N,m as R,c as w,n as T,d as b,t as x,y as E,a as l,e as D,l as h,z as k,h as S,j as $,A as q,B as P}from"./app-p2LSsebp.js";const m=document.getElementById("generateForm"),F=document.getElementById("maincontent"),f=document.getElementById("current-inventory-card"),g=document.getElementById("manage-inventory-card"),v=document.getElementById("manage-inventory-backdrop"),C=document.getElementById("manage-inventory-modal");function I(r){const o=S(r,["componentType","quantity"],"componentId",3,"componentItem"),n=o.querySelector("button");return n&&n.addEventListener("click",()=>{const e=$(r,"Are you sure you want to delete this component?");if(e){const s=e.children[0],d=e.children[1];d&&d.addEventListener("click",async()=>{const i=await q(r.componentId);b("delete-item-backdrop"),i?(l(`Deleted component "${r.componentType}"`,"main-message","delete"),o.remove()):l("Could not delete component. Please try again","main-message","error")}),s&&s.addEventListener("click",()=>{b("delete-item-backdrop")})}}),o}async function B(){let r=[];try{r=await E()}catch{l("Error loading inventory. Please try reloading the page.","main-message","error")}if(r.length===0){const a=document.createElement("p"),o=document.createTextNode("There are not items currently in the inventory.");a.appendChild(o),f.appendChild(a)}else{const o=D("current-inventory-table",["Component","Quantity","Delete"]),n=r.reduce((e,s)=>{const d=I(s);return e.appendChild(d),e},document.createElement("tbody"));n.setAttribute("id","currentInventoryTableBody"),o.appendChild(n),f.appendChild(o)}const t=document.getElementById("loading");t&&t.remove(),f.classList.remove("hide")}async function H(r,t){let a=[];try{a=await P()}catch{l("Error generating report. Please try reloading the page","main-message","error")}return a.filter(e=>e.entryDate.toDate()>=r&&e.entryDate.toDate()<=t).sort((e,s)=>e.entryDate.toDate().getTime()-s.entryDate.toDate().getTime())}async function M(r){return(await E()).reduce((o,n)=>{const e={componentType:n.componentType,quantityDonated:0,quantityDistributed:0};return r.filter(d=>d.componentType===e.componentType).forEach(d=>{d.whoDonated?e.quantityDonated+=d.quantity:e.quantityDistributed+=d.quantity}),o.push(e),o},[])}function z(r){const t=D("summary-table",["Total Donated","Total Distributed"]),a=r.reduce((o,n)=>{let e=document.createElement("tr"),s=document.createElement("td"),d=document.createTextNode(`${n.componentType}: ${n.quantityDonated}`);s.appendChild(d),e.appendChild(s);let i=document.createElement("td"),c=document.createTextNode(`${n.componentType}: ${n.quantityDistributed}`);return i.appendChild(c),e.appendChild(i),o.appendChild(e),o},document.createElement("tbody"));return t.appendChild(a),t}function K(r){const t=D("entries-table",["Date","Entry"]),a=r.reduce((o,n)=>{const e=document.createElement("tr"),s=document.createElement("td"),d=document.createTextNode(h(n.entryDate,"shortDate"));s.appendChild(d),e.appendChild(s);const i=document.createElement("td");if(n.whoDonated){const c=document.createTextNode(`${n.quantity} ${n.componentType} donated by ${n.whoDonated}`);i.appendChild(c)}else{const c=document.createTextNode(`${n.quantity} ${n.componentType} distributed to ${n.destination}`);i.appendChild(c)}return e.appendChild(i),o.appendChild(e),o},document.createElement("tbody"));return t.appendChild(a),t}async function V(){let r=new FormData(m),t=r.get("startDate"),a=r.get("endDate");if(t&&a){if(new Date(t.toString())>new Date(a.toString())){l("Please make sure the end date is a later date than the start date","main-message","error");return}}else if(!t&&!a){l("Please select start and end dates","main-message","error");return}else if(!t&&a){l("Please select a start date","main-message","error");return}else if(t&&!a){l("Please select an end date","main-message","error");return}if(m.style.display="none",t&&a){let o=new Date(t.toString()),n=new Date(a.toString()),e=document.createElement("article");e.setAttribute("class","card");let s=await H(o,n);if(s.length===0){let c=document.createElement("h2"),u=document.createTextNode("No results");c.appendChild(u),e.appendChild(c);let p=document.createElement("p"),y=document.createTextNode(`No items where donated or distributed ${h(t.toString(),"shortDate")} to ${h(a.toString(),"shortDate")}`);p.appendChild(y),e.appendChild(p)}else{let c=document.createElement("h2"),u=document.createTextNode(`${h(t.toString(),"shortDate")} to ${h(a.toString(),"shortDate")} Report`);c.appendChild(u),e.appendChild(c);let p=await M(s);const y=z(p);e.appendChild(y);const A=K(s);e.appendChild(A)}const d=document.createElement("div");d.setAttribute("class","form-row");const i=T("Generate New Report","button","newReport","primary fulll");i.addEventListener("click",()=>{e.remove(),m.style.display="block"}),d.appendChild(i),e.appendChild(d),F.appendChild(e)}}async function j(r){const t={componentId:"",componentType:"",quantity:0},a=r.get("nameInput");if(a===null||a.toString().trim()===""){l("Please enter the name of the new component type","manage-inventory-message","error");return}else{t.componentType=a.toString().trim();try{const o=await k(t);if(b("manage-inventory-backdrop"),o){l(`Added '${t.componentType}' to inventory`,"main-message","check_circle"),t.componentId=o;const n=document.getElementById("currentInventoryTableBody");if(n){const e=I(t);n.appendChild(e)}else B()}else l("Failed to add new component. Please try again.","main-message","error")}catch{l("Failed to add new component. Please try again.","main-message","error")}}}function G(r){r?(g.classList.contains("hide")&&g.classList.remove("hide"),m.classList.contains("hide")&&m.classList.remove("hide")):(g.classList.contains("hide")||g.classList.add("hide"),m.classList.contains("hide")||m.classList.add("hide"))}L("Inventory").then(async()=>{await N(),B(),R.onAuthStateChanged(t=>{G(t)}),m.addEventListener("submit",t=>{t.preventDefault(),w(),V()}),document.getElementById("add-new-type").addEventListener("click",()=>{C.innerHTML="";const t=document.createElement("form"),a=document.createElement("h2"),o=document.createTextNode("Add a New Component Type");a.appendChild(o),t.appendChild(a);const n=document.createElement("section");n.setAttribute("class","form-row");const e=document.createElement("label");e.setAttribute("for","nameInput");const s=document.createTextNode("Name of new component type:");e.appendChild(s),n.appendChild(e);const d=document.createElement("input");d.setAttribute("type","text"),d.setAttribute("id","nameInput"),d.setAttribute("name","nameInput"),n.appendChild(d),t.appendChild(n);const i=document.createElement("section");i.setAttribute("class","form-row");const c=T("Cancel","button","cancelButton","secondary");c.addEventListener("click",()=>{b("manage-inventory-backdrop")}),i.appendChild(c);const u=T("Submit","submt","submitButton","primary");i.appendChild(u),t.appendChild(i),t.addEventListener("submit",p=>{w(),p.preventDefault();const y=new FormData(t);j(y)}),C.appendChild(t),v.style.display="flex",C.classList.add("opening"),C.setAttribute("aria-modal","true"),d.focus(),x(t,v)})});
