import{i as h,c as f,d as u,p as v,t as D,g as B,a as s,e as E,T as y,f as T,h as I,j as w,k,l as L}from"./app-p2LSsebp.js";const l=document.getElementById("distribute-inventory-modal"),p=document.getElementById("distribute-inventory-backdrop"),c=document.getElementById("previous-entries-card");function g(e){const o=I(e,["entryDate","componentType","quantity","destination"],"entryId",5,"shortDate"),a=o.querySelector("button");return a&&a.addEventListener("click",()=>{const i=w(e,"Are you sure you want to delete this entry?");if(i){const t=i.children[0],d=i.children[1];d&&d.addEventListener("click",async()=>{const m=await k(e.entryId);u("delete-item-backdrop"),m?(s(`Deleted entry ${L(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),o.remove()):s("Failed to delete log entry. Please try reloading the page.","main-message","error")}),t&&t.addEventListener("click",()=>{u("delete-item-backdrop")})}}),o}async function b(){let e=[];try{e=await B("distributed")}catch{s("Error loading log entries. Please try reloading the page","main-message","error")}if(e.length===0){let o=document.createElement("p"),a=document.createTextNode("No previous entries");o.appendChild(a),c.appendChild(o)}else{const a=E("previous-entries-table",["Date","Component","Quantity","Destination","Delete"]);let i=e.reduceRight((t,d)=>{const m=g(d);return t.appendChild(m),t},document.createElement("tbody"));i.setAttribute("id","distributedTableBody"),a.appendChild(i),c.appendChild(a)}const n=document.getElementById("newDistributedEntryButton"),r=document.getElementById("loading");r&&r.remove(),n.classList.contains("hide")&&n.classList.remove("hide"),c.classList.contains("hide")&&c.classList.remove("hide")}async function C(){const e=new FormData(l);let n={entryId:"",entryDate:y.fromDate(new Date(0)),componentType:"",quantity:0,destination:""};const r=e.get("date");if(r===null||r===""){s("Please enter the date the components are leaving","distribute-modal-message","error");return}else{const t=new Date(r.toString());n.entryDate=y.fromDate(t)}const o=e.get("componentType");if(o===null||o.toString().trim()===""){s("Please select what component you are distributing","distribute-modal-message","error");return}else n.componentType=o.toString();const a=e.get("quantity");if(a===null){s("Please enter the quantity of the components being distributed","distribute-modal-message","error");return}else{const t=+a;if(t<1){s("Please enter a quantity greater that 0","distribute-modal-message","error");return}else n.quantity=t}const i=e.get("destination");if(i===null||i.toString().trim()===""){s("Please enter the destination","distribute-modal-message","error");return}else n.destination=i.toString();try{await T(n),u("distribute-inventory-backdrop"),s("The inventory has successfully been updated","main-message","check_circle"),l.reset();const t=document.getElementById("distributedTableBody");if(t){const d=g(n);t.prepend(d)}else b()}catch(t){s(t,"distribute-modal-message","error")}}h("Inventory").then(async()=>{await b(),l.addEventListener("submit",n=>{n.preventDefault(),f(),C(),document.getElementById("cancel").addEventListener("click",()=>u("distribute-inventory-backdrop"))}),document.getElementById("newDistributedEntryButton").addEventListener("click",()=>{console.log("button clicked"),v("componentType"),p.style.display="flex",l.setAttribute("aria-modal","true"),document.getElementById("date").focus(),D(l,p)})});
