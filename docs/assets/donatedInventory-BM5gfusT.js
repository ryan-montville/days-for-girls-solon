import{i as w,a as f,g as b,s as u,p as E,o as B,e as m,f as T,b as d,h as I,T as p,j as k,k as C,l as L,m as q,n as R}from"./app-DS-qbcwq.js";const S=document.getElementById("add-inventory-backdrop"),y=document.getElementById("add-inventory-modal"),c=document.getElementById("previous-entries-card");function g(e){const t=C(e,["entryDate","componentType","quantity","whoDonated"],"entryId",5,"shortDate"),s=t.querySelector("button");return s&&s.addEventListener("click",()=>{const r=L(e,"Are you sure you want to delete this entry?");if(r){const n=r.children[0],i=r.children[1];i&&i.addEventListener("click",async()=>{m("delete-item-backdrop");try{const l=await q(e.entryId);d(`Deleted entry ${R(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),t.remove()}catch(l){d(l,"main-message","error")}}),n&&n.addEventListener("click",()=>{m("delete-item-backdrop")})}}),t}async function h(){let e=[];try{e=await T("donated")}catch(t){d(t,"main-message","error")}if(e.length===0){let t=document.createElement("p"),s=document.createTextNode("No previous entries");t.appendChild(s),c.appendChild(t)}else{const t=["Date","Component","Quantity","Who Donated","Delete"],s=document.getElementById("inventory-table-container");s&&s.remove();const r=document.createElement("div");r.setAttribute("id","inventory-table-container"),r.setAttribute("class","table-container");const n=I("previous-entries-table",t);let i=e.reduceRight((l,v)=>{const D=g(v);return l.appendChild(D),l},document.createElement("tbody"));i.setAttribute("id","donatedTableBody"),n.appendChild(i),r.appendChild(n),c.appendChild(r)}const o=document.getElementById("newDonatedEntryButton"),a=document.getElementById("loading");a&&a.remove(),o.classList.contains("hide")&&o.classList.remove("hide"),c.classList.contains("hide")&&c.classList.remove("hide")}async function M(){d("Submitting entry log data...","donate-modal-message","info");const e=new FormData(y);let o={entryId:"",entryDate:p.fromDate(new Date(0)),componentType:"",quantity:0,whoDonated:""};const a=e.get("date");if(a===null||a===""){d("Please enter the date the components were donated","donate-modal-message","error");return}else{const n=new Date(a.toString());o.entryDate=p.fromDate(n)}const t=e.get("componentType");if(t===null||t.toString().trim()===""){d("Please select what component you are donating","donate-modal-message","error");return}else o.componentType=t.toString();const s=e.get("quantity");if(s===null){d("Please enter the quantity of the components being donated","donate-modal-message","error");return}else{const n=+s;if(n<1){d("Please enter a quantity greater that 0","donate-modal-message","error");return}else o.quantity=n}const r=e.get("whoDonated");if(r===null||r.toString().trim()===""){d("Please enter who donated the components","donate-modal-message","error");return}else o.whoDonated=r.toString();try{let n=await k(o);n&&(o.entryId=n),m("add-inventory-backdrop"),y.reset(),d("The inventory has successfully been updated","main-message","check_circle");const i=document.getElementById("donatedTableBody");if(i){const l=g(o);i.prepend(l)}else h()}catch(n){d(n,"donate-modal-message","error")}}w("Inventory","Donated Inventory").then(async()=>{f.onAuthStateChanged(async a=>{a?await b(a.uid)!=="admin"&&(u("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"):(u("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html")}),await h(),y.addEventListener("submit",a=>{a.preventDefault(),M()}),document.getElementById("newDonatedEntryButton").addEventListener("click",()=>{E("componentType"),B(S,y,"date")}),document.getElementById("cancel").addEventListener("click",()=>{m("add-inventory-backdrop")})});
