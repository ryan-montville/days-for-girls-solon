import{i as N,s as y,a as d,k as L,b as p,m as k,h as S,w as A,t as P,T as C,j as x}from"./app-Bv0Cmu6z.js";import{g as H,d as M,e as R,f as U,u as F,h as $}from"./firebaseService-CZrulipo.js";const h=document.getElementById("sign-up-entires-card"),I=document.getElementById("deleteEventCard"),V=document.getElementById("delete-button"),B=document.getElementById("edit-event-backdrop"),v=document.getElementById("edit-event-modal"),c=document.getElementById("event-info"),q=new URLSearchParams(window.location.search),w=q.get("id"),u=w||"";let s=null;function T(e){c.innerHTML="";const t=document.createElement("h2"),r=document.createTextNode(e.eventTitle);t.appendChild(r),c.appendChild(t);const a=document.createElement("h3"),n=document.createTextNode(`${k(e.eventDate,"longDate")} ${e.eventTime}`);a.appendChild(n),c.appendChild(a);const o=document.createElement("h3"),i=document.createTextNode(e.eventLocation);o.appendChild(i),c.appendChild(o);const l=document.createElement("h3"),m=document.createTextNode(`Number Attending: ${e.numberAttending}`);l.appendChild(m),c.appendChild(l);const g=document.createElement("p"),f=document.createTextNode(e.eventDescription);g.appendChild(f),c.appendChild(g);const E=document.createElement("section");E.setAttribute("class","form-row");const D=A("Edit Event Info","button","editButton","primary","edit_calendar");D.addEventListener("click",()=>{B.style.display="flex",v.setAttribute("aria-modal","true"),document.getElementById("eventTitle").focus(),P(v,B)}),E.appendChild(D),c.appendChild(E)}function b(e){let t=document.getElementById("eventTitle");t.value=e.eventTitle;let r=document.getElementById("eventDate"),a=e.eventDate.toDate();r.value=a.toISOString().split("T")[0];let n=document.getElementById("eventLocation");n.value=e.eventLocation;let o=document.getElementById("eventTime");o.value=e.eventTime;let i=document.getElementById("eventDescription");i.value=e.eventDescription}async function K(){if(!s){d("Cannot update event. Please try reloading the page.","main-message","error");return}let e=new FormData(v),t={eventId:u,eventTitle:"",eventDate:C.fromDate(new Date(0)),eventLocation:"",eventTime:"",eventDescription:"",numberAttending:0},r=e.get("eventTitle");if(r===null||r.toString().trim()===""){d("Please enter the title of the event","edit-event-modal-message","error");return}else t.eventTitle=r.toString();const a=e.get("eventDate");if(a===null||a===""){d("Please enter the date of the event","edit-event-modal-message","error");return}else{const m=new Date(a.toString());t.eventDate=C.fromDate(m)}let n=e.get("eventLocation");if(n===null||n.toString().trim()===""){d("Please enter the location of the event","edit-event-modal-message","error");return}else t.eventLocation=n.toString();let o=e.get("eventTime");if(o===null||o.toString().trim()===""){d("Please enter the time of the event","edit-event-modal-message","error");return}else t.eventTime=o.toString();let i=e.get("eventDescription");if(i===null||i.toString().trim()===""){d("Please enter a description for the event","edit-event-modal-message","error");return}else t.eventDescription=i.toString();const l=await U(u,t);p("edit-event-backdrop"),l?(s=t,T(t),d("The event was successfully updated","main-message","check_circle")):d("Unable to update the event. Please reload the page and try again.","main-message","error")}function _(e,t){const n=x(e,["fullName","email","comments"],"entryId"),o=n.querySelector("button");return o&&o.addEventListener("click",()=>{const i=L(e,"Are you sure you want to delete this entry?");if(i){const l=i.children[0],m=i.children[1];m&&m.addEventListener("click",async()=>{const g=await F(e.eventId,!1),f=await $(e.entryId);p("delete-item-backdrop"),f&&g?(d(`Deleted entry from ${e.fullName}`,"main-message","delete"),n.remove(),t.numberAttending-=1,T(t)):d("Error deleting entry. Please reload the page and try again","main-message","error")}),l&&l.addEventListener("click",()=>{p("delete-item-backdrop")})}}),n}function z(e,t){if(t.length===0){let r=document.createElement("p"),a=document.createTextNode(`No one has signed up for ${e.eventTitle} yet`);r.appendChild(a),h.appendChild(r)}else{const a=S("sign-up-table",["Name","Email","Comments","Delete"]);let n=t.reduce((o,i)=>{const l=_(i,e);return o.appendChild(l),o},document.createElement("tbody"));a.appendChild(n),h.appendChild(a)}}async function G(){if(u===""){y("Error loading event. Please try again.","main-message","error"),window.location.href="events.html";return}try{s=await H(u)}catch{y("Error loading event. Please try again.","main-message","error"),window.location.href="events.html";return}if(s===null){d("Could not find event","main-message","error"),v.remove(),h.remove(),I.remove();let e=document.createElement("section");e.setAttribute("class","card");let t=document.createElement("h2"),r=document.createTextNode("Could not find event");t.appendChild(r),e.appendChild(t);let a=document.createElement("p"),n=document.createTextNode("The event you were looking for does not exist or the url is incorrect. Please go back to the events page and try again.");a.appendChild(n),e.appendChild(a);let o=document.querySelector("main");o&&o.appendChild(e)}else{b(s);const e=await M(u);z(s,e),T(s);const t=document.getElementById("loading");t&&t.remove(),c.classList.remove("hide"),h.classList.remove("hide"),I.classList.remove("hide"),V.addEventListener("click",()=>{const n=L(s,"Are you sure you want to delete this event?");if(n){const o=n.children[0],i=n.children[1];i&&i.addEventListener("click",async()=>{const l=await R(u);p("delete-item-backdrop"),l?(y(`Deleted event ${s.eventTitle} ${k(s.eventDate,"shortDate")}`,"main-message","delete"),window.location.href="events.html"):d("Unable to delete event. Please reload the page and try agian.","main-message","error")}),o&&o.addEventListener("click",()=>{p("delete-item-backdrop")})}}),document.getElementById("reset").addEventListener("click",n=>{n.preventDefault(),b(s)}),document.getElementById("cancel").addEventListener("click",()=>{p("edit-event-backdrop")}),v.addEventListener("submit",n=>{n.preventDefault(),K()})}}N("Upcoming Events").then(()=>{G()});
