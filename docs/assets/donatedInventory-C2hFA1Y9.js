import{i as w,a as f,g as v,s as y,p as b,t as E,e as u,f as B,b as s,h as T,T as p,j as I,k,l as L,m as C,n as q}from"./app-CRD0qBgP.js";const g=document.getElementById("add-inventory-backdrop"),l=document.getElementById("add-inventory-modal"),m=document.getElementById("previous-entries-card");function h(e){const n=k(e,["entryDate","componentType","quantity","whoDonated"],"entryId",5,"shortDate"),r=n.querySelector("button");return r&&r.addEventListener("click",()=>{const d=L(e,"Are you sure you want to delete this entry?");if(d){const t=d.children[0],i=d.children[1];i&&i.addEventListener("click",async()=>{u("delete-item-backdrop");try{const c=await C(e.entryId);s(`Deleted entry ${q(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),n.remove()}catch(c){s(c,"main-message","error")}}),t&&t.addEventListener("click",()=>{u("delete-item-backdrop")})}}),n}async function D(){let e=[];try{e=await B("donated"),console.log(e)}catch(n){s(n,"main-message","error")}if(e.length===0){let n=document.createElement("p"),r=document.createTextNode("No previous entries");n.appendChild(r),m.appendChild(n)}else{const r=T("previous-entries-table",["Date","Component","Quantity","Destination","Delete"]);let d=e.reduceRight((t,i)=>{const c=h(i);return t.appendChild(c),t},document.createElement("tbody"));d.setAttribute("id","donatedTableBody"),r.appendChild(d),m.appendChild(r)}const a=document.getElementById("newDonatedEntryButton"),o=document.getElementById("loading");o&&o.remove(),a.classList.contains("hide")&&a.classList.remove("hide"),m.classList.contains("hide")&&m.classList.remove("hide")}async function R(){s("Submitting entry log data...","donate-modal-message","info");const e=new FormData(l);let a={entryId:"",entryDate:p.fromDate(new Date(0)),componentType:"",quantity:0,whoDonated:""};const o=e.get("date");if(o===null||o===""){s("Please enter the date the components were donated","donate-modal-message","error");return}else{const t=new Date(o.toString());a.entryDate=p.fromDate(t)}const n=e.get("componentType");if(n===null||n.toString().trim()===""){s("Please select what component you are donating","donate-modal-message","error");return}else a.componentType=n.toString();const r=e.get("quantity");if(r===null){s("Please enter the quantity of the components being donated","donate-modal-message","error");return}else{const t=+r;if(t<1){s("Please enter a quantity greater that 0","donate-modal-message","error");return}else a.quantity=t}const d=e.get("whoDonated");if(d===null||d.toString().trim()===""){s("Please enter who donated the components","donate-modal-message","error");return}else a.whoDonated=d.toString();try{await I(a),u("add-inventory-backdrop"),l.reset(),s("The inventory has successfully been updated","main-message","check_circle");const t=document.getElementById("donatedTableBody");if(t){const i=h(a);t.prepend(i)}else D()}catch(t){s(t,"donate-modal-message","error")}}w("Inventory").then(async()=>{f.onAuthStateChanged(async o=>{o?await v(o.uid)!=="admin"&&(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"):(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html")}),await D(),l.addEventListener("submit",o=>{o.preventDefault(),R()}),document.getElementById("newDonatedEntryButton").addEventListener("click",()=>{b("componentType"),g.style.display="flex",l.setAttribute("aria-modal","true"),document.getElementById("date").focus(),E(l,g)}),document.getElementById("cancel").addEventListener("click",()=>{u("add-inventory-backdrop")})});
