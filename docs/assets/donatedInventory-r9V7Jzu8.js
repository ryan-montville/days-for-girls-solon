import{i as D,c as f,p as v,t as w,d as u,g as E,a as s,e as b,T as y,f as B,h as T,j as I,k,l as L}from"./app-p2LSsebp.js";const p=document.getElementById("add-inventory-backdrop"),l=document.getElementById("add-inventory-modal"),c=document.getElementById("previous-entries-card");function g(e){const n=T(e,["entryDate","componentType","quantity","whoDonated"],"entryId",5,"shortDate"),d=n.querySelector("button");return d&&d.addEventListener("click",()=>{const r=I(e,"Are you sure you want to delete this entry?");if(r){const t=r.children[0],i=r.children[1];i&&i.addEventListener("click",async()=>{const m=await k(e.entryId);u("delete-item-backdrop"),m?(s(`Deleted entry ${L(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),n.remove()):s("Failed to delete log entry. Please try reloading the page.","main-message","error")}),t&&t.addEventListener("click",()=>{u("delete-item-backdrop")})}}),n}async function h(){let e=[];try{e=await E("donated")}catch{s("Error loading log entries. Please try reloading the page","main-message","error")}if(e.length===0){let n=document.createElement("p"),d=document.createTextNode("No previous entries");n.appendChild(d),c.appendChild(n)}else{const d=b("previous-entries-table",["Date","Component","Quantity","Destination","Delete"]);let r=e.reduceRight((t,i)=>{const m=g(i);return t.appendChild(m),t},document.createElement("tbody"));r.setAttribute("id","donatedTableBody"),d.appendChild(r),c.appendChild(d)}const o=document.getElementById("newDonatedEntryButton"),a=document.getElementById("loading");a&&a.remove(),o.classList.contains("hide")&&o.classList.remove("hide"),c.classList.contains("hide")&&c.classList.remove("hide")}async function C(){const e=new FormData(l);let o={entryId:"",entryDate:y.fromDate(new Date(0)),componentType:"",quantity:0,whoDonated:""};const a=e.get("date");if(a===null||a===""){s("Please enter the date the components were donated","donate-modal-message","error");return}else{const t=new Date(a.toString());o.entryDate=y.fromDate(t)}const n=e.get("componentType");if(n===null||n.toString().trim()===""){s("Please select what component you are donating","donate-modal-message","error");return}else o.componentType=n.toString();const d=e.get("quantity");if(d===null){s("Please enter the quantity of the components being donated","donate-modal-message","error");return}else{const t=+d;if(t<1){s("Please enter a quantity greater that 0","donate-modal-message","error");return}else o.quantity=t}const r=e.get("whoDonated");if(r===null||r.toString().trim()===""){s("Please enter who donated the components","donate-modal-message","error");return}else o.whoDonated=r.toString();try{await B(o),u("add-inventory-backdrop"),l.reset(),s("The inventory has successfully been updated","main-message","check_circle");const t=document.getElementById("donatedTableBody");if(t){const i=g(o);t.prepend(i)}else h()}catch(t){s(t,"donate-modal-message","error")}}D("Inventory").then(async()=>{await h(),l.addEventListener("submit",a=>{a.preventDefault(),f(),C()}),document.getElementById("newDonatedEntryButton").addEventListener("click",()=>{v("componentType"),p.style.display="flex",l.setAttribute("aria-modal","true"),document.getElementById("date").focus(),w(l,p)}),document.getElementById("cancel").addEventListener("click",()=>{u("add-inventory-backdrop")})});
