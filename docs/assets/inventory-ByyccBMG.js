import{i as O,m as c,e as S,f,j as N,a as b,k as x,h as D,c as Q,l as w,o as H,n as q,p as A,q as V}from"./app-CWWncusU.js";import{h as z,i as M,j as P,k as K,l as U,m as W,n as J,o as X}from"./indexedService-CyxUA599.js";import{n as Y}from"./navigate-CzB6ZO3P.js";const I=document.getElementById("maincontent"),F=document.getElementById("manage-inventory-backdrop");let C=document.getElementById("manage-inventory-modal");O("Inventory","Inventory").then(async()=>{const n=document.getElementById("current-inventory-card");n&&n.remove();const t=c("article","current-inventory-card","card",null),o=c("div","loading","button-row left",null),i=c("div","loader","loader",null);o.appendChild(i);const d=c("h2","loading",null,"Loading Inventory");if(o.appendChild(d),t.appendChild(o),I.appendChild(t),S()){const e=c("article","manage-storage-locations-card","card hide",null);I.appendChild(e);const l=c("article","manage-inventory-card","card",null),a=c("h2",null,null,"Manage Inventory");l.appendChild(a);const r=c("section",null,"button-row",null),s=f("Add / Move / Distribute Items","button","inventory-log-button","secondary");s.addEventListener("click",()=>Y("/inventoryLog")),r.appendChild(s);const p=f("Manage component types","button","add-new-type","secondary","add");p.addEventListener("click",()=>{de()}),r.appendChild(p);const u=f("Manage Storage Locations","buttton","manage-locations-button","secondary","location_on");u.addEventListener("click",()=>{G()}),r.appendChild(u),l.appendChild(r),I.appendChild(l);const m=c("section","report-message","message-wrapper",null);I.appendChild(m);const h=c("form","generate-form","card",null),y=c("h2",null,null,"Generate Report");h.appendChild(y);const g=c("section",null,"button-row",null),v=N("date","start-date-input","Start Date:",null);g.appendChild(v);const L=N("date","end-date-input","End Date:",null);g.appendChild(L),h.appendChild(g);const T=c("section",null,"form-row",null),B=f("submit","submit","generate-button","primary full","list_alt_add");T.appendChild(B),h.appendChild(T),h.addEventListener("submit",E=>{E.preventDefault(),oe(h)}),I.appendChild(h)}await _(t),o.remove()});function k(n,t){const o=["componentType","quantity"],i="componentId";if(t){const d=A(n,o,i,3,"componentItem"),e=d.querySelector("button");return e&&e.addEventListener("click",()=>{const l=q(n,"Are you sure you want to delete this component?");if(l){const a=l.children[0],r=l.children[1];r&&r.addEventListener("click",async()=>{w("delete-item-backdrop");try{await U(n.componentId.toString()),b(`Deleted component "${n.componentType}"`,"main-message","delete"),d.remove()}catch(s){b(s,"main-message","error")}}),a&&a.addEventListener("click",()=>{w("delete-item-backdrop")})}}),d}else return A(n,o,i,2,"componentItem")}async function _(n){const t=S();let o=[],i=[],d=!1;t&&(d=!0);try{o=await z(),i=await M()}catch(r){b(r,"main-message","error");return}const e=c("h2","card-heading",null,"Current Inventory");if(n.appendChild(e),o.length===0){const r=await P();if(r.length===0){const s=document.createElement("p"),p=document.createTextNode("There are not items currently in the inventory.");s.appendChild(p),n.appendChild(s)}else{let s=[];t?s=["Component","Quantity","Delete"]:s=["Component","Quantity"];const p=document.getElementById("inventory-table-container");p&&p.remove();const u=document.createElement("div");u.setAttribute("id","inventory-table-container"),u.setAttribute("class","table-container");const m=x("current-inventory-table",s),h=r.reduce((y,g)=>{const v=k(g,d);return y.appendChild(v),y},document.createElement("tbody"));h.setAttribute("id","currentInventoryTableBody"),m.appendChild(h),u.appendChild(m),n.appendChild(u)}}else{const r=c("section","filter-row","button-row",null),s=f("All Inventory","button","all-inventory-button","secondary");s.addEventListener("click",()=>{const m=document.getElementById("card-heading"),h=c("h2","card-heading",null,"Current Inventory");n.replaceChild(h,m);const y=l(0,o);a(y)}),r.appendChild(s),i.forEach(m=>{if(!m.external){const h=f(`${m.locationName}`,"button",`${m.locationName}-filter`,"secondary");h.addEventListener("click",()=>{const y=document.getElementById("card-heading"),g=c("h2","card-heading",null,`Current Inventory at ${m.locationName}`);n.replaceChild(g,y);const v=l(m.locationId,o);a(v)}),r.appendChild(h)}}),n.appendChild(r);const p=l(0,o);a(p);const u=document.getElementById("loading");u&&u.remove()}function l(r,s){if(r===0)return Object.values(s.reduce((p,u,m)=>{const{componentId:h,quantity:y}=u;return p[h]?p[h].quantity+=y:p[h]={itemId:m,locationId:0,locationName:"all",componentId:u.componentId,componentType:u.componentType,quantity:u.quantity},p},{}));{const p=s.filter(u=>u.locationId===r);return p.length>0?p:[]}}function a(r){console.log(`The inventory array has a length of ${r.length}`);const s=document.getElementById("no-inventory");s&&s.remove();let p=[];p=["Component","Quantity"];const u=document.getElementById("inventory-table-container");if(u&&u.remove(),r.length===0){const m=c("p","no-inventory",null,"No inventory for this location");n.appendChild(m)}else{const m=document.createElement("div");m.setAttribute("id","inventory-table-container"),m.setAttribute("class","table-container");const h=x("current-inventory-table",p),y=r.reduce((g,v)=>{const L=k(v,!1);return g.appendChild(L),g},document.createElement("tbody"));y.setAttribute("id","currentInventoryTableBody"),h.appendChild(y),m.appendChild(h),n.appendChild(m)}}}async function Z(n,t){let o=[];try{o=await W()}catch{b("Error generating report. Please try reloading the page","main-message","error");return}return o.filter(e=>e.entryDate>=n&&e.entryDate<=t).sort((e,l)=>e.entryDate.getTime()-l.entryDate.getTime())}async function ee(n){let t=[];try{t=await P()}catch(i){b(i,"main-message","error");return}return t.reduce((i,d)=>{const e={componentId:d.componentId?d.componentId:0,componentType:d.componentType,quantityDonated:0,quantityDistributed:0};return n.filter(a=>a.componentId===e.componentId).forEach(a=>{a.locationName&&!a.external&&!a.destination?e.quantityDonated+=a.quantity:a.external&&(e.quantityDistributed+=a.quantity)}),i.push(e),i},[])}function te(n){const t=document.createElement("div");t.setAttribute("id","summary-table-container"),t.setAttribute("class","table-container");const o=x("summary-table",["Total Donated","Total Distributed"]),i=n.reduce((d,e)=>{let l=document.createElement("tr"),a=document.createElement("td"),r=document.createTextNode(`${e.componentType}: ${e.quantityDonated}`);a.appendChild(r),l.appendChild(a);let s=document.createElement("td"),p=document.createTextNode(`${e.componentType}: ${e.quantityDistributed}`);return s.appendChild(p),l.appendChild(s),d.appendChild(l),d},document.createElement("tbody"));return o.appendChild(i),t.appendChild(o),t}function ne(n){const t=document.createElement("div");t.setAttribute("id","entries-table-container"),t.setAttribute("class","table-container");const o=x("entries-table",["Date","Entry"]),i=n.reduce((d,e)=>{const l=document.createElement("tr"),a=document.createElement("td"),r=document.createTextNode(D(e.entryDate,"shortDate"));a.appendChild(r),l.appendChild(a);const s=document.createElement("td");return e.locationName&&e.destination&&!e.external?s.textContent=`${e.quantity} ${e.componentType} moved from ${e.locationName} to ${e.destination} by ${e.whoDonated}`:e.locationName&&!e.external?s.textContent=`${e.quantity} ${e.componentType} donated to ${e.locationName} by ${e.whoDonated}`:s.textContent=`${e.quantity} ${e.componentType} distributed from ${e.locationName} to ${e.destination} by ${e.whoDonated}`,l.appendChild(s),d.appendChild(l),d},document.createElement("tbody"));return o.appendChild(i),t.appendChild(o),t}async function oe(n){b("Generating inventory report...","report-message","info");let t=new FormData(n),o=t.get("start-date-input"),i=t.get("end-date-input");if(o&&i){if(new Date(o.toString())>new Date(i.toString())){b("Please make sure the end date is a later date than the start date","report-message","error");return}}else if(!o&&!i){b("Please select start and end dates","report-message","error");return}else if(!o&&i){b("Please select a start date","report-message","error");return}else if(o&&!i){b("Please select an end date","report-message","error");return}if(n.classList.add("hide"),o&&i){let d=new Date(o.toString()),e=new Date(i.toString()),l=document.createElement("article");l.setAttribute("class","card");let a=await Z(d,e);if(a){if(a.length===0){let p=document.createElement("h2"),u=document.createTextNode("No results");p.appendChild(u),l.appendChild(p);let m=document.createElement("p"),h=document.createTextNode(`No items where donated or distributed ${D(d,"shortDate")} to ${D(e,"shortDate")}`);m.appendChild(h),l.appendChild(m)}else{let p=document.createElement("h2"),u=document.createTextNode(`${D(d,"shortDate")} to ${D(e,"shortDate")} Report`);p.appendChild(u),l.appendChild(p);let m=await ee(a);if(m){const h=te(m);l.appendChild(h);const y=ne(a);l.appendChild(y)}else return}const r=document.createElement("div");r.setAttribute("class","form-row");const s=f("Generate New Report","button","newReport","primary fulll");s.addEventListener("click",()=>{l.remove(),n.classList.remove("hide")}),r.appendChild(s),l.appendChild(r),Q(),I.appendChild(l),l.scrollIntoView({behavior:"smooth"})}}else return}async function ae(n){const t=document.getElementById("current-inventory-card"),o={componentType:""},i=n.get("nameInput");if(i===null||i.toString().trim()===""){b("Please enter the name of the new component type","manage-inventory-message","error");return}else{o.componentType=i.toString().trim();try{const d=await J(o);if(w("manage-inventory-backdrop"),d){o.componentId=d,b(`Added '${o.componentType}' to inventory`,"main-message","check_circle"),o.componentId=d;const e=document.getElementById("currentInventoryTableBody");if(e){const l={itemId:0,locationId:0,locationName:"all",componentId:o.componentId,componentType:o.componentType,quantity:0},a=k(l,!0);e.appendChild(a)}else t&&_(t)}else b("Failed to add new component. Please try again.","main-message","error")}catch(d){b(d,"main-message","error")}}}async function le(n){const t=n.get("new-location-input");if(t===null||t.toString().trim()==="")b("Please enter the name of the new storage Location","manage-inventory-message","error");else{const o=n.get("external-checkbox"),i={locationName:t.toString(),external:!!o};console.log(i.external),await X(i),w("manage-inventory-backdrop"),G()}}function de(){C.innerHTML="";const n=C.cloneNode(!0);C.parentNode?.replaceChild(n,C),C=n;const t=c("form","new-component-form",null,null),o=c("h2",null,null,"Add a New Component Type");t.appendChild(o);const i=N("text","nameInput","Name of new component type:","form-row");t.appendChild(i);const d=c("section",null,"button-row",null),e=f("Cancel","button","cancelButton","secondary");e.addEventListener("click",()=>{w("manage-inventory-backdrop")}),d.appendChild(e);const l=f("Submit","submt","submitButton","primary");d.appendChild(l),t.appendChild(d),t.addEventListener("submit",a=>{a.preventDefault();const r=new FormData(t);ae(r)}),C.appendChild(t),H(F,C,"nameInput")}function re(){C.innerHTML="";const n=C.cloneNode(!0);C.parentNode?.replaceChild(n,C),C=n;const t=c("form","new-location-form",null,null),o=c("h2",null,null,"Add a New storage location");t.appendChild(o);const i=N("text","new-location-input","Storage Location:","form-row");t.appendChild(i);const d=c("section",null,"form-row",null),e=c("span",null,null,"External:");d.appendChild(e);const l=V("External","Internal","external-checkbox",!1);d.appendChild(l),t.appendChild(d);const a=c("section",null,"button-row",null),r=f("Cancel","button","cancelButton","secondary");r.addEventListener("click",()=>{w("manage-inventory-backdrop")}),a.appendChild(r);const s=f("Submit","submt","submitButton","primary");a.appendChild(s),t.appendChild(a),t.addEventListener("submit",p=>{p.preventDefault();const u=new FormData(t);le(u)}),C.appendChild(t),H(F,C,"newLocationInput")}async function G(){const n=document.getElementById("manage-storage-locations-card");n.innerHTML="";const t=document.getElementById("manage-inventory-card"),o=c("h2",null,null,"Manage Storage Locations");n.appendChild(o);const i=await M();if(i.length===0){const a=c("p",null,null,"No storage locations");n.appendChild(a)}else{const a=c("table","storage-locations-table",null,null),r=c("colgroup",null,null,null),s=document.createElement("col");s.setAttribute("style","width: auto"),r.appendChild(s);const p=document.createElement("col");p.setAttribute("style","width: 100px"),r.appendChild(p),a.appendChild(r);const u=c("thead",null,null,null),m=c("th",null,null,"Location");u.appendChild(m);const h=c("th",null,null,"Remove Location");u.appendChild(h),a.appendChild(u);const y=c("tbody",null,null,null);i.forEach(g=>{const v=c("tr",g.locationId.toString(),null,null),L=c("td",null,null,`${g.locationName} (${g.external?"External":"Internal"})`);v.appendChild(L);const T=c("td",null,null,null),B=f("","button","delete-button","delete-button-icon","delete");B.addEventListener("click",()=>{const E=q(g,`Are you sure you want to delete the location ${g.locationName}?`);if(E){const R=E.children[0],$=E.children[1];$&&$.addEventListener("click",async()=>{w("delete-item-backdrop");try{await K(g.locationId),b(`Deleted ${g.locationName}`,"main-message","delete"),v.remove()}catch(j){b(j,"main-message","error")}}),R&&R.addEventListener("click",()=>{w("delete-item-backdrop")})}}),T.appendChild(B),v.appendChild(T),y.appendChild(v)}),n.appendChild(a),a.appendChild(y)}const d=c("section",null,"button-row",null),e=f("Add New Storage Location","button","add-new-location","secondary","add_location_alt");e.addEventListener("click",()=>{re()}),d.appendChild(e);const l=f("Done","button","close-locations-button","secondary");l.addEventListener("click",()=>{n.classList.add("hide"),t.classList.remove("hide")}),d.appendChild(l),n.appendChild(d),t.classList.add("hide"),n.classList.remove("hide")}
