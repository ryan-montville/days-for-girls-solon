import{i as J,m as u,f as b,k as W,a as r,j as q,r as D,l as v,o as U,p as X,n as Z}from"./app-CWWncusU.js";import{j,i as O,m as tt,p as Q,q as S,r as H,s as F,t as x,v as et,w as $}from"./indexedService-CyxUA599.js";const K=document.getElementById("new-entry-card"),E=document.getElementById("log-entries-card"),Y=document.getElementById("inventory-backdrop");let l=document.getElementById("inventory-modal"),R=[],f=[];J("Inventory","Inventory Log").then(async()=>{await A(),nt(),R=await j(),f=await O();const t=document.getElementById("loading");t&&t.classList.add("hide"),K.classList.remove("hide"),E.classList.remove("hide")});function nt(){const t=u("h2",null,null,"Add New Entry");K.appendChild(t);const e=u("section",null,"button-row",null),o=b("Donate Items","button","donate-items-button","secondary","add_notes");o.addEventListener("click",()=>ot()),e.appendChild(o);const m=b("Move Items","button","move-button","secondary","move_item");m.addEventListener("click",()=>it()),e.appendChild(m);const d=b("Distribute Items","button","distibute-button","secondary","local_shipping");d.addEventListener("click",()=>ct()),e.appendChild(d),K.appendChild(e)}function P(t){const m=X(t,["entryDate","entry"],"entryId",5,"shortDate"),d=m.querySelector("button");return d&&d.addEventListener("click",()=>{const y=Z(t,"Are you sure you want to delete this entry?");if(y){const h=y.children[0],a=y.children[1];a&&a.addEventListener("click",async()=>{v("delete-item-backdrop");try{if(await et(t.entryId),t.locationName&&t.destination&&!t.external){const n=f.find(s=>s.locationName===t.locationName);if(n){const s=await $(t.locationId,t.componentId);if(s){const i=s.quantity-t.quantity;i===0?await x(t.locationId,t.componentId):(s.quantity=i,await S(s))}const c=await $(n.locationId,t.componentId);if(c){const i=c.quantity+t.quantity;c.quantity=i,await S(c)}else{const i={locationId:n.locationId,locationName:n.locationName,componentId:t.componentId,componentType:t.componentType,quantity:t.quantity};await F(i)}}}else if(t.external){const n=await $(t.locationId,t.componentId);if(n)n.quantity=n.quantity+t.quantity,await S(n);else{const s={locationId:t.locationId,locationName:t.locationName,componentId:t.componentId,componentType:t.componentType,quantity:t.quantity};await F(s)}}else{const n=await $(t.locationId,t.componentId);if(n){const s=n.quantity-t.quantity;s===0?await x(t.locationId,t.componentId):(n.quantity=s,console.log(n),await S(n))}}r(`Deleted entry ${t.quantity} ${t.componentType} from ${t.locationName}`,"main-message","delete"),m.remove()}catch(n){r(n,"main-message","error")}}),h&&h.addEventListener("click",()=>{v("delete-item-backdrop")})}}),m}async function A(){try{const t=u("h2",null,null,"Inventory Log");E.appendChild(t);const e=await tt();if(e.length===0){const o=u("p",null,null,"No log entires");E.appendChild(o)}else{const o=["Date","Entry","Delete"],m=document.getElementById("entries-table-container");m&&m.remove();const d=u("div","entries-table-container","table-container",null),y=W("entries-table",o);let h=e.reduce((a,n)=>{const s=P(n);return a.appendChild(s),a},document.createElement("tbody"));h.setAttribute("id","entries-table-body"),y.appendChild(h),d.appendChild(y),E.appendChild(d)}}catch(t){r(t,"main-message","error")}}async function ot(){l.innerHTML="";const t=l.cloneNode(!0);l.parentNode?.replaceChild(t,l),l=t;const e=u("h2",null,null,"Donate Items");l.appendChild(e);const o=q("text","who-donated","Your name:","form-row");l.appendChild(o);const m=q("date","date","Date entered:","form-row");l.appendChild(m);const d=u("section",null,"form-row",null),y=u("label",null,null,"Select component type:");y.setAttribute("for","component-select");const h=D(R,"component","component-select",null);d.appendChild(y),d.appendChild(h),l.appendChild(d);const a=u("section",null,"form-row",null),n=u("label",null,null,"Select location:");n.setAttribute("for","location-select");const s=D(f,"location","location-select","internal");a.appendChild(n),a.appendChild(s),l.appendChild(a);const c=q("number","quantity","Quantity:","form-row");l.appendChild(c);const i=u("section",null,"button-row",null),p=b("Cancel","button","cancel","secondary");p.addEventListener("click",()=>v("inventory-backdrop")),i.appendChild(p);const g=b("Submit","submit","submit-donate","primary");i.appendChild(g),l.appendChild(i),l.addEventListener("submit",async I=>{I.preventDefault(),g.disabled=!0;const w=new FormData(l);await at(w)}),U(Y,l,"who-donated")}async function at(t){let e={entryId:0,entryDate:new Date(0),componentId:0,locationId:0,locationName:"",componentType:"",quantity:0,whoDonated:"",external:!1};const o=t.get("who-donated");if(o===null||o.toString().trim()===""){r("Please enter your name","modal-message","error");return}else e.whoDonated=o.toString();const m=t.get("date");if(m===null||m===""){r("Please select the date entered","modal-message","error");return}else e.entryDate=new Date(m.toString());const d=t.get("location"),y=t.get("component");if(y===null){r("Please select a component.","modal-message","error");return}else{const a=R.find(n=>n.componentId===parseInt(y.toString()));a&&(e.componentId=parseInt(y.toString()),e.componentType=a.componentType)}if(d===null){r("Please select a location.","modal-message","error");return}else{const a=f.find(n=>n.locationId===parseInt(d.toString()));a&&(e.locationId=parseInt(d.toString()),e.locationName=a.locationName)}const h=t.get("quantity");if(h===null){r("Please enter the quantity","modal-message","error");return}else{const a=+h;if(a<1){r("Please enter a quantity greater than 0","modal-message","error");return}else e.quantity=a}r("Submitting Data...","modal-message","info");try{const n=(await Q(e.locationId)).find(s=>s.componentId===e.componentId);if(n){const s=n.quantity+e.quantity;n.quantity=s,await S(n),v("inventory-backdrop");const c=await H(e);e.entryId=c,r(`${e.componentType} quantity updated at ${e.locationName}`,"main-message","check_circle");const i=document.getElementById("entries-table-body");if(i){const g=P(e);i.prepend(g)}else await A();const p=document.querySelector("#submit-donate");p&&(p.disabled=!1)}else{if(e.locationName){const i={locationId:e.locationId,locationName:e.locationName,componentId:e.componentId,componentType:e.componentType,quantity:e.quantity};await F(i);const p=await H(e);e.entryId=p,v("inventory-backdrop"),r(`${e.componentType} added to ${e.locationName}`,"main-message","check_circle")}const s=document.getElementById("entries-table-body");if(s){const i=P(e);s.prepend(i)}else await A();const c=document.querySelector("#submit-donate");c&&(c.disabled=!1)}}catch(a){r(a,"main-message","error");const n=document.querySelector("#submit-donate");n&&(n.disabled=!1)}}async function it(){l.innerHTML="";const t=l.cloneNode(!0);l.parentNode?.replaceChild(t,l),l=t;const e=u("h2",null,null,"Move Items");l.appendChild(e);const o=q("text","who-donated","Your name:","form-row");l.appendChild(o);const m=q("date","date","Date entered:","form-row");l.appendChild(m);const d=u("section",null,"form-row",null),y=u("label",null,null,"Select current location:");y.setAttribute("for","current-location-select");const h=D(f,"location","current-location-select","internal");d.appendChild(y),d.appendChild(h),l.appendChild(d);const a=u("section","new-location-row","form-row hide",null);l.appendChild(a);const n=u("section",null,"form-row",null);l.appendChild(n);const s=q("number","quantity","Quantity:","form-row hide");l.appendChild(s);const c=u("section",null,"button-row",null),i=b("Cancel","button","cancel","secondary");i.addEventListener("click",()=>v("inventory-backdrop")),c.appendChild(i);const p=b("Submit","submit","submit","primary hide");c.appendChild(p),l.appendChild(c);let g;h.addEventListener("change",async I=>{I.preventDefault(),a.classList.add("hide"),s.classList.add("hide"),a.classList.add("hide"),p.classList.add("hide"),n.innerHTML="",a.innerHTML="";const C=I.target.value,T=await Q(parseInt(C.toString()));if(T.length===0){const L=u("p",null,null,"Please choose a different location");n.appendChild(L)}else{const L=D(T,"component","component-select",null);L.addEventListener("change",k=>{k.preventDefault();const _=k.target.value;g=T.find(G=>G.componentId===parseInt(_.toString()))});const N=u("label",null,null,"Select component type:");N.setAttribute("for","component-select"),n.appendChild(N),n.appendChild(L);const B=u("label",null,null,"Select new location:");B.setAttribute("for","new-location-select");const V=f.filter(k=>k.locationId!==parseInt(C.toString())),M=D(V,"location","new-location-select","internal");a.appendChild(B),a.appendChild(M),a.classList.remove("hide"),s.classList.remove("hide"),a.classList.remove("hide"),p.classList.remove("hide")}}),l.addEventListener("submit",async I=>{I.preventDefault();const w=new FormData(l);await lt(w,g)}),U(Y,l,"who-donated")}async function lt(t,e){let o={entryId:0,entryDate:new Date(0),componentId:0,locationId:0,locationName:"",componentType:"",quantity:0,whoDonated:"",destination:"",external:!1};const m=t.get("who-donated");if(m===null||m.toString().trim()===""){r("Please enter your name","modal-message","error");return}else o.whoDonated=m.toString();const d=t.get("date");if(d===null||d===""){r("Please select the date entered","modal-message","error");return}else o.entryDate=new Date(d.toString());const y=document.getElementById("current-location-select"),h=document.getElementById("new-location-select"),a=y.value,n=h.value;if(a===null||a.toString().trim()===""){r("Please select the current location","modal-message","error");return}else{const i=f.find(p=>p.locationId===parseInt(a.toString()));i&&(o.locationName=i.locationName)}if(n===null||n.toString().trim()===""){r("Please select the new location","modal-message","error");return}else{const i=f.find(p=>p.locationId===parseInt(n.toString()));i&&(o.locationId=parseInt(n.toString()),o.destination=i.locationName)}const s=t.get("quantity");if(s===null){r("Please enter the quantity","modal-message","error");return}else{const i=+s;if(i<1){r("Please enter a quantity greater than 0","modal-message","error");return}else if(e)if(i>e.quantity){r(`Please enter a quantity less than ${e.quantity}`,"modal-message","error");return}else o.quantity=i}const c=t.get("component");if(c===null){r("Please select a component.","modal-message","error");return}else{const i=R.find(p=>p.componentId===parseInt(c.toString()));i&&(o.componentId=parseInt(c.toString()),o.componentType=i.componentType)}v("inventory-backdrop"),r("Submitting Data...","main-message","info");try{if(e){e.quantity=e.quantity-o.quantity,e.quantity===0?await x(e.locationId,e.componentId):await S(e);const p=(await Q(o.locationId)).find(C=>C.componentId===o.componentId),g={locationId:o.locationId,locationName:o.destination,componentId:e.componentId,componentType:e.componentType,quantity:+s};p?await S(g):await F(g);const I=await H(o);o.entryId=I;const w=document.getElementById("entries-table-body");if(w){const C=P(o);w.prepend(C)}else await A();r(`Moved ${g.quantity} ${g.componentType} from ${o.locationName} to ${o.destination}`,"main-message","check_circle")}}catch(i){r(i,"main-message","error")}}async function ct(){l.innerHTML="";const t=l.cloneNode(!0);l.parentNode?.replaceChild(t,l),l=t;const e=u("h2",null,null,"Distibute Items");l.appendChild(e);const o=q("text","who-donated","Your name:","form-row");l.appendChild(o);const m=q("date","date","Date entered:","form-row");l.appendChild(m);const d=u("section",null,"form-row",null),y=u("label",null,null,"Select current location:");y.setAttribute("for","current-location-select");const h=D(f,"location","current-location-select","internal");d.appendChild(y),d.appendChild(h),l.appendChild(d);const a=u("section","new-location-row","form-row hide",null);l.appendChild(a);const n=u("section",null,"form-row",null);l.appendChild(n);const s=q("number","quantity","Quantity:","form-row hide");l.appendChild(s);const c=u("section",null,"button-row",null),i=b("Cancel","button","cancel","secondary");i.addEventListener("click",()=>v("inventory-backdrop")),c.appendChild(i);const p=b("Submit","submit","submit","primary hide");c.appendChild(p),l.appendChild(c);let g;h.addEventListener("change",async I=>{I.preventDefault(),a.classList.add("hide"),s.classList.add("hide"),a.classList.add("hide"),p.classList.add("hide"),n.innerHTML="",a.innerHTML="";const C=I.target.value,T=await Q(parseInt(C.toString()));if(T.length===0){const L=u("p",null,null,"Please choose a different location");n.appendChild(L)}else{const L=D(T,"component","component-select",null);L.addEventListener("change",M=>{M.preventDefault();const z=M.target.value;g=T.find(_=>_.componentId===parseInt(z.toString()))});const N=u("label",null,null,"Select component type:");N.setAttribute("for","component-select"),n.appendChild(N),n.appendChild(L);const B=u("label",null,null,"Select destination:");B.setAttribute("for","destination-select");const V=D(f,"destination","destination-select","external");a.appendChild(B),a.appendChild(V),a.classList.remove("hide"),s.classList.remove("hide"),a.classList.remove("hide"),p.classList.remove("hide")}}),l.addEventListener("submit",async I=>{I.preventDefault();const w=new FormData(l);await st(w,g)}),U(Y,l,"who-donated")}async function st(t,e){let o={entryId:0,entryDate:new Date(0),componentId:0,locationId:0,locationName:"",componentType:"",quantity:0,whoDonated:"",destination:"",external:!0};const m=t.get("who-donated");if(m===null||m.toString().trim()===""){r("Please enter your name","modal-message","error");return}else o.whoDonated=m.toString();const d=t.get("date");if(d===null||d===""){r("Please select the date entered","modal-message","error");return}else o.entryDate=new Date(d.toString());const h=document.getElementById("current-location-select").value,a=t.get("destination");if(h===null||h.toString().trim()===""){r("Please select the current location","modal-message","error");return}else{const c=f.find(i=>i.locationId===parseInt(h.toString()));c&&(o.locationName=c.locationName)}if(a===null||a.toString().trim()===""){r("Please select the destination","modal-message","error");return}else{const c=f.find(i=>i.locationId===parseInt(a.toString()));c&&(o.locationId=parseInt(a.toString()),o.destination=c.locationName)}const n=t.get("quantity");if(n===null){r("Please enter the quantity","modal-message","error");return}else{const c=+n;if(c<1){r("Please enter a quantity greater than 0","modal-message","error");return}else if(e)if(c>e.quantity){r(`Please enter a quantity less than ${e.quantity}`,"modal-message","error");return}else o.quantity=c}const s=t.get("component");if(s===null){r("Please select a component.","modal-message","error");return}else{const c=R.find(i=>i.componentId===parseInt(s.toString()));c&&(o.componentId=parseInt(s.toString()),o.componentType=c.componentType)}v("inventory-backdrop"),r("Submitting Data...","main-message","info");try{if(e){e.quantity=e.quantity-o.quantity,e.quantity===0?await x(e.locationId,e.componentId):await S(e);const c=await H(o);o.entryId=c;const i=document.getElementById("entries-table-body");if(i){const p=P(o);i.prepend(p)}else await A();r(`Distributed ${o.quantity} ${o.componentType} from ${o.locationName} to ${o.destination}`,"main-message","check_circle")}}catch(c){r(c,"main-message","error")}}
