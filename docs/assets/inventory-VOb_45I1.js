import{i as A,y as N,a as k,g as x,o as T,e as C,t as S,z as I,b as l,h as w,n as h,c as $,A as q,k as D,l as P,B as M,C as F}from"./app-CGjnPcVu.js";const p=document.getElementById("generateForm"),H=document.getElementById("maincontent"),v=document.getElementById("current-inventory-card"),g=document.getElementById("manage-inventory-card"),E=document.getElementById("manage-inventory-backdrop"),f=document.getElementById("manage-inventory-modal");function B(r,n){const o=["componentType","quantity"],e="componentId";if(n==="admin"){const a=D(r,o,e,3,"componentItem"),t=a.querySelector("button");return t&&t.addEventListener("click",()=>{const d=P(r,"Are you sure you want to delete this component?");if(d){const i=d.children[0],c=d.children[1];c&&c.addEventListener("click",async()=>{C("delete-item-backdrop");try{await M(r.componentId),l(`Deleted component "${r.componentType}"`,"main-message","delete"),a.remove()}catch(s){l(s,"main-message","error")}}),i&&i.addEventListener("click",()=>{C("delete-item-backdrop")})}}),a}else return D(r,o,e,2,"componentItem")}async function L(r){let n=[];try{n=await I()}catch(e){l(e,"main-message","error");return}if(n.length===0){const e=document.createElement("p"),a=document.createTextNode("There are not items currently in the inventory.");e.appendChild(a),v.appendChild(e)}else{let e=[];r==="admin"?e=["Component","Quantity","Delete"]:e=["Component","Quantity"];const a=document.getElementById("current-inventory-table");a&&a.remove();const t=w("current-inventory-table",e),d=n.reduce((i,c)=>{const s=B(c,r);return i.appendChild(s),i},document.createElement("tbody"));d.setAttribute("id","currentInventoryTableBody"),t.appendChild(d),v.appendChild(t)}const o=document.getElementById("loading");o&&o.remove(),v.classList.remove("hide")}async function z(r,n){let o=[];try{o=await F()}catch{l("Error generating report. Please try reloading the page","main-message","error");return}return o.filter(t=>t.entryDate.toDate()>=r&&t.entryDate.toDate()<=n).sort((t,d)=>t.entryDate.toDate().getTime()-d.entryDate.toDate().getTime())}async function G(r){let n=[];try{n=await I()}catch(e){l(e,"main-message","error");return}return n.reduce((e,a)=>{const t={componentType:a.componentType,quantityDonated:0,quantityDistributed:0};return r.filter(i=>i.componentType===t.componentType).forEach(i=>{i.whoDonated?t.quantityDonated+=i.quantity:t.quantityDistributed+=i.quantity}),e.push(t),e},[])}function Q(r){const n=w("summary-table",["Total Donated","Total Distributed"]),o=r.reduce((e,a)=>{let t=document.createElement("tr"),d=document.createElement("td"),i=document.createTextNode(`${a.componentType}: ${a.quantityDonated}`);d.appendChild(i),t.appendChild(d);let c=document.createElement("td"),s=document.createTextNode(`${a.componentType}: ${a.quantityDistributed}`);return c.appendChild(s),t.appendChild(c),e.appendChild(t),e},document.createElement("tbody"));return n.appendChild(o),n}function U(r){const n=w("entries-table",["Date","Entry"]),o=r.reduce((e,a)=>{const t=document.createElement("tr"),d=document.createElement("td"),i=document.createTextNode(h(a.entryDate,"shortDate"));d.appendChild(i),t.appendChild(d);const c=document.createElement("td");if(a.whoDonated){const s=document.createTextNode(`${a.quantity} ${a.componentType} donated by ${a.whoDonated}`);c.appendChild(s)}else{const s=document.createTextNode(`${a.quantity} ${a.componentType} distributed to ${a.destination}`);c.appendChild(s)}return t.appendChild(c),e.appendChild(t),e},document.createElement("tbody"));return n.appendChild(o),n}async function V(){l("Generating inventory report...","main-message","info");let r=new FormData(p),n=r.get("startDate"),o=r.get("endDate");if(n&&o){if(new Date(n.toString())>new Date(o.toString())){l("Please make sure the end date is a later date than the start date","main-message","error");return}}else if(!n&&!o){l("Please select start and end dates","main-message","error");return}else if(!n&&o){l("Please select a start date","main-message","error");return}else if(n&&!o){l("Please select an end date","main-message","error");return}if(p.style.display="none",n&&o){let e=new Date(n.toString()),a=new Date(o.toString()),t=document.createElement("article");t.setAttribute("class","card");let d=await z(e,a);if(d){if(d.length===0){let s=document.createElement("h2"),m=document.createTextNode("No results");s.appendChild(m),t.appendChild(s);let u=document.createElement("p"),y=document.createTextNode(`No items where donated or distributed ${h(n.toString(),"shortDate")} to ${h(o.toString(),"shortDate")}`);u.appendChild(y),t.appendChild(u)}else{let s=document.createElement("h2"),m=document.createTextNode(`${h(n.toString(),"shortDate")} to ${h(o.toString(),"shortDate")} Report`);s.appendChild(m),t.appendChild(s);let u=await G(d);if(u){const y=Q(u);t.appendChild(y);const b=U(d);t.appendChild(b)}else return}const i=document.createElement("div");i.setAttribute("class","form-row");const c=T("Generate New Report","button","newReport","primary fulll");c.addEventListener("click",()=>{t.remove(),p.style.display="block"}),i.appendChild(c),t.appendChild(i),$(),H.appendChild(t)}}else return}async function K(r){const n={componentId:"",componentType:"",quantity:0},o=r.get("nameInput");if(o===null||o.toString().trim()===""){l("Please enter the name of the new component type","manage-inventory-message","error");return}else{n.componentType=o.toString().trim();try{const e=await q(n);if(C("manage-inventory-backdrop"),e){l(`Added '${n.componentType}' to inventory`,"main-message","check_circle"),n.componentId=e;const a=document.getElementById("currentInventoryTableBody");if(a){const t=B(n,"admin");a.appendChild(t)}else L("admin")}else l("Failed to add new component. Please try again.","main-message","error")}catch(e){l(e,"main-message","error")}}}async function O(r){let n=null;if(r){if(n=await x(r.uid),p.classList.contains("hide")&&p.classList.remove("hide"),n==="admin"){const o=document.getElementById("inventory-log-links");o.classList.contains("hide")&&o.classList.remove("hide"),g.classList.contains("hide")&&g.classList.remove("hide")}}else g.classList.contains("hide")||g.classList.add("hide"),p.classList.contains("hide")||p.classList.add("hide");L(n),n==="admin"&&(p.addEventListener("submit",e=>{e.preventDefault(),V()}),document.getElementById("add-new-type").addEventListener("click",()=>{f.innerHTML="";const e=document.createElement("form"),a=document.createElement("h2"),t=document.createTextNode("Add a New Component Type");a.appendChild(t),e.appendChild(a);const d=document.createElement("section");d.setAttribute("class","form-row");const i=document.createElement("label");i.setAttribute("for","nameInput");const c=document.createTextNode("Name of new component type:");i.appendChild(c),d.appendChild(i);const s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("id","nameInput"),s.setAttribute("name","nameInput"),d.appendChild(s),e.appendChild(d);const m=document.createElement("section");m.setAttribute("class","form-row");const u=T("Cancel","button","cancelButton","secondary");u.addEventListener("click",()=>{C("manage-inventory-backdrop")}),m.appendChild(u);const y=T("Submit","submt","submitButton","primary");m.appendChild(y),e.appendChild(m),e.addEventListener("submit",b=>{b.preventDefault();const R=new FormData(e);K(R)}),f.appendChild(e),E.style.display="flex",f.classList.add("opening"),f.setAttribute("aria-modal","true"),s.focus(),S(e,E)}))}A("Inventory").then(async()=>{await N(),k.onAuthStateChanged(async r=>{await O(r)})});
