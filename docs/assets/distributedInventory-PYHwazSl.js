import{i as f,a as D,g as E,s as y,p as w,o as B,f as u,h as T,b as i,j as I,T as p,k,l as C,m as L,n as q,q as M}from"./app-DqBdRKCU.js";const m=document.getElementById("distribute-inventory-modal"),R=document.getElementById("distribute-inventory-backdrop"),c=document.getElementById("previous-entries-card");function g(e){const t=C(e,["entryDate","componentType","quantity","destination"],"entryId",5,"shortDate"),r=t.querySelector("button");return r&&r.addEventListener("click",()=>{const a=L(e,"Are you sure you want to delete this entry?");if(a){const n=a.children[0],d=a.children[1];d&&d.addEventListener("click",async()=>{u("delete-item-backdrop");try{await q(e.entryId),i(`Deleted entry ${M(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),t.remove()}catch(l){i(l,"main-message","error")}}),n&&n.addEventListener("click",()=>{u("delete-item-backdrop")})}}),t}async function b(){let e=[];try{e=await T("distributed")}catch{i("Error loading log entries. Please try reloading the page","main-message","error")}if(e.length===0){let t=document.createElement("p"),r=document.createTextNode("No previous entries");t.appendChild(r),c.appendChild(t)}else{const t=["Date","Component","Quantity","Destination","Delete"],r=document.getElementById("inventory-table-container");r&&r.remove();const a=document.createElement("div");a.setAttribute("id","inventory-table-container"),a.setAttribute("class","table-container");const n=I("previous-entries-table",t);let d=e.reduceRight((l,h)=>{const v=g(h);return l.appendChild(v),l},document.createElement("tbody"));d.setAttribute("id","distributedTableBody"),n.appendChild(d),a.appendChild(n),c.appendChild(a)}const o=document.getElementById("newDistributedEntryButton"),s=document.getElementById("loading");s&&s.remove(),o.classList.contains("hide")&&o.classList.remove("hide"),c.classList.contains("hide")&&c.classList.remove("hide")}async function S(){i("Submitting entry log data...","distribute-modal-message","info");const e=new FormData(m);let o={entryId:"",entryDate:p.fromDate(new Date(0)),componentType:"",quantity:0,destination:""};const s=e.get("date");if(s===null||s===""){i("Please enter the date the components are leaving","distribute-modal-message","error");return}else{const n=new Date(s.toString());o.entryDate=p.fromDate(n)}const t=e.get("componentType");if(t===null||t.toString().trim()===""){i("Please select what component you are distributing","distribute-modal-message","error");return}else o.componentType=t.toString();const r=e.get("quantity");if(r===null){i("Please enter the quantity of the components being distributed","distribute-modal-message","error");return}else{const n=+r;if(n<1){i("Please enter a quantity greater that 0","distribute-modal-message","error");return}else o.quantity=n}const a=e.get("destination");if(a===null||a.toString().trim()===""){i("Please enter the destination","distribute-modal-message","error");return}else o.destination=a.toString();try{let n=await k(o);n&&(o.entryId=n),u("distribute-inventory-backdrop"),i("The inventory has successfully been updated","main-message","check_circle"),m.reset();const d=document.getElementById("distributedTableBody");if(d){const l=g(o);d.prepend(l)}else b()}catch(n){i(n,"distribute-modal-message","error")}}f("Inventory","Distributed Inventory").then(async()=>{D.onAuthStateChanged(async e=>{e?await E(e.uid)!=="admin"&&(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"):(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"),await b(),m.addEventListener("submit",t=>{t.preventDefault(),S()}),document.getElementById("newDistributedEntryButton").addEventListener("click",()=>{w("componentType"),B(R,m,"date")}),document.getElementById("cancel").addEventListener("click",()=>u("distribute-inventory-backdrop"))})});
