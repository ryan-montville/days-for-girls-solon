import{i as L,y as A,a as N,o as T,e as f,t as R,z as v,b as l,h as D,n as h,c as k,A as x,k as S,l as $,B as q,C as P}from"./app-BBWCMP6O.js";const m=document.getElementById("generateForm"),H=document.getElementById("maincontent"),b=document.getElementById("current-inventory-card"),g=document.getElementById("manage-inventory-card"),w=document.getElementById("manage-inventory-backdrop"),C=document.getElementById("manage-inventory-modal");function E(r){const o=S(r,["componentType","quantity"],"componentId",3,"componentItem"),n=o.querySelector("button");return n&&n.addEventListener("click",()=>{const t=$(r,"Are you sure you want to delete this component?");if(t){const s=t.children[0],d=t.children[1];d&&d.addEventListener("click",async()=>{f("delete-item-backdrop");try{await q(r.componentId),l(`Deleted component "${r.componentType}"`,"main-message","delete"),o.remove()}catch(i){l(i,"main-message","error")}}),s&&s.addEventListener("click",()=>{f("delete-item-backdrop")})}}),o}async function I(){let r=[];try{r=await v()}catch(a){l(a,"main-message","error");return}if(r.length===0){const a=document.createElement("p"),o=document.createTextNode("There are not items currently in the inventory.");a.appendChild(o),b.appendChild(a)}else{const o=D("current-inventory-table",["Component","Quantity","Delete"]),n=r.reduce((t,s)=>{const d=E(s);return t.appendChild(d),t},document.createElement("tbody"));n.setAttribute("id","currentInventoryTableBody"),o.appendChild(n),b.appendChild(o)}const e=document.getElementById("loading");e&&e.remove(),b.classList.remove("hide")}async function M(r,e){let a=[];try{a=await P()}catch{l("Error generating report. Please try reloading the page","main-message","error");return}return a.filter(t=>t.entryDate.toDate()>=r&&t.entryDate.toDate()<=e).sort((t,s)=>t.entryDate.toDate().getTime()-s.entryDate.toDate().getTime())}async function F(r){let e=[];try{e=await v()}catch(o){l(o,"main-message","error");return}return e.reduce((o,n)=>{const t={componentType:n.componentType,quantityDonated:0,quantityDistributed:0};return r.filter(d=>d.componentType===t.componentType).forEach(d=>{d.whoDonated?t.quantityDonated+=d.quantity:t.quantityDistributed+=d.quantity}),o.push(t),o},[])}function z(r){const e=D("summary-table",["Total Donated","Total Distributed"]),a=r.reduce((o,n)=>{let t=document.createElement("tr"),s=document.createElement("td"),d=document.createTextNode(`${n.componentType}: ${n.quantityDonated}`);s.appendChild(d),t.appendChild(s);let i=document.createElement("td"),c=document.createTextNode(`${n.componentType}: ${n.quantityDistributed}`);return i.appendChild(c),t.appendChild(i),o.appendChild(t),o},document.createElement("tbody"));return e.appendChild(a),e}function G(r){const e=D("entries-table",["Date","Entry"]),a=r.reduce((o,n)=>{const t=document.createElement("tr"),s=document.createElement("td"),d=document.createTextNode(h(n.entryDate,"shortDate"));s.appendChild(d),t.appendChild(s);const i=document.createElement("td");if(n.whoDonated){const c=document.createTextNode(`${n.quantity} ${n.componentType} donated by ${n.whoDonated}`);i.appendChild(c)}else{const c=document.createTextNode(`${n.quantity} ${n.componentType} distributed to ${n.destination}`);i.appendChild(c)}return t.appendChild(i),o.appendChild(t),o},document.createElement("tbody"));return e.appendChild(a),e}async function K(){l("Generating inventory report...","main-message","info");let r=new FormData(m),e=r.get("startDate"),a=r.get("endDate");if(e&&a){if(new Date(e.toString())>new Date(a.toString())){l("Please make sure the end date is a later date than the start date","main-message","error");return}}else if(!e&&!a){l("Please select start and end dates","main-message","error");return}else if(!e&&a){l("Please select a start date","main-message","error");return}else if(e&&!a){l("Please select an end date","main-message","error");return}if(m.style.display="none",e&&a){let o=new Date(e.toString()),n=new Date(a.toString()),t=document.createElement("article");t.setAttribute("class","card");let s=await M(o,n);if(s){if(s.length===0){let c=document.createElement("h2"),u=document.createTextNode("No results");c.appendChild(u),t.appendChild(c);let p=document.createElement("p"),y=document.createTextNode(`No items where donated or distributed ${h(e.toString(),"shortDate")} to ${h(a.toString(),"shortDate")}`);p.appendChild(y),t.appendChild(p)}else{let c=document.createElement("h2"),u=document.createTextNode(`${h(e.toString(),"shortDate")} to ${h(a.toString(),"shortDate")} Report`);c.appendChild(u),t.appendChild(c);let p=await F(s);if(p){const y=z(p);t.appendChild(y);const B=G(s);t.appendChild(B)}else return}const d=document.createElement("div");d.setAttribute("class","form-row");const i=T("Generate New Report","button","newReport","primary fulll");i.addEventListener("click",()=>{t.remove(),m.style.display="block"}),d.appendChild(i),t.appendChild(d),k(),H.appendChild(t)}}else return}async function V(r){const e={componentId:"",componentType:"",quantity:0},a=r.get("nameInput");if(a===null||a.toString().trim()===""){l("Please enter the name of the new component type","manage-inventory-message","error");return}else{e.componentType=a.toString().trim();try{const o=await x(e);if(f("manage-inventory-backdrop"),o){l(`Added '${e.componentType}' to inventory`,"main-message","check_circle"),e.componentId=o;const n=document.getElementById("currentInventoryTableBody");if(n){const t=E(e);n.appendChild(t)}else I()}else l("Failed to add new component. Please try again.","main-message","error")}catch(o){l(o,"main-message","error")}}}function O(r){r?(g.classList.contains("hide")&&g.classList.remove("hide"),m.classList.contains("hide")&&m.classList.remove("hide")):(g.classList.contains("hide")||g.classList.add("hide"),m.classList.contains("hide")||m.classList.add("hide"))}L("Inventory").then(async()=>{await A(),I(),N.onAuthStateChanged(e=>{O(e)}),m.addEventListener("submit",e=>{e.preventDefault(),K()}),document.getElementById("add-new-type").addEventListener("click",()=>{C.innerHTML="";const e=document.createElement("form"),a=document.createElement("h2"),o=document.createTextNode("Add a New Component Type");a.appendChild(o),e.appendChild(a);const n=document.createElement("section");n.setAttribute("class","form-row");const t=document.createElement("label");t.setAttribute("for","nameInput");const s=document.createTextNode("Name of new component type:");t.appendChild(s),n.appendChild(t);const d=document.createElement("input");d.setAttribute("type","text"),d.setAttribute("id","nameInput"),d.setAttribute("name","nameInput"),n.appendChild(d),e.appendChild(n);const i=document.createElement("section");i.setAttribute("class","form-row");const c=T("Cancel","button","cancelButton","secondary");c.addEventListener("click",()=>{f("manage-inventory-backdrop")}),i.appendChild(c);const u=T("Submit","submt","submitButton","primary");i.appendChild(u),e.appendChild(i),e.addEventListener("submit",p=>{p.preventDefault();const y=new FormData(e);V(y)}),C.appendChild(e),w.style.display="flex",C.classList.add("opening"),C.setAttribute("aria-modal","true"),d.focus(),R(e,w)})});
