import{i as D,a as E,g as B,s as y,e as m,p as w,t as I,f as T,b as r,h as k,T as p,j as C,k as L,l as q,m as R,n as S}from"./app-BHFF5mJw.js";const c=document.getElementById("distribute-inventory-modal"),g=document.getElementById("distribute-inventory-backdrop"),u=document.getElementById("previous-entries-card");function b(e){const n=L(e,["entryDate","componentType","quantity","destination"],"entryId",5,"shortDate"),s=n.querySelector("button");return s&&s.addEventListener("click",()=>{const a=q(e,"Are you sure you want to delete this entry?");if(a){const t=a.children[0],d=a.children[1];d&&d.addEventListener("click",async()=>{m("delete-item-backdrop");try{await R(e.entryId),r(`Deleted entry ${S(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),n.remove()}catch(l){r(l,"main-message","error")}}),t&&t.addEventListener("click",()=>{m("delete-item-backdrop")})}}),n}async function h(){let e=[];try{e=await T("distributed")}catch{r("Error loading log entries. Please try reloading the page","main-message","error")}if(e.length===0){let n=document.createElement("p"),s=document.createTextNode("No previous entries");n.appendChild(s),u.appendChild(n)}else{const n=["Date","Component","Quantity","Destination","Delete"],s=document.getElementById("inventory-table-container");s&&s.remove();const a=document.createElement("div");a.setAttribute("id","inventory-table-container"),a.setAttribute("class","table-container");const t=k("previous-entries-table",n);let d=e.reduceRight((l,v)=>{const f=b(v);return l.appendChild(f),l},document.createElement("tbody"));d.setAttribute("id","distributedTableBody"),t.appendChild(d),a.appendChild(t),u.appendChild(a)}const o=document.getElementById("newDistributedEntryButton"),i=document.getElementById("loading");i&&i.remove(),o.classList.contains("hide")&&o.classList.remove("hide"),u.classList.contains("hide")&&u.classList.remove("hide")}async function M(){r("Submitting entry log data...","distribute-modal-message","info");const e=new FormData(c);let o={entryId:"",entryDate:p.fromDate(new Date(0)),componentType:"",quantity:0,destination:""};const i=e.get("date");if(i===null||i===""){r("Please enter the date the components are leaving","distribute-modal-message","error");return}else{const t=new Date(i.toString());o.entryDate=p.fromDate(t)}const n=e.get("componentType");if(n===null||n.toString().trim()===""){r("Please select what component you are distributing","distribute-modal-message","error");return}else o.componentType=n.toString();const s=e.get("quantity");if(s===null){r("Please enter the quantity of the components being distributed","distribute-modal-message","error");return}else{const t=+s;if(t<1){r("Please enter a quantity greater that 0","distribute-modal-message","error");return}else o.quantity=t}const a=e.get("destination");if(a===null||a.toString().trim()===""){r("Please enter the destination","distribute-modal-message","error");return}else o.destination=a.toString();try{let t=await C(o);t&&(o.entryId=t),m("distribute-inventory-backdrop"),r("The inventory has successfully been updated","main-message","check_circle"),c.reset();const d=document.getElementById("distributedTableBody");if(d){const l=b(o);d.prepend(l)}else h()}catch(t){r(t,"distribute-modal-message","error")}}D("Inventory").then(async()=>{E.onAuthStateChanged(async e=>{e?await B(e.uid)!=="admin"&&(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"):(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"),await h(),c.addEventListener("submit",i=>{i.preventDefault(),M(),document.getElementById("cancel").addEventListener("click",()=>m("distribute-inventory-backdrop"))}),document.getElementById("newDistributedEntryButton").addEventListener("click",()=>{console.log("button clicked"),w("componentType"),g.style.display="flex",c.setAttribute("aria-modal","true"),document.getElementById("date").focus(),I(c,g)})})});
