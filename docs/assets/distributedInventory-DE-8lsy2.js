import{i as f,a as v,g as D,s as y,e as u,p as w,t as B,f as E,b as a,h as T,T as p,j as I,k,l as L,m as C,n as q}from"./app-Cuif3Vld.js";const l=document.getElementById("distribute-inventory-modal"),g=document.getElementById("distribute-inventory-backdrop"),c=document.getElementById("previous-entries-card");function b(e){const o=k(e,["entryDate","componentType","quantity","destination"],"entryId",5,"shortDate"),i=o.querySelector("button");return i&&i.addEventListener("click",()=>{const s=L(e,"Are you sure you want to delete this entry?");if(s){const n=s.children[0],d=s.children[1];d&&d.addEventListener("click",async()=>{u("delete-item-backdrop");try{await C(e.entryId),a(`Deleted entry ${q(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),o.remove()}catch(m){a(m,"main-message","error")}}),n&&n.addEventListener("click",()=>{u("delete-item-backdrop")})}}),o}async function h(){let e=[];try{e=await E("distributed")}catch{a("Error loading log entries. Please try reloading the page","main-message","error")}if(e.length===0){let o=document.createElement("p"),i=document.createTextNode("No previous entries");o.appendChild(i),c.appendChild(o)}else{const i=T("previous-entries-table",["Date","Component","Quantity","Destination","Delete"]);let s=e.reduceRight((n,d)=>{const m=b(d);return n.appendChild(m),n},document.createElement("tbody"));s.setAttribute("id","distributedTableBody"),i.appendChild(s),c.appendChild(i)}const t=document.getElementById("newDistributedEntryButton"),r=document.getElementById("loading");r&&r.remove(),t.classList.contains("hide")&&t.classList.remove("hide"),c.classList.contains("hide")&&c.classList.remove("hide")}async function R(){a("Submitting entry log data...","distribute-modal-message","info");const e=new FormData(l);let t={entryId:"",entryDate:p.fromDate(new Date(0)),componentType:"",quantity:0,destination:""};const r=e.get("date");if(r===null||r===""){a("Please enter the date the components are leaving","distribute-modal-message","error");return}else{const n=new Date(r.toString());t.entryDate=p.fromDate(n)}const o=e.get("componentType");if(o===null||o.toString().trim()===""){a("Please select what component you are distributing","distribute-modal-message","error");return}else t.componentType=o.toString();const i=e.get("quantity");if(i===null){a("Please enter the quantity of the components being distributed","distribute-modal-message","error");return}else{const n=+i;if(n<1){a("Please enter a quantity greater that 0","distribute-modal-message","error");return}else t.quantity=n}const s=e.get("destination");if(s===null||s.toString().trim()===""){a("Please enter the destination","distribute-modal-message","error");return}else t.destination=s.toString();try{await I(t),u("distribute-inventory-backdrop"),a("The inventory has successfully been updated","main-message","check_circle"),l.reset();const n=document.getElementById("distributedTableBody");if(n){const d=b(t);n.prepend(d)}else h()}catch(n){a(n,"distribute-modal-message","error")}}f("Inventory").then(async()=>{v.onAuthStateChanged(async t=>{t?await D(t.uid)!=="admin"&&(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html"):(y("Only admins are allowed access to the inventory logs.","main-message","error"),window.location.href="inventory.html")}),await h(),l.addEventListener("submit",t=>{t.preventDefault(),R(),document.getElementById("cancel").addEventListener("click",()=>u("distribute-inventory-backdrop"))}),document.getElementById("newDistributedEntryButton").addEventListener("click",()=>{console.log("button clicked"),w("componentType"),g.style.display="flex",l.setAttribute("aria-modal","true"),document.getElementById("date").focus(),B(l,g)})});
