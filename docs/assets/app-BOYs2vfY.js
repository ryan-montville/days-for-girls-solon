(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function me(n,e){const t=JSON.stringify(e);localStorage.setItem(n,t)}function z(n){const e=localStorage.getItem(n);return JSON.parse(e)}function F_(){return z("events").sort((e,t)=>{const r=e.eventDate.toDate().getTime(),s=t.eventDate.toDate().getTime();return r-s})}function B_(n){const t=z("events").find(r=>r.eventId===n);return t||null}function j_(n){let e=z("events"),t=e.findIndex(r=>r.eventId===n.eventId);e[t]=n,me("events",e)}function hc(n,e){let t=z("events");const r=t.findIndex(s=>s.eventId===n);e==="delete"?t[r].numberAttending-=1:t[r].numberAttending+=1,me("events",t)}function $_(n){const t=z("SignUpEntries").filter(o=>o.eventId!==n);me("SignUpEntries",t);const s=z("events").filter(o=>o.eventId!==n);me("events",s)}function q_(){let n=z("events");return n.length===0?1:n[n.length-1].eventId+1}function H_(n){return z("SignUpEntries").filter(t=>t.eventId===n)}function Qu(n){const t=z("SignUpEntries").find(r=>r.entryId===n);return t||null}function z_(n){let e=z("SignUpEntries");e.push(n),me("SignUpEntries",e),hc(n.eventId,"newSignUp")}function G_(n){let t=z("SignUpEntries").filter(s=>s.entryId!==n);const r=Qu(n);r&&hc(r.eventId,"delete"),me("SignUpEntries",t)}function W_(){const n=z("SignUpEntries");return n.length===0?1:n[n.length-1].entryId+1}function Ju(){return z("distributedInventory")}function Xu(n){const t=z("distributedInventory").find(r=>r.entryId===n);return t||null}function K_(n){let e=z("distributedInventory");e.push(n),me("distributedInventory",e),Kr(n.componentType,"subtract",n.quantity)}function Q_(n){const t=z("distributedInventory").filter(s=>s.entryId!==n),r=Xu(n);r&&Kr(r.componentType,"add",r.quantity),me("distributedInventory",t)}function J_(){const n=z("distributedInventory");return n.length===0?1:n[n.length-1].entryId+1}function X_(n,e){li();const t=dc({componentType:n});return t?t.quantity<e?{hasEnough:!1,quantity:t.quantity}:{hasEnough:!0,quantity:t.quantity}:{hasEnough:!1,quantity:0}}function Yu(){return z("donatedInventory")}function Zu(n){const t=z("donatedInventory").find(r=>r.entryId===n);return t||null}function Y_(n){let e=z("donatedInventory");e.push(n),me("donatedInventory",e),Kr(n.componentType,"add",n.quantity)}function Z_(n){const t=z("donatedInventory").filter(s=>s.entryId!==n),r=Zu(n);r&&Kr(r.componentType,"subtract",r.quantity),me("donatedInventory",t)}function ey(){const n=z("donatedInventory");return n.length===0?1:n[n.length-1].entryId+1}function li(){return z("currentInventory")}function ty(n){let e=z("currentInventory");e.push(n),me("currentInventory",e)}function dc({componentId:n,componentType:e}){const t=z("currentInventory");if(n){let r=t.find(s=>s.componentId===n);if(r)return r}else{let r=t.find(s=>s.componentType===e);if(r)return r}return null}function ny(n){const e=dc({componentId:n});if(e){let t=Ju(),r=Yu(),s=li();const o=t.filter(h=>h.componentType!==e.componentType),a=r.filter(h=>h.componentType!==e.componentType),u=s.filter(h=>h.componentId!==n);me("donatedInventory",a),me("distributedInventory",o),me("currentInventory",u)}}function Kr(n,e,t){let r=z("currentInventory");const s=r.findIndex(o=>o.componentType===n);e==="add"?r[s].quantity+=t:r[s].quantity-=t,me("currentInventory",r)}function ry(){const n=z("currentInventory");return n.length===0?1:n[n.length-1].componentId+1}function sy(){const n=localStorage.getItem("donatePage");return JSON.parse(n)}function iy(n){me("donatePage",n)}function Rr(n,e,t,r,s){const o=document.createElement("button");if(o.setAttribute("type",e),o.setAttribute("id",t),o.setAttribute("class",r),s){const u=document.createElement("span");u.setAttribute("class","material-symbols-outlined");const h=document.createTextNode(s);u.appendChild(h),o.appendChild(u)}const a=document.createTextNode(n);return o.appendChild(a),o}function oy(n,e,t,r){const s=Object.keys(n),o=Object.values(n),a=o.length,u=s.filter(f=>f.includes("Id")).length;let h=document.createElement("tr");if(a===0){const f=document.createElement("td");f.setAttribute("colspan",e.toString());const _=document.createTextNode("No items to display");f.appendChild(_),h.appendChild(f)}else{for(let E=u;E<a;E++){const S=document.createElement("td");if(s[E]==="entryDate"){if(r){const P=nh(o[E],r),k=document.createTextNode(P);S.appendChild(k)}}else{const P=document.createTextNode(o[E]);S.appendChild(P)}h.appendChild(S)}const f=document.createElement("td"),_=Rr("","button",o[0],"delete-button-icon","delete");f.appendChild(_),h.appendChild(f)}return h}function ay(){const n=document.getElementsByClassName("message-wrapper");for(const e of n)e.innerHTML=""}function eh(n,e,t){const r={message:n,messageContainer:e,icon:t};sessionStorage.setItem("message",JSON.stringify(r))}function th(){const n=sessionStorage.getItem("message");if(n){const e=JSON.parse(n);Gt(e.message,e.messageContainer,e.icon),sessionStorage.removeItem("message")}}function It(n){const e=document.getElementById(n),t=e.getElementsByClassName("modal");t&&t[0].setAttribute("aria-modal","false"),e.style.display="none"}function Gt(n,e,t){const r=document.getElementById(e);r.innerHTML="";const s=document.createElement("div");t==="check_circle"?(s.setAttribute("class","success message"),s.setAttribute("aria-live","polite"),console.log(n)):t==="error"?(s.setAttribute("class","error message"),s.setAttribute("role","alert"),console.error(n)):t==="delete"||t==="warn"?(s.setAttribute("class","warn message"),s.setAttribute("aria-live","polite"),console.warn(n)):(s.setAttribute("class","info message"),s.setAttribute("aria-live","polite"),console.log(n));const o=document.createElement("span");o.setAttribute("class","material-symbols-outlined");const a=document.createTextNode(t);o.appendChild(a),s.appendChild(o);const u=document.createTextNode(n);s.appendChild(u);const h=Rr("","button","closeButton","","close");h.addEventListener("click",()=>r.innerHTML=""),s.appendChild(h),r.appendChild(s)}function cy(n,e){const t=document.createElement("table");t.setAttribute("id",n);const r=document.createElement("thead");return e.forEach(s=>{const o=document.createElement("th"),a=document.createTextNode(s);o.appendChild(a),r.appendChild(o)}),t.appendChild(r),t}function ly(n,e){const t=document.getElementById("delete-item-backdrop"),r=document.getElementById("delete-item-modal");t.style.display="flex",r.setAttribute("aria-modal","true");const s=document.getElementById("delete-item-modal");s.innerHTML="";const o=document.createElement("h2"),a=document.createTextNode(e);o.appendChild(a),s.appendChild(o);const u=Object.keys(n),h=Object.values(n),f=h.length;for(let P=0;P<f;P++){const k=document.createElement("p");if(!u[P].includes("Id")&&!u[P].includes("eventDescription")){const L=u[P].replace(/([a-z])([A-Z])/g,"$1 $2"),N=document.createTextNode(`${L.toLowerCase()}: ${h[P]}`);k.appendChild(N),s.appendChild(k)}}const _=document.createElement("section");_.setAttribute("class","button-row");const E=Rr("No","button","no","secondary");_.appendChild(E);const S=Rr("Yes","button","yes","delete-button");return _.appendChild(S),s.appendChild(_),E.focus(),fc(s,t),_}function nh(n,e){const t=new Date(n),r=new Date(t.getTime()-t.getTimezoneOffset()*-6e4);return e==="shortDate"?r.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):r.toLocaleDateString("en-US",{month:"long",day:"2-digit",year:"numeric"})}function rh(){const n=li();let e=[];return n.forEach(t=>e.push(t.componentType)),e}function uy(){const n=document.createElement("div"),e=document.createElement("p"),t=document.createTextNode("Loading...");return e.appendChild(t),n.appendChild(e),n}function hy(n){let e=document.getElementById(n);e.options.length===1&&rh().forEach(r=>{let s=document.createElement("option");s.setAttribute("value",r);let o=document.createTextNode(r);s.appendChild(o),e.appendChild(s)})}function fc(n,e){const t=n.querySelectorAll("button, [href], input, select, textarea");if(e.style.display==="none")return;if(!t.length){console.warn("trapFocus Function called on modal with no focusable elements");return}const r=t[0],s=t[t.length-1];document.addEventListener("keydown",o=>{o.key==="Tab"&&(o.shiftKey?document.activeElement===r&&(s.focus(),o.preventDefault()):document.activeElement===s&&(r.focus(),o.preventDefault()))})}function Tn(n,e){const t=JSON.stringify(e);localStorage.setItem(n,t)}const sh=()=>{};var Qo={};const pc=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},ih=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},mc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,_=o>>2,E=(o&3)<<4|u>>4;let S=(u&15)<<2|f>>6,P=f&63;h||(P=64,a||(S=64)),r.push(t[_],t[E],t[S],t[P])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(pc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):ih(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const f=s<n.length?t[n.charAt(s)]:64;++s;const E=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||f==null||E==null)throw new oh;const S=o<<2|u>>4;if(r.push(S),f!==64){const P=u<<4&240|f>>2;if(r.push(P),E!==64){const k=f<<6&192|E;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class oh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ah=function(n){const e=pc(n);return mc.encodeByteArray(e,!0)},Cr=function(n){return ah(n).replace(/\./g,"")},gc=function(n){try{return mc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ch(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const lh=()=>ch().__FIREBASE_DEFAULTS__,uh=()=>{if(typeof process>"u"||typeof Qo>"u")return;const n=Qo.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},hh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&gc(n[1]);return e&&JSON.parse(e)},Qr=()=>{try{return sh()||lh()||uh()||hh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},_c=n=>Qr()?.emulatorHosts?.[n],dh=n=>{const e=_c(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},yc=()=>Qr()?.config,Ec=n=>Qr()?.[`_${n}`];class fh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function en(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ic(n){return(await fetch(n,{credentials:"include"})).ok}function ph(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Cr(JSON.stringify(t)),Cr(JSON.stringify(a)),""].join(".")}const Sn={};function mh(){const n={prod:[],emulator:[]};for(const e of Object.keys(Sn))Sn[e]?n.emulator.push(e):n.prod.push(e);return n}function gh(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Jo=!1;function vc(n,e){if(typeof window>"u"||typeof document>"u"||!en(window.location.host)||Sn[n]===e||Sn[n]||Jo)return;Sn[n]=e;function t(S){return`__firebase__banner__${S}`}const r="__firebase__banner",o=mh().prod.length>0;function a(){const S=document.getElementById(r);S&&S.remove()}function u(S){S.style.display="flex",S.style.background="#7faaf0",S.style.position="fixed",S.style.bottom="5px",S.style.left="5px",S.style.padding=".5em",S.style.borderRadius="5px",S.style.alignItems="center"}function h(S,P){S.setAttribute("width","24"),S.setAttribute("id",P),S.setAttribute("height","24"),S.setAttribute("viewBox","0 0 24 24"),S.setAttribute("fill","none"),S.style.marginLeft="-6px"}function f(){const S=document.createElement("span");return S.style.cursor="pointer",S.style.marginLeft="16px",S.style.fontSize="24px",S.innerHTML=" &times;",S.onclick=()=>{Jo=!0,a()},S}function _(S,P){S.setAttribute("id",P),S.innerText="Learn more",S.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",S.setAttribute("target","__blank"),S.style.paddingLeft="5px",S.style.textDecoration="underline"}function E(){const S=gh(r),P=t("text"),k=document.getElementById(P)||document.createElement("span"),L=t("learnmore"),N=document.getElementById(L)||document.createElement("a"),$=t("preprendIcon"),q=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(S.created){const K=S.element;u(K),_(N,L);const we=f();h(q,$),K.append(q,k,N,we),document.body.appendChild(K)}o?(k.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",P)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function ge(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _h(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ge())}function yh(){const n=Qr()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Eh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Ih(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function vh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Th(){const n=ge();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function wh(){return!yh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ah(){try{return typeof indexedDB=="object"}catch{return!1}}function Sh(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const bh="FirebaseError";class Qe extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=bh,Object.setPrototypeOf(this,Qe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Un.prototype.create)}}class Un{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Rh(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Qe(s,u,r)}}function Rh(n,e){return n.replace(Ch,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Ch=/\{\$([^}]+)}/g;function Ph(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Rt(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Xo(o)&&Xo(a)){if(!Rt(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Xo(n){return n!==null&&typeof n=="object"}function Fn(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function kh(n,e){const t=new Dh(n,e);return t.subscribe.bind(t)}class Dh{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Nh(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ns),s.error===void 0&&(s.error=Ns),s.complete===void 0&&(s.complete=Ns);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Nh(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ns(){}function Ve(n){return n&&n._delegate?n._delegate:n}class Ct{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const vt="[DEFAULT]";class Vh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new fh;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Lh(e))try{this.getOrInitializeService({instanceIdentifier:vt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=vt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=vt){return this.instances.has(e)}getOptions(e=vt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Oh(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=vt){return this.component?this.component.multipleInstances?e:vt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Oh(n){return n===vt?void 0:n}function Lh(n){return n.instantiationMode==="EAGER"}class Mh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Vh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var F;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(F||(F={}));const xh={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},Uh=F.INFO,Fh={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},Bh=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Fh[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ui{constructor(e){this.name=e,this._logLevel=Uh,this._logHandler=Bh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in F))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?xh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...e),this._logHandler(this,F.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...e),this._logHandler(this,F.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,F.INFO,...e),this._logHandler(this,F.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,F.WARN,...e),this._logHandler(this,F.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...e),this._logHandler(this,F.ERROR,...e)}}const jh=(n,e)=>e.some(t=>n instanceof t);let Yo,Zo;function $h(){return Yo||(Yo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qh(){return Zo||(Zo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Tc=new WeakMap,qs=new WeakMap,wc=new WeakMap,Vs=new WeakMap,hi=new WeakMap;function Hh(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(ot(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Tc.set(t,n)}).catch(()=>{}),hi.set(e,n),e}function zh(n){if(qs.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});qs.set(n,e)}let Hs={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return qs.get(n);if(e==="objectStoreNames")return n.objectStoreNames||wc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ot(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Gh(n){Hs=n(Hs)}function Wh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Os(this),e,...t);return wc.set(r,e.sort?e.sort():[e]),ot(r)}:qh().includes(n)?function(...e){return n.apply(Os(this),e),ot(Tc.get(this))}:function(...e){return ot(n.apply(Os(this),e))}}function Kh(n){return typeof n=="function"?Wh(n):(n instanceof IDBTransaction&&zh(n),jh(n,$h())?new Proxy(n,Hs):n)}function ot(n){if(n instanceof IDBRequest)return Hh(n);if(Vs.has(n))return Vs.get(n);const e=Kh(n);return e!==n&&(Vs.set(n,e),hi.set(e,n)),e}const Os=n=>hi.get(n);function Qh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=ot(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ot(a.result),h.oldVersion,h.newVersion,ot(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const Jh=["get","getKey","getAll","getAllKeys","count"],Xh=["put","add","delete","clear"],Ls=new Map;function ea(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ls.get(e))return Ls.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Xh.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Jh.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),s&&h.done]))[0]};return Ls.set(e,o),o}Gh(n=>({...n,get:(e,t,r)=>ea(e,t)||n.get(e,t,r),has:(e,t)=>!!ea(e,t)||n.has(e,t)}));class Yh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Zh(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Zh(n){return n.getComponent()?.type==="VERSION"}const zs="@firebase/app",ta="0.14.6";const We=new ui("@firebase/app"),ed="@firebase/app-compat",td="@firebase/analytics-compat",nd="@firebase/analytics",rd="@firebase/app-check-compat",sd="@firebase/app-check",id="@firebase/auth",od="@firebase/auth-compat",ad="@firebase/database",cd="@firebase/data-connect",ld="@firebase/database-compat",ud="@firebase/functions",hd="@firebase/functions-compat",dd="@firebase/installations",fd="@firebase/installations-compat",pd="@firebase/messaging",md="@firebase/messaging-compat",gd="@firebase/performance",_d="@firebase/performance-compat",yd="@firebase/remote-config",Ed="@firebase/remote-config-compat",Id="@firebase/storage",vd="@firebase/storage-compat",Td="@firebase/firestore",wd="@firebase/ai",Ad="@firebase/firestore-compat",Sd="firebase",bd="12.6.0";const Gs="[DEFAULT]",Rd={[zs]:"fire-core",[ed]:"fire-core-compat",[nd]:"fire-analytics",[td]:"fire-analytics-compat",[sd]:"fire-app-check",[rd]:"fire-app-check-compat",[id]:"fire-auth",[od]:"fire-auth-compat",[ad]:"fire-rtdb",[cd]:"fire-data-connect",[ld]:"fire-rtdb-compat",[ud]:"fire-fn",[hd]:"fire-fn-compat",[dd]:"fire-iid",[fd]:"fire-iid-compat",[pd]:"fire-fcm",[md]:"fire-fcm-compat",[gd]:"fire-perf",[_d]:"fire-perf-compat",[yd]:"fire-rc",[Ed]:"fire-rc-compat",[Id]:"fire-gcs",[vd]:"fire-gcs-compat",[Td]:"fire-fst",[Ad]:"fire-fst-compat",[wd]:"fire-vertex","fire-js":"fire-js",[Sd]:"fire-js-all"};const Pr=new Map,Cd=new Map,Ws=new Map;function na(n,e){try{n.container.addComponent(e)}catch(t){We.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Wt(n){const e=n.name;if(Ws.has(e))return We.debug(`There were multiple attempts to register component ${e}.`),!1;Ws.set(e,n);for(const t of Pr.values())na(t,n);for(const t of Cd.values())na(t,n);return!0}function di(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Re(n){return n==null?!1:n.settings!==void 0}const Pd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},at=new Un("app","Firebase",Pd);class kd{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ct("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}}const tn=bd;function Ac(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Gs,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw at.create("bad-app-name",{appName:String(s)});if(t||(t=yc()),!t)throw at.create("no-options");const o=Pr.get(s);if(o){if(Rt(t,o.options)&&Rt(r,o.config))return o;throw at.create("duplicate-app",{appName:s})}const a=new Mh(s);for(const h of Ws.values())a.addComponent(h);const u=new kd(t,r,a);return Pr.set(s,u),u}function Sc(n=Gs){const e=Pr.get(n);if(!e&&n===Gs&&yc())return Ac();if(!e)throw at.create("no-app",{appName:n});return e}function ct(n,e,t){let r=Rd[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),We.warn(a.join(" "));return}Wt(new Ct(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Dd="firebase-heartbeat-database",Nd=1,Nn="firebase-heartbeat-store";let Ms=null;function bc(){return Ms||(Ms=Qh(Dd,Nd,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Nn)}catch(t){console.warn(t)}}}}).catch(n=>{throw at.create("idb-open",{originalErrorMessage:n.message})})),Ms}async function Vd(n){try{const t=(await bc()).transaction(Nn),r=await t.objectStore(Nn).get(Rc(n));return await t.done,r}catch(e){if(e instanceof Qe)We.warn(e.message);else{const t=at.create("idb-get",{originalErrorMessage:e?.message});We.warn(t.message)}}}async function ra(n,e){try{const r=(await bc()).transaction(Nn,"readwrite");await r.objectStore(Nn).put(e,Rc(n)),await r.done}catch(t){if(t instanceof Qe)We.warn(t.message);else{const r=at.create("idb-set",{originalErrorMessage:t?.message});We.warn(r.message)}}}function Rc(n){return`${n.name}!${n.options.appId}`}const Od=1024,Ld=30;class Md{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ud(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=sa();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Ld){const s=Fd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){We.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=sa(),{heartbeatsToSend:t,unsentEntries:r}=xd(this._heartbeatsCache.heartbeats),s=Cr(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return We.warn(e),""}}}function sa(){return new Date().toISOString().substring(0,10)}function xd(n,e=Od){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),ia(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),ia(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Ud{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ah()?Sh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Vd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ra(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ra(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function ia(n){return Cr(JSON.stringify({version:2,heartbeats:n})).length}function Fd(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Bd(n){Wt(new Ct("platform-logger",e=>new Yh(e),"PRIVATE")),Wt(new Ct("heartbeat",e=>new Md(e),"PRIVATE")),ct(zs,ta,n),ct(zs,ta,"esm2020"),ct("fire-js","")}Bd("");function Cc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jd=Cc,Pc=new Un("auth","Firebase",Cc());const kr=new ui("@firebase/auth");function $d(n,...e){kr.logLevel<=F.WARN&&kr.warn(`Auth (${tn}): ${n}`,...e)}function yr(n,...e){kr.logLevel<=F.ERROR&&kr.error(`Auth (${tn}): ${n}`,...e)}function Ue(n,...e){throw pi(n,...e)}function Ne(n,...e){return pi(n,...e)}function fi(n,e,t){const r={...jd(),[e]:t};return new Un("auth","Firebase",r).create(e,{appName:n.name})}function At(n){return fi(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qd(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ue(n,"argument-error"),fi(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function pi(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Pc.create(n,...e)}function O(n,e,...t){if(!n)throw pi(e,...t)}function $e(n){const e="INTERNAL ASSERTION FAILED: "+n;throw yr(e),new Error(e)}function Ke(n,e){n||$e(e)}function Ks(){return typeof self<"u"&&self.location?.href||""}function Hd(){return oa()==="http:"||oa()==="https:"}function oa(){return typeof self<"u"&&self.location?.protocol||null}function zd(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Hd()||Ih()||"connection"in navigator)?navigator.onLine:!0}function Gd(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Bn{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ke(t>e,"Short delay should be less than long delay!"),this.isMobile=_h()||vh()}get(){return zd()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function mi(n,e){Ke(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class kc{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$e("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$e("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$e("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Wd={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Kd=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Qd=new Bn(3e4,6e4);function gi(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function nn(n,e,t,r,s={}){return Dc(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const u=Fn({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const f={method:e,headers:h,...o};return Eh()||(f.referrerPolicy="no-referrer"),n.emulatorConfig&&en(n.emulatorConfig.host)&&(f.credentials="include"),kc.fetch()(await Nc(n,n.config.apiHost,t,u),f)})}async function Dc(n,e,t){n._canInitEmulator=!1;const r={...Wd,...e};try{const s=new Xd(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw ur(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const u=o.ok?a.errorMessage:a.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw ur(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw ur(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw ur(n,"user-disabled",a);const _=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw fi(n,_,f);Ue(n,_)}}catch(s){if(s instanceof Qe)throw s;Ue(n,"network-request-failed",{message:String(s)})}}async function Jd(n,e,t,r,s={}){const o=await nn(n,e,t,r,s);return"mfaPendingCredential"in o&&Ue(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function Nc(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?mi(n.config,s):`${n.config.apiScheme}://${s}`;return Kd.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}class Xd{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ne(this.auth,"network-request-failed")),Qd.get())})}}function ur(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Ne(n,e,r);return s.customData._tokenResponse=t,s}async function Yd(n,e){return nn(n,"POST","/v1/accounts:delete",e)}async function Dr(n,e){return nn(n,"POST","/v1/accounts:lookup",e)}function bn(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Zd(n,e=!1){const t=Ve(n),r=await t.getIdToken(e),s=_i(r);O(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:bn(xs(s.auth_time)),issuedAtTime:bn(xs(s.iat)),expirationTime:bn(xs(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function xs(n){return Number(n)*1e3}function _i(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return yr("JWT malformed, contained fewer than 3 sections"),null;try{const s=gc(t);return s?JSON.parse(s):(yr("Failed to decode base64 JWT payload"),null)}catch(s){return yr("Caught error parsing JWT payload as JSON",s?.toString()),null}}function aa(n){const e=_i(n);return O(e,"internal-error"),O(typeof e.exp<"u","internal-error"),O(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Vn(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Qe&&ef(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function ef({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class tf{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Qs{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=bn(this.lastLoginAt),this.creationTime=bn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Nr(n){const e=n.auth,t=await n.getIdToken(),r=await Vn(n,Dr(e,{idToken:t}));O(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Vc(s.providerUserInfo):[],a=rf(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,f=u?h:!1,_={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Qs(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,_)}async function nf(n){const e=Ve(n);await Nr(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function rf(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Vc(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function sf(n,e){const t=await Dc(n,{},async()=>{const r=Fn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await Nc(n,s,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return n.emulatorConfig&&en(n.emulatorConfig.host)&&(h.credentials="include"),kc.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function of(n,e){return nn(n,"POST","/v2/accounts:revokeToken",gi(n,e))}class jt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){O(e.idToken,"internal-error"),O(typeof e.idToken<"u","internal-error"),O(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):aa(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){O(e.length!==0,"internal-error");const t=aa(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(O(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await sf(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new jt;return r&&(O(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(O(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(O(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new jt,this.toJSON())}_performRefresh(){return $e("not implemented")}}function nt(n,e){O(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ke{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new tf(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Qs(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Vn(this,this.stsTokenManager.getToken(this.auth,e));return O(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Zd(this,e)}reload(){return nf(this)}_assign(e){this!==e&&(O(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ke({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Nr(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Re(this.auth.app))return Promise.reject(At(this.auth));const e=await this.getIdToken();return await Vn(this,Yd(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,f=t.createdAt??void 0,_=t.lastLoginAt??void 0,{uid:E,emailVerified:S,isAnonymous:P,providerData:k,stsTokenManager:L}=t;O(E&&L,e,"internal-error");const N=jt.fromJSON(this.name,L);O(typeof E=="string",e,"internal-error"),nt(r,e.name),nt(s,e.name),O(typeof S=="boolean",e,"internal-error"),O(typeof P=="boolean",e,"internal-error"),nt(o,e.name),nt(a,e.name),nt(u,e.name),nt(h,e.name),nt(f,e.name),nt(_,e.name);const $=new ke({uid:E,auth:e,email:s,emailVerified:S,displayName:r,isAnonymous:P,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:N,createdAt:f,lastLoginAt:_});return k&&Array.isArray(k)&&($.providerData=k.map(q=>({...q}))),h&&($._redirectEventId=h),$}static async _fromIdTokenResponse(e,t,r=!1){const s=new jt;s.updateFromServerResponse(t);const o=new ke({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Nr(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];O(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Vc(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,u=new jt;u.updateFromIdToken(r);const h=new ke({uid:s.localId,auth:e,stsTokenManager:u,isAnonymous:a}),f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Qs(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const ca=new Map;function qe(n){Ke(n instanceof Function,"Expected a class definition");let e=ca.get(n);return e?(Ke(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ca.set(n,e),e)}class Oc{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Oc.type="NONE";const la=Oc;function Er(n,e,t){return`firebase:${n}:${e}:${t}`}class $t{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=Er(this.userKey,s.apiKey,o),this.fullPersistenceKey=Er("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Dr(this.auth,{idToken:e}).catch(()=>{});return t?ke._fromGetAccountInfoResponse(this.auth,t,e):null}return ke._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new $t(qe(la),e,r);const s=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=s[0]||qe(la);const a=Er(r,e.config.apiKey,e.name);let u=null;for(const f of t)try{const _=await f._get(a);if(_){let E;if(typeof _=="string"){const S=await Dr(e,{idToken:_}).catch(()=>{});if(!S)break;E=await ke._fromGetAccountInfoResponse(e,S,_)}else E=ke._fromJSON(e,_);f!==o&&(u=E),o=f;break}}catch{}const h=s.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new $t(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async f=>{if(f!==o)try{await f._remove(a)}catch{}})),new $t(o,e,r))}}function ua(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Uc(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Lc(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Bc(e))return"Blackberry";if(jc(e))return"Webos";if(Mc(e))return"Safari";if((e.includes("chrome/")||xc(e))&&!e.includes("edge/"))return"Chrome";if(Fc(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Lc(n=ge()){return/firefox\//i.test(n)}function Mc(n=ge()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xc(n=ge()){return/crios\//i.test(n)}function Uc(n=ge()){return/iemobile/i.test(n)}function Fc(n=ge()){return/android/i.test(n)}function Bc(n=ge()){return/blackberry/i.test(n)}function jc(n=ge()){return/webos/i.test(n)}function yi(n=ge()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function af(n=ge()){return yi(n)&&!!window.navigator?.standalone}function cf(){return Th()&&document.documentMode===10}function $c(n=ge()){return yi(n)||Fc(n)||jc(n)||Bc(n)||/windows phone/i.test(n)||Uc(n)}function qc(n,e=[]){let t;switch(n){case"Browser":t=ua(ge());break;case"Worker":t=`${ua(ge())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${tn}/${r}`}class lf{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,u)=>{try{const h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function uf(n,e={}){return nn(n,"GET","/v2/passwordPolicy",gi(n,e))}const hf=6;class df{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??hf,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class ff{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ha(this),this.idTokenSubscription=new ha(this),this.beforeStateQueue=new lf(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qe(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await $t.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Dr(this,{idToken:e}),r=await ke._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Re(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return O(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Nr(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Gd()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Re(this.app))return Promise.reject(At(this));const t=e?Ve(e):null;return t&&O(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&O(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Re(this.app)?Promise.reject(At(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Re(this.app)?Promise.reject(At(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qe(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await uf(this),t=new df(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Un("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await of(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qe(e)||this._popupRedirectResolver;O(t,this,"argument-error"),this.redirectPersistenceManager=await $t.create(this,[qe(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(O(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Re(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&$d(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Jr(n){return Ve(n)}class ha{constructor(e){this.auth=e,this.observer=null,this.addObserver=kh(t=>this.observer=t)}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ei={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pf(n){Ei=n}function mf(n){return Ei.loadJS(n)}function gf(){return Ei.gapiScript}function _f(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function yf(n,e){const t=di(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(Rt(o,e??{}))return s;Ue(s,"already-initialized")}return t.initialize({options:e})}function Ef(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(qe);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function If(n,e,t){const r=Jr(n);O(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=Hc(e),{host:a,port:u}=vf(e),h=u===null?"":`:${u}`,f={url:`${o}//${a}${h}/`},_=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){O(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),O(Rt(f,r.config.emulator)&&Rt(_,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=_,r.settings.appVerificationDisabledForTesting=!0,en(a)?(Ic(`${o}//${a}${h}`),vc("Auth",!0)):Tf()}function Hc(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function vf(n){const e=Hc(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:da(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:da(a)}}}function da(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Tf(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class zc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $e("not implemented")}_getIdTokenResponse(e){return $e("not implemented")}_linkToIdToken(e,t){return $e("not implemented")}_getReauthenticationResolver(e){return $e("not implemented")}}async function qt(n,e){return Jd(n,"POST","/v1/accounts:signInWithIdp",gi(n,e))}const wf="http://localhost";class Pt extends zc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Pt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ue("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new Pt(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return qt(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,qt(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,qt(e,t)}buildRequest(){const e={requestUri:wf,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fn(t)}return e}}class Ii{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class jn extends Ii{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rt extends jn{constructor(){super("facebook.com")}static credential(e){return Pt._fromParams({providerId:rt.PROVIDER_ID,signInMethod:rt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rt.credentialFromTaggedObject(e)}static credentialFromError(e){return rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rt.credential(e.oauthAccessToken)}catch{return null}}}rt.FACEBOOK_SIGN_IN_METHOD="facebook.com";rt.PROVIDER_ID="facebook.com";class je extends jn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Pt._fromParams({providerId:je.PROVIDER_ID,signInMethod:je.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return je.credentialFromTaggedObject(e)}static credentialFromError(e){return je.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return je.credential(t,r)}catch{return null}}}je.GOOGLE_SIGN_IN_METHOD="google.com";je.PROVIDER_ID="google.com";class st extends jn{constructor(){super("github.com")}static credential(e){return Pt._fromParams({providerId:st.PROVIDER_ID,signInMethod:st.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return st.credentialFromTaggedObject(e)}static credentialFromError(e){return st.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return st.credential(e.oauthAccessToken)}catch{return null}}}st.GITHUB_SIGN_IN_METHOD="github.com";st.PROVIDER_ID="github.com";class it extends jn{constructor(){super("twitter.com")}static credential(e,t){return Pt._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return it.credential(t,r)}catch{return null}}}it.TWITTER_SIGN_IN_METHOD="twitter.com";it.PROVIDER_ID="twitter.com";class Kt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await ke._fromIdTokenResponse(e,r,s),a=fa(r);return new Kt({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=fa(r);return new Kt({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function fa(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Vr extends Qe{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Vr.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Vr(e,t,r,s)}}function Gc(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Vr._fromErrorAndOperation(n,o,e,r):o})}async function Af(n,e,t=!1){const r=await Vn(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Kt._forOperation(n,"link",r)}async function Sf(n,e,t=!1){const{auth:r}=n;if(Re(r.app))return Promise.reject(At(r));const s="reauthenticate";try{const o=await Vn(n,Gc(r,s,e,n),t);O(o.idToken,r,"internal-error");const a=_i(o.idToken);O(a,r,"internal-error");const{sub:u}=a;return O(n.uid===u,r,"user-mismatch"),Kt._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&Ue(r,"user-mismatch"),o}}async function bf(n,e,t=!1){if(Re(n.app))return Promise.reject(At(n));const r="signIn",s=await Gc(n,r,e),o=await Kt._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}function Rf(n,e,t,r){return Ve(n).onIdTokenChanged(e,t,r)}function Cf(n,e,t){return Ve(n).beforeAuthStateChanged(e,t)}const Or="__sak";class Wc{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Or,"1"),this.storage.removeItem(Or),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Pf=1e3,kf=10;class Kc extends Wc{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$c(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,u,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);cf()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,kf):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Pf)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Kc.type="LOCAL";const Df=Kc;class Qc extends Wc{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Qc.type="SESSION";const Jc=Qc;function Nf(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Xr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Xr(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const u=Array.from(a).map(async f=>f(t.origin,o)),h=await Nf(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Xr.receivers=[];function vi(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Vf{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{const f=vi("",20);s.port1.start();const _=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(E){const S=E;if(S.data.eventId===f)switch(S.data.status){case"ack":clearTimeout(_),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(S.data.response);break;default:clearTimeout(_),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function xe(){return window}function Of(n){xe().location.href=n}function Xc(){return typeof xe().WorkerGlobalScope<"u"&&typeof xe().importScripts=="function"}async function Lf(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Mf(){return navigator?.serviceWorker?.controller||null}function xf(){return Xc()?self:null}const Yc="firebaseLocalStorageDb",Uf=1,Lr="firebaseLocalStorage",Zc="fbase_key";class $n{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Yr(n,e){return n.transaction([Lr],e?"readwrite":"readonly").objectStore(Lr)}function Ff(){const n=indexedDB.deleteDatabase(Yc);return new $n(n).toPromise()}function Js(){const n=indexedDB.open(Yc,Uf);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Lr,{keyPath:Zc})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Lr)?e(r):(r.close(),await Ff(),e(await Js()))})})}async function pa(n,e,t){const r=Yr(n,!0).put({[Zc]:e,value:t});return new $n(r).toPromise()}async function Bf(n,e){const t=Yr(n,!1).get(e),r=await new $n(t).toPromise();return r===void 0?null:r.value}function ma(n,e){const t=Yr(n,!0).delete(e);return new $n(t).toPromise()}const jf=800,$f=3;class el{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Js(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>$f)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Xc()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Xr._getInstance(xf()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Lf(),!this.activeServiceWorker)return;this.sender=new Vf(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Mf()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Js();return await pa(e,Or,"1"),await ma(e,Or),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>pa(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Bf(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ma(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=Yr(s,!1).getAll();return new $n(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),jf)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}el.type="LOCAL";const qf=el;new Bn(3e4,6e4);function tl(n,e){return e?qe(e):(O(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Ti extends zc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return qt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return qt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return qt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Hf(n){return bf(n.auth,new Ti(n),n.bypassAuthState)}function zf(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),Sf(t,new Ti(n),n.bypassAuthState)}async function Gf(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),Af(t,new Ti(n),n.bypassAuthState)}class nl{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Hf;case"linkViaPopup":case"linkViaRedirect":return Gf;case"reauthViaPopup":case"reauthViaRedirect":return zf;default:Ue(this.auth,"internal-error")}}resolve(e){Ke(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ke(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Wf=new Bn(2e3,1e4);async function Kf(n,e,t){if(Re(n.app))return Promise.reject(Ne(n,"operation-not-supported-in-this-environment"));const r=Jr(n);qd(n,e,Ii);const s=tl(r,t);return new Tt(r,"signInViaPopup",e,s).executeNotNull()}class Tt extends nl{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,Tt.currentPopupAction&&Tt.currentPopupAction.cancel(),Tt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return O(e,this.auth,"internal-error"),e}async onExecution(){Ke(this.filter.length===1,"Popup operations only handle one event");const e=vi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ne(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ne(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Tt.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ne(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Wf.get())};e()}}Tt.currentPopupAction=null;const Qf="pendingRedirect",Ir=new Map;class Jf extends nl{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ir.get(this.auth._key());if(!e){try{const r=await Xf(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ir.set(this.auth._key(),e)}return this.bypassAuthState||Ir.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Xf(n,e){const t=ep(e),r=Zf(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function Yf(n,e){Ir.set(n._key(),e)}function Zf(n){return qe(n._redirectPersistence)}function ep(n){return Er(Qf,n.config.apiKey,n.name)}async function tp(n,e,t=!1){if(Re(n.app))return Promise.reject(At(n));const r=Jr(n),s=tl(r,e),a=await new Jf(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const np=600*1e3;class rp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sp(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!rl(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ne(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=np&&this.cachedEventUids.clear(),this.cachedEventUids.has(ga(e))}saveEventToCache(e){this.cachedEventUids.add(ga(e)),this.lastProcessedEventTime=Date.now()}}function ga(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function rl({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function sp(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rl(n);default:return!1}}async function ip(n,e={}){return nn(n,"GET","/v1/projects",e)}const op=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ap=/^https?/;async function cp(n){if(n.config.emulator)return;const{authorizedDomains:e}=await ip(n);for(const t of e)try{if(lp(t))return}catch{}Ue(n,"unauthorized-domain")}function lp(n){const e=Ks(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!ap.test(t))return!1;if(op.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const up=new Bn(3e4,6e4);function _a(){const n=xe().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function hp(n){return new Promise((e,t)=>{function r(){_a(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{_a(),t(Ne(n,"network-request-failed"))},timeout:up.get()})}if(xe().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(xe().gapi?.load)r();else{const s=_f("iframefcb");return xe()[s]=()=>{gapi.load?r():t(Ne(n,"network-request-failed"))},mf(`${gf()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw vr=null,e})}let vr=null;function dp(n){return vr=vr||hp(n),vr}const fp=new Bn(5e3,15e3),pp="__/auth/iframe",mp="emulator/auth/iframe",gp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_p=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yp(n){const e=n.config;O(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?mi(e,mp):`https://${n.config.authDomain}/${pp}`,r={apiKey:e.apiKey,appName:n.name,v:tn},s=_p.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${Fn(r).slice(1)}`}async function Ep(n){const e=await dp(n),t=xe().gapi;return O(t,n,"internal-error"),e.open({where:document.body,url:yp(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gp,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=Ne(n,"network-request-failed"),u=xe().setTimeout(()=>{o(a)},fp.get());function h(){xe().clearTimeout(u),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const Ip={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},vp=500,Tp=600,wp="_blank",Ap="http://localhost";class ya{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Sp(n,e,t,r=vp,s=Tp){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...Ip,width:r.toString(),height:s.toString(),top:o,left:a},f=ge().toLowerCase();t&&(u=xc(f)?wp:t),Lc(f)&&(e=e||Ap,h.scrollbars="yes");const _=Object.entries(h).reduce((S,[P,k])=>`${S}${P}=${k},`,"");if(af(f)&&u!=="_self")return bp(e||"",u),new ya(null);const E=window.open(e||"",u,_);O(E,n,"popup-blocked");try{E.focus()}catch{}return new ya(E)}function bp(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const Rp="__/auth/handler",Cp="emulator/auth/handler",Pp=encodeURIComponent("fac");async function Ea(n,e,t,r,s,o){O(n.config.authDomain,n,"auth-domain-config-required"),O(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:tn,eventId:s};if(e instanceof Ii){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Ph(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[_,E]of Object.entries({}))a[_]=E}if(e instanceof jn){const _=e.getScopes().filter(E=>E!=="");_.length>0&&(a.scopes=_.join(","))}n.tenantId&&(a.tid=n.tenantId);const u=a;for(const _ of Object.keys(u))u[_]===void 0&&delete u[_];const h=await n._getAppCheckToken(),f=h?`#${Pp}=${encodeURIComponent(h)}`:"";return`${kp(n)}?${Fn(u).slice(1)}${f}`}function kp({config:n}){return n.emulator?mi(n,Cp):`https://${n.authDomain}/${Rp}`}const Us="webStorageSupport";class Dp{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Jc,this._completeRedirectFn=tp,this._overrideRedirectResult=Yf}async _openPopup(e,t,r,s){Ke(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Ea(e,t,r,Ks(),s);return Sp(e,o,vi())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await Ea(e,t,r,Ks(),s);return Of(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(Ke(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Ep(e),r=new rp(e);return t.register("authEvent",s=>(O(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Us,{type:Us},s=>{const o=s?.[0]?.[Us];o!==void 0&&t(!!o),Ue(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=cp(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return $c()||Mc()||yi()}}const Np=Dp;var Ia="@firebase/auth",va="1.11.1";class Vp{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Op(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Lp(n){Wt(new Ct("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;O(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qc(n)},f=new ff(r,s,o,h);return Ef(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Wt(new Ct("auth-internal",e=>{const t=Jr(e.getProvider("auth").getImmediate());return(r=>new Vp(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ct(Ia,va,Op(n)),ct(Ia,va,"esm2020")}const Mp=300,xp=Ec("authIdTokenMaxAge")||Mp;let Ta=null;const Up=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>xp)return;const s=t?.token;Ta!==s&&(Ta=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Fp(n=Sc()){const e=di(n,"auth");if(e.isInitialized())return e.getImmediate();const t=yf(n,{popupRedirectResolver:Np,persistence:[qf,Df,Jc]}),r=Ec("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=Up(o.toString());Cf(t,a,()=>a(t.currentUser)),Rf(t,u=>a(u))}}const s=_c("auth");return s&&If(t,`http://${s}`),t}function Bp(){return document.getElementsByTagName("head")?.[0]??document}pf({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=Ne("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",Bp().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Lp("Browser");var jp="firebase",$p="12.6.0";ct(jp,$p,"app");var wa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var wi;(function(){var n;function e(I,p){function g(){}g.prototype=p.prototype,I.F=p.prototype,I.prototype=new g,I.prototype.constructor=I,I.D=function(v,y,w){for(var m=Array(arguments.length-2),Ie=2;Ie<arguments.length;Ie++)m[Ie-2]=arguments[Ie];return p.prototype[y].apply(v,m)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,p,g){g||(g=0);const v=Array(16);if(typeof p=="string")for(var y=0;y<16;++y)v[y]=p.charCodeAt(g++)|p.charCodeAt(g++)<<8|p.charCodeAt(g++)<<16|p.charCodeAt(g++)<<24;else for(y=0;y<16;++y)v[y]=p[g++]|p[g++]<<8|p[g++]<<16|p[g++]<<24;p=I.g[0],g=I.g[1],y=I.g[2];let w=I.g[3],m;m=p+(w^g&(y^w))+v[0]+3614090360&4294967295,p=g+(m<<7&4294967295|m>>>25),m=w+(y^p&(g^y))+v[1]+3905402710&4294967295,w=p+(m<<12&4294967295|m>>>20),m=y+(g^w&(p^g))+v[2]+606105819&4294967295,y=w+(m<<17&4294967295|m>>>15),m=g+(p^y&(w^p))+v[3]+3250441966&4294967295,g=y+(m<<22&4294967295|m>>>10),m=p+(w^g&(y^w))+v[4]+4118548399&4294967295,p=g+(m<<7&4294967295|m>>>25),m=w+(y^p&(g^y))+v[5]+1200080426&4294967295,w=p+(m<<12&4294967295|m>>>20),m=y+(g^w&(p^g))+v[6]+2821735955&4294967295,y=w+(m<<17&4294967295|m>>>15),m=g+(p^y&(w^p))+v[7]+4249261313&4294967295,g=y+(m<<22&4294967295|m>>>10),m=p+(w^g&(y^w))+v[8]+1770035416&4294967295,p=g+(m<<7&4294967295|m>>>25),m=w+(y^p&(g^y))+v[9]+2336552879&4294967295,w=p+(m<<12&4294967295|m>>>20),m=y+(g^w&(p^g))+v[10]+4294925233&4294967295,y=w+(m<<17&4294967295|m>>>15),m=g+(p^y&(w^p))+v[11]+2304563134&4294967295,g=y+(m<<22&4294967295|m>>>10),m=p+(w^g&(y^w))+v[12]+1804603682&4294967295,p=g+(m<<7&4294967295|m>>>25),m=w+(y^p&(g^y))+v[13]+4254626195&4294967295,w=p+(m<<12&4294967295|m>>>20),m=y+(g^w&(p^g))+v[14]+2792965006&4294967295,y=w+(m<<17&4294967295|m>>>15),m=g+(p^y&(w^p))+v[15]+1236535329&4294967295,g=y+(m<<22&4294967295|m>>>10),m=p+(y^w&(g^y))+v[1]+4129170786&4294967295,p=g+(m<<5&4294967295|m>>>27),m=w+(g^y&(p^g))+v[6]+3225465664&4294967295,w=p+(m<<9&4294967295|m>>>23),m=y+(p^g&(w^p))+v[11]+643717713&4294967295,y=w+(m<<14&4294967295|m>>>18),m=g+(w^p&(y^w))+v[0]+3921069994&4294967295,g=y+(m<<20&4294967295|m>>>12),m=p+(y^w&(g^y))+v[5]+3593408605&4294967295,p=g+(m<<5&4294967295|m>>>27),m=w+(g^y&(p^g))+v[10]+38016083&4294967295,w=p+(m<<9&4294967295|m>>>23),m=y+(p^g&(w^p))+v[15]+3634488961&4294967295,y=w+(m<<14&4294967295|m>>>18),m=g+(w^p&(y^w))+v[4]+3889429448&4294967295,g=y+(m<<20&4294967295|m>>>12),m=p+(y^w&(g^y))+v[9]+568446438&4294967295,p=g+(m<<5&4294967295|m>>>27),m=w+(g^y&(p^g))+v[14]+3275163606&4294967295,w=p+(m<<9&4294967295|m>>>23),m=y+(p^g&(w^p))+v[3]+4107603335&4294967295,y=w+(m<<14&4294967295|m>>>18),m=g+(w^p&(y^w))+v[8]+1163531501&4294967295,g=y+(m<<20&4294967295|m>>>12),m=p+(y^w&(g^y))+v[13]+2850285829&4294967295,p=g+(m<<5&4294967295|m>>>27),m=w+(g^y&(p^g))+v[2]+4243563512&4294967295,w=p+(m<<9&4294967295|m>>>23),m=y+(p^g&(w^p))+v[7]+1735328473&4294967295,y=w+(m<<14&4294967295|m>>>18),m=g+(w^p&(y^w))+v[12]+2368359562&4294967295,g=y+(m<<20&4294967295|m>>>12),m=p+(g^y^w)+v[5]+4294588738&4294967295,p=g+(m<<4&4294967295|m>>>28),m=w+(p^g^y)+v[8]+2272392833&4294967295,w=p+(m<<11&4294967295|m>>>21),m=y+(w^p^g)+v[11]+1839030562&4294967295,y=w+(m<<16&4294967295|m>>>16),m=g+(y^w^p)+v[14]+4259657740&4294967295,g=y+(m<<23&4294967295|m>>>9),m=p+(g^y^w)+v[1]+2763975236&4294967295,p=g+(m<<4&4294967295|m>>>28),m=w+(p^g^y)+v[4]+1272893353&4294967295,w=p+(m<<11&4294967295|m>>>21),m=y+(w^p^g)+v[7]+4139469664&4294967295,y=w+(m<<16&4294967295|m>>>16),m=g+(y^w^p)+v[10]+3200236656&4294967295,g=y+(m<<23&4294967295|m>>>9),m=p+(g^y^w)+v[13]+681279174&4294967295,p=g+(m<<4&4294967295|m>>>28),m=w+(p^g^y)+v[0]+3936430074&4294967295,w=p+(m<<11&4294967295|m>>>21),m=y+(w^p^g)+v[3]+3572445317&4294967295,y=w+(m<<16&4294967295|m>>>16),m=g+(y^w^p)+v[6]+76029189&4294967295,g=y+(m<<23&4294967295|m>>>9),m=p+(g^y^w)+v[9]+3654602809&4294967295,p=g+(m<<4&4294967295|m>>>28),m=w+(p^g^y)+v[12]+3873151461&4294967295,w=p+(m<<11&4294967295|m>>>21),m=y+(w^p^g)+v[15]+530742520&4294967295,y=w+(m<<16&4294967295|m>>>16),m=g+(y^w^p)+v[2]+3299628645&4294967295,g=y+(m<<23&4294967295|m>>>9),m=p+(y^(g|~w))+v[0]+4096336452&4294967295,p=g+(m<<6&4294967295|m>>>26),m=w+(g^(p|~y))+v[7]+1126891415&4294967295,w=p+(m<<10&4294967295|m>>>22),m=y+(p^(w|~g))+v[14]+2878612391&4294967295,y=w+(m<<15&4294967295|m>>>17),m=g+(w^(y|~p))+v[5]+4237533241&4294967295,g=y+(m<<21&4294967295|m>>>11),m=p+(y^(g|~w))+v[12]+1700485571&4294967295,p=g+(m<<6&4294967295|m>>>26),m=w+(g^(p|~y))+v[3]+2399980690&4294967295,w=p+(m<<10&4294967295|m>>>22),m=y+(p^(w|~g))+v[10]+4293915773&4294967295,y=w+(m<<15&4294967295|m>>>17),m=g+(w^(y|~p))+v[1]+2240044497&4294967295,g=y+(m<<21&4294967295|m>>>11),m=p+(y^(g|~w))+v[8]+1873313359&4294967295,p=g+(m<<6&4294967295|m>>>26),m=w+(g^(p|~y))+v[15]+4264355552&4294967295,w=p+(m<<10&4294967295|m>>>22),m=y+(p^(w|~g))+v[6]+2734768916&4294967295,y=w+(m<<15&4294967295|m>>>17),m=g+(w^(y|~p))+v[13]+1309151649&4294967295,g=y+(m<<21&4294967295|m>>>11),m=p+(y^(g|~w))+v[4]+4149444226&4294967295,p=g+(m<<6&4294967295|m>>>26),m=w+(g^(p|~y))+v[11]+3174756917&4294967295,w=p+(m<<10&4294967295|m>>>22),m=y+(p^(w|~g))+v[2]+718787259&4294967295,y=w+(m<<15&4294967295|m>>>17),m=g+(w^(y|~p))+v[9]+3951481745&4294967295,I.g[0]=I.g[0]+p&4294967295,I.g[1]=I.g[1]+(y+(m<<21&4294967295|m>>>11))&4294967295,I.g[2]=I.g[2]+y&4294967295,I.g[3]=I.g[3]+w&4294967295}r.prototype.v=function(I,p){p===void 0&&(p=I.length);const g=p-this.blockSize,v=this.C;let y=this.h,w=0;for(;w<p;){if(y==0)for(;w<=g;)s(this,I,w),w+=this.blockSize;if(typeof I=="string"){for(;w<p;)if(v[y++]=I.charCodeAt(w++),y==this.blockSize){s(this,v),y=0;break}}else for(;w<p;)if(v[y++]=I[w++],y==this.blockSize){s(this,v),y=0;break}}this.h=y,this.o+=p},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var p=1;p<I.length-8;++p)I[p]=0;p=this.o*8;for(var g=I.length-8;g<I.length;++g)I[g]=p&255,p/=256;for(this.v(I),I=Array(16),p=0,g=0;g<4;++g)for(let v=0;v<32;v+=8)I[p++]=this.g[g]>>>v&255;return I};function o(I,p){var g=u;return Object.prototype.hasOwnProperty.call(g,I)?g[I]:g[I]=p(I)}function a(I,p){this.h=p;const g=[];let v=!0;for(let y=I.length-1;y>=0;y--){const w=I[y]|0;v&&w==p||(g[y]=w,v=!1)}this.g=g}var u={};function h(I){return-128<=I&&I<128?o(I,function(p){return new a([p|0],p<0?-1:0)}):new a([I|0],I<0?-1:0)}function f(I){if(isNaN(I)||!isFinite(I))return E;if(I<0)return N(f(-I));const p=[];let g=1;for(let v=0;I>=g;v++)p[v]=I/g|0,g*=4294967296;return new a(p,0)}function _(I,p){if(I.length==0)throw Error("number format error: empty string");if(p=p||10,p<2||36<p)throw Error("radix out of range: "+p);if(I.charAt(0)=="-")return N(_(I.substring(1),p));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const g=f(Math.pow(p,8));let v=E;for(let w=0;w<I.length;w+=8){var y=Math.min(8,I.length-w);const m=parseInt(I.substring(w,w+y),p);y<8?(y=f(Math.pow(p,y)),v=v.j(y).add(f(m))):(v=v.j(g),v=v.add(f(m)))}return v}var E=h(0),S=h(1),P=h(16777216);n=a.prototype,n.m=function(){if(L(this))return-N(this).m();let I=0,p=1;for(let g=0;g<this.g.length;g++){const v=this.i(g);I+=(v>=0?v:4294967296+v)*p,p*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(k(this))return"0";if(L(this))return"-"+N(this).toString(I);const p=f(Math.pow(I,6));var g=this;let v="";for(;;){const y=we(g,p).g;g=$(g,y.j(p));let w=((g.g.length>0?g.g[0]:g.h)>>>0).toString(I);if(g=y,k(g))return w+v;for(;w.length<6;)w="0"+w;v=w+v}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function k(I){if(I.h!=0)return!1;for(let p=0;p<I.g.length;p++)if(I.g[p]!=0)return!1;return!0}function L(I){return I.h==-1}n.l=function(I){return I=$(this,I),L(I)?-1:k(I)?0:1};function N(I){const p=I.g.length,g=[];for(let v=0;v<p;v++)g[v]=~I.g[v];return new a(g,~I.h).add(S)}n.abs=function(){return L(this)?N(this):this},n.add=function(I){const p=Math.max(this.g.length,I.g.length),g=[];let v=0;for(let y=0;y<=p;y++){let w=v+(this.i(y)&65535)+(I.i(y)&65535),m=(w>>>16)+(this.i(y)>>>16)+(I.i(y)>>>16);v=m>>>16,w&=65535,m&=65535,g[y]=m<<16|w}return new a(g,g[g.length-1]&-2147483648?-1:0)};function $(I,p){return I.add(N(p))}n.j=function(I){if(k(this)||k(I))return E;if(L(this))return L(I)?N(this).j(N(I)):N(N(this).j(I));if(L(I))return N(this.j(N(I)));if(this.l(P)<0&&I.l(P)<0)return f(this.m()*I.m());const p=this.g.length+I.g.length,g=[];for(var v=0;v<2*p;v++)g[v]=0;for(v=0;v<this.g.length;v++)for(let y=0;y<I.g.length;y++){const w=this.i(v)>>>16,m=this.i(v)&65535,Ie=I.i(y)>>>16,pt=I.i(y)&65535;g[2*v+2*y]+=m*pt,q(g,2*v+2*y),g[2*v+2*y+1]+=w*pt,q(g,2*v+2*y+1),g[2*v+2*y+1]+=m*Ie,q(g,2*v+2*y+1),g[2*v+2*y+2]+=w*Ie,q(g,2*v+2*y+2)}for(I=0;I<p;I++)g[I]=g[2*I+1]<<16|g[2*I];for(I=p;I<2*p;I++)g[I]=0;return new a(g,0)};function q(I,p){for(;(I[p]&65535)!=I[p];)I[p+1]+=I[p]>>>16,I[p]&=65535,p++}function K(I,p){this.g=I,this.h=p}function we(I,p){if(k(p))throw Error("division by zero");if(k(I))return new K(E,E);if(L(I))return p=we(N(I),p),new K(N(p.g),N(p.h));if(L(p))return p=we(I,N(p)),new K(N(p.g),p.h);if(I.g.length>30){if(L(I)||L(p))throw Error("slowDivide_ only works with positive integers.");for(var g=S,v=p;v.l(I)<=0;)g=Se(g),v=Se(v);var y=_e(g,1),w=_e(v,1);for(v=_e(v,2),g=_e(g,2);!k(v);){var m=w.add(v);m.l(I)<=0&&(y=y.add(g),w=m),v=_e(v,1),g=_e(g,1)}return p=$(I,y.j(p)),new K(y,p)}for(y=E;I.l(p)>=0;){for(g=Math.max(1,Math.floor(I.m()/p.m())),v=Math.ceil(Math.log(g)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),w=f(g),m=w.j(p);L(m)||m.l(I)>0;)g-=v,w=f(g),m=w.j(p);k(w)&&(w=S),y=y.add(w),I=$(I,m)}return new K(y,I)}n.B=function(I){return we(this,I).h},n.and=function(I){const p=Math.max(this.g.length,I.g.length),g=[];for(let v=0;v<p;v++)g[v]=this.i(v)&I.i(v);return new a(g,this.h&I.h)},n.or=function(I){const p=Math.max(this.g.length,I.g.length),g=[];for(let v=0;v<p;v++)g[v]=this.i(v)|I.i(v);return new a(g,this.h|I.h)},n.xor=function(I){const p=Math.max(this.g.length,I.g.length),g=[];for(let v=0;v<p;v++)g[v]=this.i(v)^I.i(v);return new a(g,this.h^I.h)};function Se(I){const p=I.g.length+1,g=[];for(let v=0;v<p;v++)g[v]=I.i(v)<<1|I.i(v-1)>>>31;return new a(g,I.h)}function _e(I,p){const g=p>>5;p%=32;const v=I.g.length-g,y=[];for(let w=0;w<v;w++)y[w]=p>0?I.i(w+g)>>>p|I.i(w+g+1)<<32-p:I.i(w+g);return new a(y,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=_,wi=a}).apply(typeof wa<"u"?wa:typeof self<"u"?self:typeof window<"u"?window:{});var hr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var sl,An,il,Tr,Xs,ol,al,cl;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof hr=="object"&&hr];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var l=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var T=i[d];if(!(T in l))break e;l=l[T]}i=i[i.length-1],d=l[i],c=c(d),c!=d&&c!=null&&e(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&l.push([d,c[d]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function f(i,c,l){return f=h,f.apply(null,arguments)}function _(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var d=l.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function E(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(d,T,A){for(var C=Array(arguments.length-2),x=2;x<arguments.length;x++)C[x-2]=arguments[x];return c.prototype[T].apply(d,C)}}var S=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function P(i){const c=i.length;if(c>0){const l=Array(c);for(let d=0;d<c;d++)l[d]=i[d];return l}return[]}function k(i,c){for(let d=1;d<arguments.length;d++){const T=arguments[d];var l=typeof T;if(l=l!="object"?l:T?Array.isArray(T)?"array":l:"null",l=="array"||l=="object"&&typeof T.length=="number"){l=i.length||0;const A=T.length||0;i.length=l+A;for(let C=0;C<A;C++)i[l+C]=T[C]}else i.push(T)}}class L{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function N(i){a.setTimeout(()=>{throw i},0)}function $(){var i=I;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class q{constructor(){this.h=this.g=null}add(c,l){const d=K.get();d.set(c,l),this.h?this.h.next=d:this.g=d,this.h=d}}var K=new L(()=>new we,i=>i.reset());class we{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Se,_e=!1,I=new q,p=()=>{const i=Promise.resolve(void 0);Se=()=>{i.then(g)}};function g(){for(var i;i=$();){try{i.h.call(i.g)}catch(l){N(l)}var c=K;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}_e=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function m(i){return/^[\s\xa0]*$/.test(i)}function Ie(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(Ie,y),Ie.prototype.init=function(i,c){const l=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Ie.Z.h.call(this)},Ie.prototype.h=function(){Ie.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var pt="closure_listenable_"+(Math.random()*1e6|0),_u=0;function yu(i,c,l,d,T){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!d,this.ha=T,this.key=++_u,this.da=this.fa=!1}function Qn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Jn(i,c,l){for(const d in i)c.call(l,i[d],d,i)}function Eu(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function Wi(i){const c={};for(const l in i)c[l]=i[l];return c}const Ki="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qi(i,c){let l,d;for(let T=1;T<arguments.length;T++){d=arguments[T];for(l in d)i[l]=d[l];for(let A=0;A<Ki.length;A++)l=Ki[A],Object.prototype.hasOwnProperty.call(d,l)&&(i[l]=d[l])}}function Xn(i){this.src=i,this.g={},this.h=0}Xn.prototype.add=function(i,c,l,d,T){const A=i.toString();i=this.g[A],i||(i=this.g[A]=[],this.h++);const C=ls(i,c,d,T);return C>-1?(c=i[C],l||(c.fa=!1)):(c=new yu(c,this.src,A,!!d,T),c.fa=l,i.push(c)),c};function cs(i,c){const l=c.type;if(l in i.g){var d=i.g[l],T=Array.prototype.indexOf.call(d,c,void 0),A;(A=T>=0)&&Array.prototype.splice.call(d,T,1),A&&(Qn(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function ls(i,c,l,d){for(let T=0;T<i.length;++T){const A=i[T];if(!A.da&&A.listener==c&&A.capture==!!l&&A.ha==d)return T}return-1}var us="closure_lm_"+(Math.random()*1e6|0),hs={};function Ji(i,c,l,d,T){if(Array.isArray(c)){for(let A=0;A<c.length;A++)Ji(i,c[A],l,d,T);return null}return l=Zi(l),i&&i[pt]?i.J(c,l,u(d)?!!d.capture:!1,T):Iu(i,c,l,!1,d,T)}function Iu(i,c,l,d,T,A){if(!c)throw Error("Invalid event type");const C=u(T)?!!T.capture:!!T;let x=fs(i);if(x||(i[us]=x=new Xn(i)),l=x.add(c,l,d,C,A),l.proxy)return l;if(d=vu(),l.proxy=d,d.src=i,d.listener=l,i.addEventListener)w||(T=C),T===void 0&&(T=!1),i.addEventListener(c.toString(),d,T);else if(i.attachEvent)i.attachEvent(Yi(c.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return l}function vu(){function i(l){return c.call(i.src,i.listener,l)}const c=Tu;return i}function Xi(i,c,l,d,T){if(Array.isArray(c))for(var A=0;A<c.length;A++)Xi(i,c[A],l,d,T);else d=u(d)?!!d.capture:!!d,l=Zi(l),i&&i[pt]?(i=i.i,A=String(c).toString(),A in i.g&&(c=i.g[A],l=ls(c,l,d,T),l>-1&&(Qn(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[A],i.h--)))):i&&(i=fs(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ls(c,l,d,T)),(l=i>-1?c[i]:null)&&ds(l))}function ds(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[pt])cs(c.i,i);else{var l=i.type,d=i.proxy;c.removeEventListener?c.removeEventListener(l,d,i.capture):c.detachEvent?c.detachEvent(Yi(l),d):c.addListener&&c.removeListener&&c.removeListener(d),(l=fs(c))?(cs(l,i),l.h==0&&(l.src=null,c[us]=null)):Qn(i)}}}function Yi(i){return i in hs?hs[i]:hs[i]="on"+i}function Tu(i,c){if(i.da)i=!0;else{c=new Ie(c,this);const l=i.listener,d=i.ha||i.src;i.fa&&ds(i),i=l.call(d,c)}return i}function fs(i){return i=i[us],i instanceof Xn?i:null}var ps="__closure_events_fn_"+(Math.random()*1e9>>>0);function Zi(i){return typeof i=="function"?i:(i[ps]||(i[ps]=function(c){return i.handleEvent(c)}),i[ps])}function ue(){v.call(this),this.i=new Xn(this),this.M=this,this.G=null}E(ue,v),ue.prototype[pt]=!0,ue.prototype.removeEventListener=function(i,c,l,d){Xi(this,i,c,l,d)};function ye(i,c){var l,d=i.G;if(d)for(l=[];d;d=d.G)l.push(d);if(i=i.M,d=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var T=c;c=new y(d,i),Qi(c,T)}T=!0;let A,C;if(l)for(C=l.length-1;C>=0;C--)A=c.g=l[C],T=Yn(A,d,!0,c)&&T;if(A=c.g=i,T=Yn(A,d,!0,c)&&T,T=Yn(A,d,!1,c)&&T,l)for(C=0;C<l.length;C++)A=c.g=l[C],T=Yn(A,d,!1,c)&&T}ue.prototype.N=function(){if(ue.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let d=0;d<l.length;d++)Qn(l[d]);delete i.g[c],i.h--}}this.G=null},ue.prototype.J=function(i,c,l,d){return this.i.add(String(i),c,!1,l,d)},ue.prototype.K=function(i,c,l,d){return this.i.add(String(i),c,!0,l,d)};function Yn(i,c,l,d){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let T=!0;for(let A=0;A<c.length;++A){const C=c[A];if(C&&!C.da&&C.capture==l){const x=C.listener,ne=C.ha||C.src;C.fa&&cs(i.i,C),T=x.call(ne,d)!==!1&&T}}return T&&!d.defaultPrevented}function wu(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function eo(i){i.g=wu(()=>{i.g=null,i.i&&(i.i=!1,eo(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Au extends v{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:eo(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function on(i){v.call(this),this.h=i,this.g={}}E(on,v);var to=[];function no(i){Jn(i.g,function(c,l){this.g.hasOwnProperty(l)&&ds(c)},i),i.g={}}on.prototype.N=function(){on.Z.N.call(this),no(this)},on.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ms=a.JSON.stringify,Su=a.JSON.parse,bu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function ro(){}function so(){}var an={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function gs(){y.call(this,"d")}E(gs,y);function _s(){y.call(this,"c")}E(_s,y);var mt={},io=null;function Zn(){return io=io||new ue}mt.Ia="serverreachability";function oo(i){y.call(this,mt.Ia,i)}E(oo,y);function cn(i){const c=Zn();ye(c,new oo(c))}mt.STAT_EVENT="statevent";function ao(i,c){y.call(this,mt.STAT_EVENT,i),this.stat=c}E(ao,y);function Ee(i){const c=Zn();ye(c,new ao(c,i))}mt.Ja="timingevent";function co(i,c){y.call(this,mt.Ja,i),this.size=c}E(co,y);function ln(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function un(){this.g=!0}un.prototype.ua=function(){this.g=!1};function Ru(i,c,l,d,T,A){i.info(function(){if(i.g)if(A){var C="",x=A.split("&");for(let H=0;H<x.length;H++){var ne=x[H].split("=");if(ne.length>1){const re=ne[0];ne=ne[1];const Le=re.split("_");C=Le.length>=2&&Le[1]=="type"?C+(re+"="+ne+"&"):C+(re+"=redacted&")}}}else C=null;else C=A;return"XMLHTTP REQ ("+d+") [attempt "+T+"]: "+c+`
`+l+`
`+C})}function Cu(i,c,l,d,T,A,C){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+T+"]: "+c+`
`+l+`
`+A+" "+C})}function Mt(i,c,l,d){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+ku(i,l)+(d?" "+d:"")})}function Pu(i,c){i.info(function(){return"TIMEOUT: "+c})}un.prototype.info=function(){};function ku(i,c){if(!i.g)return c;if(!c)return null;try{const A=JSON.parse(c);if(A){for(i=0;i<A.length;i++)if(Array.isArray(A[i])){var l=A[i];if(!(l.length<2)){var d=l[1];if(Array.isArray(d)&&!(d.length<1)){var T=d[0];if(T!="noop"&&T!="stop"&&T!="close")for(let C=1;C<d.length;C++)d[C]=""}}}}return ms(A)}catch{return c}}var er={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},lo={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},uo;function ys(){}E(ys,ro),ys.prototype.g=function(){return new XMLHttpRequest},uo=new ys;function hn(i){return encodeURIComponent(String(i))}function Du(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Je(i,c,l,d){this.j=i,this.i=c,this.l=l,this.S=d||1,this.V=new on(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ho}function ho(){this.i=null,this.g="",this.h=!1}var fo={},Es={};function Is(i,c,l){i.M=1,i.A=nr(Oe(c)),i.u=l,i.R=!0,po(i,null)}function po(i,c){i.F=Date.now(),tr(i),i.B=Oe(i.A);var l=i.B,d=i.S;Array.isArray(d)||(d=[String(d)]),Ro(l.i,"t",d),i.C=0,l=i.j.L,i.h=new ho,i.g=zo(i.j,l?c:null,!i.u),i.P>0&&(i.O=new Au(f(i.Y,i,i.g),i.P)),c=i.V,l=i.g,d=i.ba;var T="readystatechange";Array.isArray(T)||(T&&(to[0]=T.toString()),T=to);for(let A=0;A<T.length;A++){const C=Ji(l,T[A],d||c.handleEvent,!1,c.h||c);if(!C)break;c.g[C.key]=C}c=i.J?Wi(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),cn(),Ru(i.i,i.v,i.B,i.l,i.S,i.u)}Je.prototype.ba=function(i){i=i.target;const c=this.O;c&&Ze(i)==3?c.j():this.Y(i)},Je.prototype.Y=function(i){try{if(i==this.g)e:{const x=Ze(this.g),ne=this.g.ya(),H=this.g.ca();if(!(x<3)&&(x!=3||this.g&&(this.h.h||this.g.la()||Oo(this.g)))){this.K||x!=4||ne==7||(ne==8||H<=0?cn(3):cn(2)),vs(this);var c=this.g.ca();this.X=c;var l=Nu(this);if(this.o=c==200,Cu(this.i,this.v,this.B,this.l,this.S,x,c),this.o){if(this.U&&!this.L){t:{if(this.g){var d,T=this.g;if((d=T.g?T.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(d)){var A=d;break t}}A=null}if(i=A)Mt(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ts(this,i);else{this.o=!1,this.m=3,Ee(12),gt(this),dn(this);break e}}if(this.R){i=!0;let re;for(;!this.K&&this.C<l.length;)if(re=Vu(this,l),re==Es){x==4&&(this.m=4,Ee(14),i=!1),Mt(this.i,this.l,null,"[Incomplete Response]");break}else if(re==fo){this.m=4,Ee(15),Mt(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Mt(this.i,this.l,re,null),Ts(this,re);if(mo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),x!=4||l.length!=0||this.h.h||(this.m=1,Ee(16),i=!1),this.o=this.o&&i,!i)Mt(this.i,this.l,l,"[Invalid Chunked Response]"),gt(this),dn(this);else if(l.length>0&&!this.W){this.W=!0;var C=this.j;C.g==this&&C.aa&&!C.P&&(C.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),ks(C),C.P=!0,Ee(11))}}else Mt(this.i,this.l,l,null),Ts(this,l);x==4&&gt(this),this.o&&!this.K&&(x==4?jo(this.j,this):(this.o=!1,tr(this)))}else Wu(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,Ee(12)):(this.m=0,Ee(13)),gt(this),dn(this)}}}catch{}finally{}};function Nu(i){if(!mo(i))return i.g.la();const c=Oo(i.g);if(c==="")return"";let l="";const d=c.length,T=Ze(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return gt(i),dn(i),"";i.h.i=new a.TextDecoder}for(let A=0;A<d;A++)i.h.h=!0,l+=i.h.i.decode(c[A],{stream:!(T&&A==d-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function mo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Vu(i,c){var l=i.C,d=c.indexOf(`
`,l);return d==-1?Es:(l=Number(c.substring(l,d)),isNaN(l)?fo:(d+=1,d+l>c.length?Es:(c=c.slice(d,d+l),i.C=d+l,c)))}Je.prototype.cancel=function(){this.K=!0,gt(this)};function tr(i){i.T=Date.now()+i.H,go(i,i.H)}function go(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=ln(f(i.aa,i),c)}function vs(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Je.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Pu(this.i,this.B),this.M!=2&&(cn(),Ee(17)),gt(this),this.m=2,dn(this)):go(this,this.T-i)};function dn(i){i.j.I==0||i.K||jo(i.j,i)}function gt(i){vs(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,no(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Ts(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||ws(l.h,i))){if(!i.L&&ws(l.h,i)&&l.I==3){try{var d=l.Ba.g.parse(c)}catch{d=null}if(Array.isArray(d)&&d.length==3){var T=d;if(T[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)ar(l),ir(l);else break e;Ps(l),Ee(18)}}else l.xa=T[1],0<l.xa-l.K&&T[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=ln(f(l.Va,l),6e3));Eo(l.h)<=1&&l.ta&&(l.ta=void 0)}else yt(l,11)}else if((i.L||l.g==i)&&ar(l),!m(c))for(T=l.Ba.g.parse(c),c=0;c<T.length;c++){let H=T[c];const re=H[0];if(!(re<=l.K))if(l.K=re,H=H[1],l.I==2)if(H[0]=="c"){l.M=H[1],l.ba=H[2];const Le=H[3];Le!=null&&(l.ka=Le,l.j.info("VER="+l.ka));const Et=H[4];Et!=null&&(l.za=Et,l.j.info("SVER="+l.za));const et=H[5];et!=null&&typeof et=="number"&&et>0&&(d=1.5*et,l.O=d,l.j.info("backChannelRequestTimeoutMs_="+d)),d=l;const tt=i.g;if(tt){const lr=tt.g?tt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(lr){var A=d.h;A.g||lr.indexOf("spdy")==-1&&lr.indexOf("quic")==-1&&lr.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(As(A,A.h),A.h=null))}if(d.G){const Ds=tt.g?tt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ds&&(d.wa=Ds,W(d.J,d.G,Ds))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),d=l;var C=i;if(d.na=Ho(d,d.L?d.ba:null,d.W),C.L){Io(d.h,C);var x=C,ne=d.O;ne&&(x.H=ne),x.D&&(vs(x),tr(x)),d.g=C}else Fo(d);l.i.length>0&&or(l)}else H[0]!="stop"&&H[0]!="close"||yt(l,7);else l.I==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?yt(l,7):Cs(l):H[0]!="noop"&&l.l&&l.l.qa(H),l.A=0)}}cn(4)}catch{}}var Ou=class{constructor(i,c){this.g=i,this.map=c}};function _o(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function yo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Eo(i){return i.h?1:i.g?i.g.size:0}function ws(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function As(i,c){i.g?i.g.add(c):i.h=c}function Io(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}_o.prototype.cancel=function(){if(this.i=vo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function vo(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return P(i.i)}var To=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Lu(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const d=i[l].indexOf("=");let T,A=null;d>=0?(T=i[l].substring(0,d),A=i[l].substring(d+1)):T=i[l],c(T,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Xe(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Xe?(this.l=i.l,fn(this,i.j),this.o=i.o,this.g=i.g,pn(this,i.u),this.h=i.h,Ss(this,Co(i.i)),this.m=i.m):i&&(c=String(i).match(To))?(this.l=!1,fn(this,c[1]||"",!0),this.o=mn(c[2]||""),this.g=mn(c[3]||"",!0),pn(this,c[4]),this.h=mn(c[5]||"",!0),Ss(this,c[6]||"",!0),this.m=mn(c[7]||"")):(this.l=!1,this.i=new _n(null,this.l))}Xe.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(gn(c,wo,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(gn(c,wo,!0),"@"),i.push(hn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(gn(l,l.charAt(0)=="/"?Uu:xu,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",gn(l,Bu)),i.join("")},Xe.prototype.resolve=function(i){const c=Oe(this);let l=!!i.j;l?fn(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var d=i.h;if(l)pn(c,i.u);else if(l=!!i.h){if(d.charAt(0)!="/")if(this.g&&!this.h)d="/"+d;else{var T=c.h.lastIndexOf("/");T!=-1&&(d=c.h.slice(0,T+1)+d)}if(T=d,T==".."||T==".")d="";else if(T.indexOf("./")!=-1||T.indexOf("/.")!=-1){d=T.lastIndexOf("/",0)==0,T=T.split("/");const A=[];for(let C=0;C<T.length;){const x=T[C++];x=="."?d&&C==T.length&&A.push(""):x==".."?((A.length>1||A.length==1&&A[0]!="")&&A.pop(),d&&C==T.length&&A.push("")):(A.push(x),d=!0)}d=A.join("/")}else d=T}return l?c.h=d:l=i.i.toString()!=="",l?Ss(c,Co(i.i)):l=!!i.m,l&&(c.m=i.m),c};function Oe(i){return new Xe(i)}function fn(i,c,l){i.j=l?mn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function pn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Ss(i,c,l){c instanceof _n?(i.i=c,ju(i.i,i.l)):(l||(c=gn(c,Fu)),i.i=new _n(c,i.l))}function W(i,c,l){i.i.set(c,l)}function nr(i){return W(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function mn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function gn(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,Mu),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Mu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var wo=/[#\/\?@]/g,xu=/[#\?:]/g,Uu=/[#\?]/g,Fu=/[#\?@]/g,Bu=/#/g;function _n(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function _t(i){i.g||(i.g=new Map,i.h=0,i.i&&Lu(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=_n.prototype,n.add=function(i,c){_t(this),this.i=null,i=xt(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function Ao(i,c){_t(i),c=xt(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function So(i,c){return _t(i),c=xt(i,c),i.g.has(c)}n.forEach=function(i,c){_t(this),this.g.forEach(function(l,d){l.forEach(function(T){i.call(c,T,d,this)},this)},this)};function bo(i,c){_t(i);let l=[];if(typeof c=="string")So(i,c)&&(l=l.concat(i.g.get(xt(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return _t(this),this.i=null,i=xt(this,i),So(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=bo(this,i),i.length>0?String(i[0]):c):c};function Ro(i,c,l){Ao(i,c),l.length>0&&(i.i=null,i.g.set(xt(i,c),P(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let d=0;d<c.length;d++){var l=c[d];const T=hn(l);l=bo(this,l);for(let A=0;A<l.length;A++){let C=T;l[A]!==""&&(C+="="+hn(l[A])),i.push(C)}}return this.i=i.join("&")};function Co(i){const c=new _n;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function xt(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function ju(i,c){c&&!i.j&&(_t(i),i.i=null,i.g.forEach(function(l,d){const T=d.toLowerCase();d!=T&&(Ao(this,d),Ro(this,T,l))},i)),i.j=c}function $u(i,c){const l=new un;if(a.Image){const d=new Image;d.onload=_(Ye,l,"TestLoadImage: loaded",!0,c,d),d.onerror=_(Ye,l,"TestLoadImage: error",!1,c,d),d.onabort=_(Ye,l,"TestLoadImage: abort",!1,c,d),d.ontimeout=_(Ye,l,"TestLoadImage: timeout",!1,c,d),a.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else c(!1)}function qu(i,c){const l=new un,d=new AbortController,T=setTimeout(()=>{d.abort(),Ye(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:d.signal}).then(A=>{clearTimeout(T),A.ok?Ye(l,"TestPingServer: ok",!0,c):Ye(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(T),Ye(l,"TestPingServer: error",!1,c)})}function Ye(i,c,l,d,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),d(l)}catch{}}function Hu(){this.g=new bu}function bs(i){this.i=i.Sb||null,this.h=i.ab||!1}E(bs,ro),bs.prototype.g=function(){return new rr(this.i,this.h)};function rr(i,c){ue.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(rr,ue),n=rr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,En(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,yn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Po(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Po(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?yn(this):En(this),this.readyState==3&&Po(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,yn(this))},n.Na=function(i){this.g&&(this.response=i,yn(this))},n.ga=function(){this.g&&yn(this)};function yn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,En(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function En(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(rr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ko(i){let c="";return Jn(i,function(l,d){c+=d,c+=":",c+=l,c+=`\r
`}),c}function Rs(i,c,l){e:{for(d in l){var d=!1;break e}d=!0}d||(l=ko(l),typeof i=="string"?l!=null&&hn(l):W(i,c,l))}function Y(i){ue.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(Y,ue);var zu=/^https?$/i,Gu=["POST","PUT"];n=Y.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():uo.g(),this.g.onreadystatechange=S(f(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(A){Do(this,A);return}if(i=l||"",l=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var T in d)l.set(T,d[T]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(const A of d.keys())l.set(A,d.get(A));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(l.keys()).find(A=>A.toLowerCase()=="content-type"),T=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Gu,c,void 0)>=0)||d||T||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[A,C]of l)this.g.setRequestHeader(A,C);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(A){Do(this,A)}};function Do(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,No(i),sr(i)}function No(i){i.A||(i.A=!0,ye(i,"complete"),ye(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,ye(this,"complete"),ye(this,"abort"),sr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),sr(this,!0)),Y.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Vo(this):this.Xa())},n.Xa=function(){Vo(this)};function Vo(i){if(i.h&&typeof o<"u"){if(i.v&&Ze(i)==4)setTimeout(i.Ca.bind(i),0);else if(ye(i,"readystatechange"),Ze(i)==4){i.h=!1;try{const A=i.ca();e:switch(A){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var d;if(d=A===0){let C=String(i.D).match(To)[1]||null;!C&&a.self&&a.self.location&&(C=a.self.location.protocol.slice(0,-1)),d=!zu.test(C?C.toLowerCase():"")}l=d}if(l)ye(i,"complete"),ye(i,"success");else{i.o=6;try{var T=Ze(i)>2?i.g.statusText:""}catch{T=""}i.l=T+" ["+i.ca()+"]",No(i)}}finally{sr(i)}}}}function sr(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||ye(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ze(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Ze(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Su(c)}};function Oo(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Wu(i){const c={};i=(i.g&&Ze(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(m(i[d]))continue;var l=Du(i[d]);const T=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const A=c[T]||[];c[T]=A,A.push(l)}Eu(c,function(d){return d.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function In(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function Lo(i){this.za=0,this.i=[],this.j=new un,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=In("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=In("baseRetryDelayMs",5e3,i),this.Za=In("retryDelaySeedMs",1e4,i),this.Ta=In("forwardChannelMaxRetries",2,i),this.va=In("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new _o(i&&i.concurrentRequestLimit),this.Ba=new Hu,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Lo.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,d){Ee(0),this.W=i,this.H=c||{},l&&d!==void 0&&(this.H.OSID=l,this.H.OAID=d),this.F=this.X,this.J=Ho(this,null,this.W),or(this)};function Cs(i){if(Mo(i),i.I==3){var c=i.V++,l=Oe(i.J);if(W(l,"SID",i.M),W(l,"RID",c),W(l,"TYPE","terminate"),vn(i,l),c=new Je(i,i.j,c),c.M=2,c.A=nr(Oe(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=zo(c.j,null),c.g.ea(c.A)),c.F=Date.now(),tr(c)}qo(i)}function ir(i){i.g&&(ks(i),i.g.cancel(),i.g=null)}function Mo(i){ir(i),i.v&&(a.clearTimeout(i.v),i.v=null),ar(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function or(i){if(!yo(i.h)&&!i.m){i.m=!0;var c=i.Ea;Se||p(),_e||(Se(),_e=!0),I.add(c,i),i.D=0}}function Ku(i,c){return Eo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=ln(f(i.Ea,i,c),$o(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const T=new Je(this,this.j,i);let A=this.o;if(this.U&&(A?(A=Wi(A),Qi(A,this.U)):A=this.U),this.u!==null||this.R||(T.J=A,A=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var d=this.i[l];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break t}d=void 0}if(d===void 0)break;if(c+=d,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Uo(this,T,c),l=Oe(this.J),W(l,"RID",i),W(l,"CVER",22),this.G&&W(l,"X-HTTP-Session-Id",this.G),vn(this,l),A&&(this.R?c="headers="+hn(ko(A))+"&"+c:this.u&&Rs(l,this.u,A)),As(this.h,T),this.Ra&&W(l,"TYPE","init"),this.S?(W(l,"$req",c),W(l,"SID","null"),T.U=!0,Is(T,l,null)):Is(T,l,c),this.I=2}}else this.I==3&&(i?xo(this,i):this.i.length==0||yo(this.h)||xo(this))};function xo(i,c){var l;c?l=c.l:l=i.V++;const d=Oe(i.J);W(d,"SID",i.M),W(d,"RID",l),W(d,"AID",i.K),vn(i,d),i.u&&i.o&&Rs(d,i.u,i.o),l=new Je(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Uo(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),As(i.h,l),Is(l,d,c)}function vn(i,c){i.H&&Jn(i.H,function(l,d){W(c,d,l)}),i.l&&Jn({},function(l,d){W(c,d,l)})}function Uo(i,c,l){l=Math.min(i.i.length,l);const d=i.l?f(i.l.Ka,i.l,i):null;e:{var T=i.i;let x=-1;for(;;){const ne=["count="+l];x==-1?l>0?(x=T[0].g,ne.push("ofs="+x)):x=0:ne.push("ofs="+x);let H=!0;for(let re=0;re<l;re++){var A=T[re].g;const Le=T[re].map;if(A-=x,A<0)x=Math.max(0,T[re].g-100),H=!1;else try{A="req"+A+"_"||"";try{var C=Le instanceof Map?Le:Object.entries(Le);for(const[Et,et]of C){let tt=et;u(et)&&(tt=ms(et)),ne.push(A+Et+"="+encodeURIComponent(tt))}}catch(Et){throw ne.push(A+"type="+encodeURIComponent("_badmap")),Et}}catch{d&&d(Le)}}if(H){C=ne.join("&");break e}}C=void 0}return i=i.i.splice(0,l),c.G=i,C}function Fo(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;Se||p(),_e||(Se(),_e=!0),I.add(c,i),i.A=0}}function Ps(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=ln(f(i.Da,i),$o(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Bo(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=ln(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ee(10),ir(this),Bo(this))};function ks(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Bo(i){i.g=new Je(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Oe(i.na);W(c,"RID","rpc"),W(c,"SID",i.M),W(c,"AID",i.K),W(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&W(c,"TO",i.ia),W(c,"TYPE","xmlhttp"),vn(i,c),i.u&&i.o&&Rs(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=nr(Oe(c)),l.u=null,l.R=!0,po(l,i)}n.Va=function(){this.C!=null&&(this.C=null,ir(this),Ps(this),Ee(19))};function ar(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function jo(i,c){var l=null;if(i.g==c){ar(i),ks(i),i.g=null;var d=2}else if(ws(i.h,c))l=c.G,Io(i.h,c),d=1;else return;if(i.I!=0){if(c.o)if(d==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var T=i.D;d=Zn(),ye(d,new co(d,l)),or(i)}else Fo(i);else if(T=c.m,T==3||T==0&&c.X>0||!(d==1&&Ku(i,c)||d==2&&Ps(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),T){case 1:yt(i,5);break;case 4:yt(i,10);break;case 3:yt(i,6);break;default:yt(i,2)}}}function $o(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function yt(i,c){if(i.j.info("Error code "+c),c==2){var l=f(i.bb,i),d=i.Ua;const T=!d;d=new Xe(d||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||fn(d,"https"),nr(d),T?$u(d.toString(),l):qu(d.toString(),l)}else Ee(2);i.I=0,i.l&&i.l.pa(c),qo(i),Mo(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Ee(2)):(this.j.info("Failed to ping google.com"),Ee(1))};function qo(i){if(i.I=0,i.ja=[],i.l){const c=vo(i.h);(c.length!=0||i.i.length!=0)&&(k(i.ja,c),k(i.ja,i.i),i.h.i.length=0,P(i.i),i.i.length=0),i.l.oa()}}function Ho(i,c,l){var d=l instanceof Xe?Oe(l):new Xe(l);if(d.g!="")c&&(d.g=c+"."+d.g),pn(d,d.u);else{var T=a.location;d=T.protocol,c=c?c+"."+T.hostname:T.hostname,T=+T.port;const A=new Xe(null);d&&fn(A,d),c&&(A.g=c),T&&pn(A,T),l&&(A.h=l),d=A}return l=i.G,c=i.wa,l&&c&&W(d,l,c),W(d,"VER",i.ka),vn(i,d),d}function zo(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Y(new bs({ab:l})):new Y(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Go(){}n=Go.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function cr(){}cr.prototype.g=function(i,c){return new Ae(i,c)};function Ae(i,c){ue.call(this),this.g=new Lo(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!m(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!m(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Ut(this)}E(Ae,ue),Ae.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){Cs(this.g)},Ae.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=ms(i),i=l);c.i.push(new Ou(c.Ya++,i)),c.I==3&&or(c)},Ae.prototype.N=function(){this.g.l=null,delete this.j,Cs(this.g),delete this.g,Ae.Z.N.call(this)};function Wo(i){gs.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const l in c){i=l;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E(Wo,gs);function Ko(){_s.call(this),this.status=1}E(Ko,_s);function Ut(i){this.g=i}E(Ut,Go),Ut.prototype.ra=function(){ye(this.g,"a")},Ut.prototype.qa=function(i){ye(this.g,new Wo(i))},Ut.prototype.pa=function(i){ye(this.g,new Ko)},Ut.prototype.oa=function(){ye(this.g,"b")},cr.prototype.createWebChannel=cr.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,cl=function(){return new cr},al=function(){return Zn()},ol=mt,Xs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},er.NO_ERROR=0,er.TIMEOUT=8,er.HTTP_ERROR=6,Tr=er,lo.COMPLETE="complete",il=lo,so.EventType=an,an.OPEN="a",an.CLOSE="b",an.ERROR="c",an.MESSAGE="d",ue.prototype.listen=ue.prototype.J,An=so,Y.prototype.listenOnce=Y.prototype.K,Y.prototype.getLastError=Y.prototype.Ha,Y.prototype.getLastErrorCode=Y.prototype.ya,Y.prototype.getStatus=Y.prototype.ca,Y.prototype.getResponseJson=Y.prototype.La,Y.prototype.getResponseText=Y.prototype.la,Y.prototype.send=Y.prototype.ea,Y.prototype.setWithCredentials=Y.prototype.Fa,sl=Y}).apply(typeof hr<"u"?hr:typeof self<"u"?self:typeof window<"u"?window:{});const Aa="@firebase/firestore",Sa="4.9.2";class de{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}de.UNAUTHENTICATED=new de(null),de.GOOGLE_CREDENTIALS=new de("google-credentials-uid"),de.FIRST_PARTY=new de("first-party-uid"),de.MOCK_USER=new de("mock-user");let rn="12.3.0";const kt=new ui("@firebase/firestore");function Ft(){return kt.logLevel}function D(n,...e){if(kt.logLevel<=F.DEBUG){const t=e.map(Ai);kt.debug(`Firestore (${rn}): ${n}`,...t)}}function Dt(n,...e){if(kt.logLevel<=F.ERROR){const t=e.map(Ai);kt.error(`Firestore (${rn}): ${n}`,...t)}}function Zr(n,...e){if(kt.logLevel<=F.WARN){const t=e.map(Ai);kt.warn(`Firestore (${rn}): ${n}`,...t)}}function Ai(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function U(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,ll(n,r,t)}function ll(n,e,t){let r=`FIRESTORE (${rn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Dt(r),new Error(r)}function Z(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||ll(e,s,r)}function G(n,e){return n}const R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends Qe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class St{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ul{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qp{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(de.UNAUTHENTICATED)))}shutdown(){}}class Hp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class zp{constructor(e){this.t=e,this.currentUser=de.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Z(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new St;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new St,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new St)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Z(typeof r.accessToken=="string",31837,{l:r}),new ul(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Z(e===null||typeof e=="string",2055,{h:e}),new de(e)}}class Gp{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=de.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Wp{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Gp(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(de.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ba{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Kp{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Re(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Z(this.o===void 0,3512);const r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ba(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Z(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ba(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Qp(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Si{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Qp(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function j(n,e){return n<e?-1:n>e?1:0}function Ys(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Fs(s)===Fs(o)?j(s,o):Fs(s)?1:-1}return j(n.length,e.length)}const Jp=55296,Xp=57343;function Fs(n){const e=n.charCodeAt(0);return e>=Jp&&e<=Xp}function Qt(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const Ra="__name__";class Me{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&U(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Me.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Me?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=Me.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return j(e.length,t.length)}static compareSegments(e,t){const r=Me.isNumericId(e),s=Me.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Me.extractNumericId(e).compare(Me.extractNumericId(t)):Ys(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return wi.fromString(e.substring(4,e.length-2))}}class X extends Me{construct(e,t,r){return new X(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new V(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new X(t)}static emptyPath(){return new X([])}}const Yp=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ce extends Me{construct(e,t,r){return new ce(e,t,r)}static isValidIdentifier(e){return Yp.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ce.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ra}static keyField(){return new ce([Ra])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new V(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new V(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new V(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ce(t)}static emptyPath(){return new ce([])}}class M{constructor(e){this.path=e}static fromPath(e){return new M(X.fromString(e))}static fromName(e){return new M(X.fromString(e).popFirst(5))}static empty(){return new M(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new M(new X(e.slice()))}}function hl(n,e,t){if(!t)throw new V(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Zp(n,e,t,r){if(e===!0&&r===!0)throw new V(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ca(n){if(!M.isDocumentKey(n))throw new V(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Pa(n){if(M.isDocumentKey(n))throw new V(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function dl(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function bi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U(12329,{type:typeof n})}function fl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bi(n);throw new V(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function te(n,e){const t={typeString:n};return e&&(t.value=e),t}function qn(n,e){if(!dl(n))throw new V(R.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new V(R.INVALID_ARGUMENT,t);return!0}const ka=-62135596800,Da=1e6;class J{static now(){return J.fromMillis(Date.now())}static fromDate(e){return J.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Da);return new J(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ka)throw new V(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Da}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:J._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(qn(e,J._jsonSchema))return new J(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ka;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}J._jsonSchemaVersion="firestore/timestamp/1.0",J._jsonSchema={type:te("string",J._jsonSchemaVersion),seconds:te("number"),nanoseconds:te("number")};class Q{static fromTimestamp(e){return new Q(e)}static min(){return new Q(new J(0,0))}static max(){return new Q(new J(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const On=-1;function em(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Q.fromTimestamp(r===1e9?new J(t+1,0):new J(t,r));return new ut(s,M.empty(),e)}function tm(n){return new ut(n.readTime,n.key,On)}class ut{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ut(Q.min(),M.empty(),On)}static max(){return new ut(Q.max(),M.empty(),On)}}function nm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:j(n.largestBatchId,e.largestBatchId))}const rm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ri(n){if(n.code!==R.FAILED_PRECONDITION||n.message!==rm)throw n;D("LocalStore","Unexpectedly lost primary lease")}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):b.reject(t)}static resolve(e){return new b(((t,r)=>{t(e)}))}static reject(e){return new b(((t,r)=>{r(e)}))}static waitFor(e){return new b(((t,r)=>{let s=0,o=0,a=!1;e.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=b.resolve(!1);for(const r of e)t=t.next((s=>s?b.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new b(((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;t(e[f]).next((_=>{a[f]=_,++u,u===o&&r(a)}),(_=>s(_)))}}))}static doWhile(e,t){return new b(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function im(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Hn(n){return n.name==="IndexedDbTransactionError"}class Ci{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ci.ce=-1;const Pi=-1;function ki(n){return n==null}function Mr(n){return n===0&&1/n==-1/0}function om(n){return typeof n=="number"&&Number.isInteger(n)&&!Mr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const pl="";function am(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Na(e)),e=cm(n.get(t),e);return Na(e)}function cm(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case pl:t+="";break;default:t+=o}}return t}function Na(n){return n+pl+""}function Va(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function sn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ml(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Te{constructor(e,t){this.comparator=e,this.root=t||oe.EMPTY}insert(e,t){return new Te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,oe.BLACK,null,null))}remove(e){return new Te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,oe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new dr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new dr(this.root,e,this.comparator,!1)}getReverseIterator(){return new dr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new dr(this.root,e,this.comparator,!0)}}class dr{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class oe{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??oe.RED,this.left=s??oe.EMPTY,this.right=o??oe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new oe(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return oe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return oe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,oe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,oe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw U(43730,{key:this.key,value:this.value});if(this.right.isRed())throw U(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw U(27949);return e+(this.isRed()?0:1)}}oe.EMPTY=null,oe.RED=!0,oe.BLACK=!1;oe.EMPTY=new class{constructor(){this.size=0}get key(){throw U(57766)}get value(){throw U(16141)}get color(){throw U(16727)}get left(){throw U(29726)}get right(){throw U(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new oe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class le{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Oa(this.data.getIterator())}getIteratorFrom(e){return new Oa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof le)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new le(this.comparator);return t.data=e,t}}class Oa{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class De{constructor(e){this.fields=e,e.sort(ce.comparator)}static empty(){return new De([])}unionWith(e){let t=new le(ce.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new De(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qt(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class lm extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Fe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new lm("Invalid base64 string: "+o):o}})(e);return new Fe(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Fe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Fe.EMPTY_BYTE_STRING=new Fe("");const um=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nt(n){if(Z(!!n,39018),typeof n=="string"){let e=0;const t=um.exec(n);if(Z(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ae(n.seconds),nanos:ae(n.nanos)}}function ae(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Jt(n){return typeof n=="string"?Fe.fromBase64String(n):Fe.fromUint8Array(n)}const gl="server_timestamp",_l="__type__",yl="__previous_value__",El="__local_write_time__";function Di(n){return(n?.mapValue?.fields||{})[_l]?.stringValue===gl}function Ni(n){const e=n.mapValue.fields[yl];return Di(e)?Ni(e):e}function xr(n){const e=Nt(n.mapValue.fields[El].timestampValue);return new J(e.seconds,e.nanos)}class hm{constructor(e,t,r,s,o,a,u,h,f,_){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=_}}const Ur="(default)";class Fr{constructor(e,t){this.projectId=e,this.database=t||Ur}static empty(){return new Fr("","")}get isDefaultDatabase(){return this.database===Ur}isEqual(e){return e instanceof Fr&&e.projectId===this.projectId&&e.database===this.database}}const Il="__type__",dm="__max__",fr={mapValue:{}},vl="__vector__",Zs="value";function Vt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Di(n)?4:pm(n)?9007199254740991:fm(n)?10:11:U(28295,{value:n})}function Be(n,e){if(n===e)return!0;const t=Vt(n);if(t!==Vt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xr(n).isEqual(xr(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=Nt(s.timestampValue),u=Nt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return Jt(s.bytesValue).isEqual(Jt(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return ae(s.geoPointValue.latitude)===ae(o.geoPointValue.latitude)&&ae(s.geoPointValue.longitude)===ae(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return ae(s.integerValue)===ae(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=ae(s.doubleValue),u=ae(o.doubleValue);return a===u?Mr(a)===Mr(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return Qt(n.arrayValue.values||[],e.arrayValue.values||[],Be);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(Va(a)!==Va(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Be(a[h],u[h])))return!1;return!0})(n,e);default:return U(52216,{left:n})}}function Ln(n,e){return(n.values||[]).find((t=>Be(t,e)))!==void 0}function Xt(n,e){if(n===e)return 0;const t=Vt(n),r=Vt(e);if(t!==r)return j(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=ae(o.integerValue||o.doubleValue),h=ae(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return La(n.timestampValue,e.timestampValue);case 4:return La(xr(n),xr(e));case 5:return Ys(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=Jt(o),h=Jt(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let f=0;f<u.length&&f<h.length;f++){const _=j(u[f],h[f]);if(_!==0)return _}return j(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=j(ae(o.latitude),ae(a.latitude));return u!==0?u:j(ae(o.longitude),ae(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Ma(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},f=u[Zs]?.arrayValue,_=h[Zs]?.arrayValue,E=j(f?.values?.length||0,_?.values?.length||0);return E!==0?E:Ma(f,_)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===fr.mapValue&&a===fr.mapValue)return 0;if(o===fr.mapValue)return 1;if(a===fr.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=a.fields||{},_=Object.keys(f);h.sort(),_.sort();for(let E=0;E<h.length&&E<_.length;++E){const S=Ys(h[E],_[E]);if(S!==0)return S;const P=Xt(u[h[E]],f[_[E]]);if(P!==0)return P}return j(h.length,_.length)})(n.mapValue,e.mapValue);default:throw U(23264,{he:t})}}function La(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return j(n,e);const t=Nt(n),r=Nt(e),s=j(t.seconds,r.seconds);return s!==0?s:j(t.nanos,r.nanos)}function Ma(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=Xt(t[s],r[s]);if(o)return o}return j(t.length,r.length)}function Yt(n){return ei(n)}function ei(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Nt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Jt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return M.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=ei(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${ei(t.fields[a])}`;return s+"}"})(n.mapValue):U(61005,{value:n})}function wr(n){switch(Vt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ni(n);return e?16+wr(e):16;case 5:return 2*n.stringValue.length;case 6:return Jt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+wr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return sn(r.fields,((o,a)=>{s+=o.length+wr(a)})),s})(n.mapValue);default:throw U(13486,{value:n})}}function ti(n){return!!n&&"integerValue"in n}function Vi(n){return!!n&&"arrayValue"in n}function Ar(n){return!!n&&"mapValue"in n}function fm(n){return(n?.mapValue?.fields||{})[Il]?.stringValue===vl}function Rn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return sn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Rn(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Rn(n.arrayValue.values[t]);return e}return{...n}}function pm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===dm}class Ce{constructor(e){this.value=e}static empty(){return new Ce({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ar(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rn(t)}setAll(e){let t=ce.emptyPath(),r={},s=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=Rn(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Ar(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Be(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ar(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){sn(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new Ce(Rn(this.value))}}function Tl(n){const e=[];return sn(n.fields,((t,r)=>{const s=new ce([t]);if(Ar(r)){const o=Tl(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new De(e)}class be{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new be(e,0,Q.min(),Q.min(),Q.min(),Ce.empty(),0)}static newFoundDocument(e,t,r,s){return new be(e,1,t,Q.min(),r,s,0)}static newNoDocument(e,t){return new be(e,2,t,Q.min(),Q.min(),Ce.empty(),0)}static newUnknownDocument(e,t){return new be(e,3,t,Q.min(),Q.min(),Ce.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ce.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ce.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof be&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new be(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Br{constructor(e,t){this.position=e,this.inclusive=t}}function xa(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),t.key):r=Xt(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ua(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Be(n.position[t],e.position[t]))return!1;return!0}class jr{constructor(e,t="asc"){this.field=e,this.dir=t}}function mm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class wl{}class ie extends wl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new _m(e,t,r):t==="array-contains"?new Im(e,r):t==="in"?new vm(e,r):t==="not-in"?new Tm(e,r):t==="array-contains-any"?new wm(e,r):new ie(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ym(e,r):new Em(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Xt(t,this.value)):t!==null&&Vt(this.value)===Vt(t)&&this.matchesComparison(Xt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ht extends wl{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ht(e,t)}matches(e){return Al(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Al(n){return n.op==="and"}function Sl(n){return gm(n)&&Al(n)}function gm(n){for(const e of n.filters)if(e instanceof ht)return!1;return!0}function ni(n){if(n instanceof ie)return n.field.canonicalString()+n.op.toString()+Yt(n.value);if(Sl(n))return n.filters.map((e=>ni(e))).join(",");{const e=n.filters.map((t=>ni(t))).join(",");return`${n.op}(${e})`}}function bl(n,e){return n instanceof ie?(function(r,s){return s instanceof ie&&r.op===s.op&&r.field.isEqual(s.field)&&Be(r.value,s.value)})(n,e):n instanceof ht?(function(r,s){return s instanceof ht&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&bl(a,s.filters[u])),!0):!1})(n,e):void U(19439)}function Rl(n){return n instanceof ie?(function(t){return`${t.field.canonicalString()} ${t.op} ${Yt(t.value)}`})(n):n instanceof ht?(function(t){return t.op.toString()+" {"+t.getFilters().map(Rl).join(" ,")+"}"})(n):"Filter"}class _m extends ie{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){const t=M.comparator(e.key,this.key);return this.matchesComparison(t)}}class ym extends ie{constructor(e,t){super(e,"in",t),this.keys=Cl("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Em extends ie{constructor(e,t){super(e,"not-in",t),this.keys=Cl("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Cl(n,e){return(e.arrayValue?.values||[]).map((t=>M.fromName(t.referenceValue)))}class Im extends ie{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Vi(t)&&Ln(t.arrayValue,this.value)}}class vm extends ie{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ln(this.value.arrayValue,t)}}class Tm extends ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ln(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ln(this.value.arrayValue,t)}}class wm extends ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Vi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ln(this.value.arrayValue,r)))}}class Am{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Fa(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Am(n,e,t,r,s,o,a)}function Oi(n){const e=G(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>ni(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),ki(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Yt(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Yt(r))).join(",")),e.Te=t}return e.Te}function Li(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!mm(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!bl(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ua(n.startAt,e.startAt)&&Ua(n.endAt,e.endAt)}class es{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Sm(n,e,t,r,s,o,a,u){return new es(n,e,t,r,s,o,a,u)}function bm(n){return new es(n)}function Ba(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Rm(n){return n.collectionGroup!==null}function Cn(n){const e=G(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new le(ce.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new jr(o,r))})),t.has(ce.keyField().canonicalString())||e.Ie.push(new jr(ce.keyField(),r))}return e.Ie}function bt(n){const e=G(n);return e.Ee||(e.Ee=Cm(e,Cn(n))),e.Ee}function Cm(n,e){if(n.limitType==="F")return Fa(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new jr(s.field,o)}));const t=n.endAt?new Br(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Br(n.startAt.position,n.startAt.inclusive):null;return Fa(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ri(n,e,t){return new es(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Pl(n,e){return Li(bt(n),bt(e))&&n.limitType===e.limitType}function kl(n){return`${Oi(bt(n))}|lt:${n.limitType}`}function wn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Rl(s))).join(", ")}]`),ki(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Yt(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Yt(s))).join(",")),`Target(${r})`})(bt(n))}; limitType=${n.limitType})`}function Mi(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Cn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const f=xa(a,u,h);return a.inclusive?f<=0:f<0})(r.startAt,Cn(r),s)||r.endAt&&!(function(a,u,h){const f=xa(a,u,h);return a.inclusive?f>=0:f>0})(r.endAt,Cn(r),s))})(n,e)}function Pm(n){return(e,t)=>{let r=!1;for(const s of Cn(n)){const o=km(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function km(n,e,t){const r=n.field.isKeyField()?M.comparator(e.key,t.key):(function(o,a,u){const h=a.data.field(o),f=u.data.field(o);return h!==null&&f!==null?Xt(h,f):U(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U(19790,{direction:n.dir})}}class Ot{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){sn(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return ml(this.inner)}size(){return this.innerSize}}const Dm=new Te(M.comparator);function $r(){return Dm}const Dl=new Te(M.comparator);function pr(...n){let e=Dl;for(const t of n)e=e.insert(t.key,t);return e}function Nl(n){let e=Dl;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function wt(){return Pn()}function Vl(){return Pn()}function Pn(){return new Ot((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Nm=new Te(M.comparator),Vm=new le(M.comparator);function fe(...n){let e=Vm;for(const t of n)e=e.add(t);return e}const Om=new le(j);function Lm(){return Om}function xi(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mr(e)?"-0":e}}function Ol(n){return{integerValue:""+n}}function Mm(n,e){return om(e)?Ol(e):xi(n,e)}class ts{constructor(){this._=void 0}}function xm(n,e,t){return n instanceof qr?(function(s,o){const a={fields:{[_l]:{stringValue:gl},[El]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Di(o)&&(o=Ni(o)),o&&(a.fields[yl]=o),{mapValue:a}})(t,e):n instanceof Mn?Ml(n,e):n instanceof xn?xl(n,e):(function(s,o){const a=Ll(s,o),u=ja(a)+ja(s.Ae);return ti(a)&&ti(s.Ae)?Ol(u):xi(s.serializer,u)})(n,e)}function Um(n,e,t){return n instanceof Mn?Ml(n,e):n instanceof xn?xl(n,e):t}function Ll(n,e){return n instanceof Hr?(function(r){return ti(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class qr extends ts{}class Mn extends ts{constructor(e){super(),this.elements=e}}function Ml(n,e){const t=Ul(e);for(const r of n.elements)t.some((s=>Be(s,r)))||t.push(r);return{arrayValue:{values:t}}}class xn extends ts{constructor(e){super(),this.elements=e}}function xl(n,e){let t=Ul(e);for(const r of n.elements)t=t.filter((s=>!Be(s,r)));return{arrayValue:{values:t}}}class Hr extends ts{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ja(n){return ae(n.integerValue||n.doubleValue)}function Ul(n){return Vi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Fm(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Mn&&s instanceof Mn||r instanceof xn&&s instanceof xn?Qt(r.elements,s.elements,Be):r instanceof Hr&&s instanceof Hr?Be(r.Ae,s.Ae):r instanceof qr&&s instanceof qr})(n.transform,e.transform)}class Bm{constructor(e,t){this.version=e,this.transformResults=t}}class He{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new He}static exists(e){return new He(void 0,e)}static updateTime(e){return new He(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Sr(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ns{}function Fl(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jl(n.key,He.none()):new zn(n.key,n.data,He.none());{const t=n.data,r=Ce.empty();let s=new le(ce.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Lt(n.key,r,new De(s.toArray()),He.none())}}function jm(n,e,t){n instanceof zn?(function(s,o,a){const u=s.value.clone(),h=qa(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Lt?(function(s,o,a){if(!Sr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=qa(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Bl(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function kn(n,e,t,r){return n instanceof zn?(function(o,a,u,h){if(!Sr(o.precondition,a))return u;const f=o.value.clone(),_=Ha(o.fieldTransforms,h,a);return f.setAll(_),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null})(n,e,t,r):n instanceof Lt?(function(o,a,u,h){if(!Sr(o.precondition,a))return u;const f=Ha(o.fieldTransforms,h,a),_=a.data;return _.setAll(Bl(o)),_.setAll(f),a.convertToFoundDocument(a.version,_).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((E=>E.field)))})(n,e,t,r):(function(o,a,u){return Sr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function $m(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=Ll(r.transform,s||null);o!=null&&(t===null&&(t=Ce.empty()),t.set(r.field,o))}return t||null}function $a(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Qt(r,s,((o,a)=>Fm(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class zn extends ns{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Lt extends ns{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Bl(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function qa(n,e,t){const r=new Map;Z(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,Um(a,u,t[s]))}return r}function Ha(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,xm(o,a,e))}return r}class jl extends ns{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qm extends ns{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Hm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&jm(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=kn(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=kn(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Vl();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=Fl(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(Q.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),fe())}isEqual(e){return this.batchId===e.batchId&&Qt(this.mutations,e.mutations,((t,r)=>$a(t,r)))&&Qt(this.baseMutations,e.baseMutations,((t,r)=>$a(t,r)))}}class Ui{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Z(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Nm})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Ui(e,t,r,s)}}class zm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}var ee,B;function Gm(n){switch(n){case R.OK:return U(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return U(15467,{code:n})}}function Wm(n){if(n===void 0)return Dt("GRPC error has no .code"),R.UNKNOWN;switch(n){case ee.OK:return R.OK;case ee.CANCELLED:return R.CANCELLED;case ee.UNKNOWN:return R.UNKNOWN;case ee.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case ee.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case ee.INTERNAL:return R.INTERNAL;case ee.UNAVAILABLE:return R.UNAVAILABLE;case ee.UNAUTHENTICATED:return R.UNAUTHENTICATED;case ee.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case ee.NOT_FOUND:return R.NOT_FOUND;case ee.ALREADY_EXISTS:return R.ALREADY_EXISTS;case ee.PERMISSION_DENIED:return R.PERMISSION_DENIED;case ee.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case ee.ABORTED:return R.ABORTED;case ee.OUT_OF_RANGE:return R.OUT_OF_RANGE;case ee.UNIMPLEMENTED:return R.UNIMPLEMENTED;case ee.DATA_LOSS:return R.DATA_LOSS;default:return U(39323,{code:n})}}(B=ee||(ee={}))[B.OK=0]="OK",B[B.CANCELLED=1]="CANCELLED",B[B.UNKNOWN=2]="UNKNOWN",B[B.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",B[B.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",B[B.NOT_FOUND=5]="NOT_FOUND",B[B.ALREADY_EXISTS=6]="ALREADY_EXISTS",B[B.PERMISSION_DENIED=7]="PERMISSION_DENIED",B[B.UNAUTHENTICATED=16]="UNAUTHENTICATED",B[B.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",B[B.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",B[B.ABORTED=10]="ABORTED",B[B.OUT_OF_RANGE=11]="OUT_OF_RANGE",B[B.UNIMPLEMENTED=12]="UNIMPLEMENTED",B[B.INTERNAL=13]="INTERNAL",B[B.UNAVAILABLE=14]="UNAVAILABLE",B[B.DATA_LOSS=15]="DATA_LOSS";new wi([4294967295,4294967295],0);class Km{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function si(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Qm(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Jm(n,e){return si(n,e.toTimestamp())}function Ht(n){return Z(!!n,49232),Q.fromTimestamp((function(t){const r=Nt(t);return new J(r.seconds,r.nanos)})(n))}function $l(n,e){return ii(n,e).canonicalString()}function ii(n,e){const t=(function(s){return new X(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Xm(n){const e=X.fromString(n);return Z(ig(e),10190,{key:e.toString()}),e}function oi(n,e){return $l(n.databaseId,e.path)}function Ym(n){const e=Xm(n);return e.length===4?X.emptyPath():eg(e)}function Zm(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eg(n){return Z(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function za(n,e,t){return{name:oi(n,e),fields:t.value.mapValue.fields}}function tg(n,e){let t;if(e instanceof zn)t={update:za(n,e.key,e.value)};else if(e instanceof jl)t={delete:oi(n,e.key)};else if(e instanceof Lt)t={update:za(n,e.key,e.data),updateMask:sg(e.fieldMask)};else{if(!(e instanceof qm))return U(16599,{Vt:e.type});t={verify:oi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof qr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Mn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof xn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Hr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw U(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:Jm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:U(27497)})(n,e.precondition)),t}function ng(n,e){return n&&n.length>0?(Z(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Ht(s.updateTime):Ht(o);return a.isEqual(Q.min())&&(a=Ht(o)),new Bm(a,s.transformResults||[])})(t,e)))):[]}function rg(n){let e=Ym(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Z(r===1,65062);const _=t.from[0];_.allDescendants?s=_.collectionId:e=e.child(_.collectionId)}let o=[];t.where&&(o=(function(E){const S=ql(E);return S instanceof ht&&Sl(S)?S.getFilters():[S]})(t.where));let a=[];t.orderBy&&(a=(function(E){return E.map((S=>(function(k){return new jr(Bt(k.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(S)))})(t.orderBy));let u=null;t.limit&&(u=(function(E){let S;return S=typeof E=="object"?E.value:E,ki(S)?null:S})(t.limit));let h=null;t.startAt&&(h=(function(E){const S=!!E.before,P=E.values||[];return new Br(P,S)})(t.startAt));let f=null;return t.endAt&&(f=(function(E){const S=!E.before,P=E.values||[];return new Br(P,S)})(t.endAt)),Sm(e,s,a,o,u,"F",h,f)}function ql(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Bt(t.unaryFilter.field);return ie.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Bt(t.unaryFilter.field);return ie.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Bt(t.unaryFilter.field);return ie.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Bt(t.unaryFilter.field);return ie.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return U(61313);default:return U(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ie.create(Bt(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return U(58110);default:return U(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ht.create(t.compositeFilter.filters.map((r=>ql(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return U(1026)}})(t.compositeFilter.op))})(n):U(30097,{filter:n})}function Bt(n){return ce.fromServerFormat(n.fieldPath)}function sg(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ig(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class og{constructor(e){this.yt=e}}function ag(n){const e=rg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ri(e,e.limit,"L"):e}class cg{constructor(){this.Cn=new lg}addToCollectionParentIndex(e,t){return this.Cn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(ut.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(ut.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class lg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new le(X.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new le(X.comparator)).toArray()}}const Ga={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Hl=41943040;class ve{static withCacheSize(e){return new ve(e,ve.DEFAULT_COLLECTION_PERCENTILE,ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ve.DEFAULT_COLLECTION_PERCENTILE=10,ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ve.DEFAULT=new ve(Hl,ve.DEFAULT_COLLECTION_PERCENTILE,ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ve.DISABLED=new ve(-1,0,0);class Zt{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Zt(0)}static cr(){return new Zt(-1)}}const Wa="LruGarbageCollector",ug=1048576;function Ka([n,e],[t,r]){const s=j(n,t);return s===0?j(e,r):s}class hg{constructor(e){this.Ir=e,this.buffer=new le(Ka),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Ka(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class dg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){D(Wa,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Hn(t)?D(Wa,"Ignoring IndexedDB error during garbage collection: ",t):await Ri(t)}await this.Vr(3e5)}))}}class fg{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(Ci.ce);const r=new hg(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Ga)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ga):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,u,h,f;const _=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,a=Date.now(),this.nthSequenceNumber(e,s)))).next((E=>(r=E,u=Date.now(),this.removeTargets(e,r,t)))).next((E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((E=>(f=Date.now(),Ft()<=F.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-_}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${E} documents in `+(f-h)+`ms
Total Duration: ${f-_}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E}))))}}function pg(n,e){return new fg(n,e)}class mg{constructor(){this.changes=new Ot((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,be.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class gg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class _g{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&kn(r.mutation,s,De.empty(),J.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,fe()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=fe()){const s=wt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=pr();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=wt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,fe())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,r,s){let o=$r();const a=Pn(),u=(function(){return Pn()})();return t.forEach(((h,f)=>{const _=r.get(f.key);s.has(f.key)&&(_===void 0||_.mutation instanceof Lt)?o=o.insert(f.key,f):_!==void 0?(a.set(f.key,_.mutation.getFieldMask()),kn(_.mutation,f,_.mutation.getFieldMask(),J.now())):a.set(f.key,De.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,_)=>a.set(f,_))),t.forEach(((f,_)=>u.set(f,new gg(_,a.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=Pn();let s=new Te(((a,u)=>a-u)),o=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((h=>{const f=t.get(h);if(f===null)return;let _=r.get(h)||De.empty();_=u.applyToLocalView(f,_),r.set(h,_);const E=(s.get(u.batchId)||fe()).add(h);s=s.insert(u.batchId,E)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,_=h.value,E=Vl();_.forEach((S=>{if(!o.has(S)){const P=Fl(t.get(S),r.get(S));P!==null&&E.set(S,P),o=o.add(S)}})),a.push(this.documentOverlayCache.saveOverlays(e,f,E))}return b.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Rm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):b.resolve(wt());let u=On,h=o;return a.next((f=>b.forEach(f,((_,E)=>(u<E.largestBatchId&&(u=E.largestBatchId),o.get(_)?b.resolve():this.remoteDocumentCache.getEntry(e,_).next((S=>{h=h.insert(_,S)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,fe()))).next((_=>({batchId:u,changes:Nl(_)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next((r=>{let s=pr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=pr();return this.indexManager.getCollectionParents(e,o).next((u=>b.forEach(u,(h=>{const f=(function(E,S){return new es(S,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next((_=>{_.forEach(((E,S)=>{a=a.insert(E,S)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,f)=>{const _=f.getKey();a.get(_)===null&&(a=a.insert(_,be.newInvalidDocument(_)))}));let u=pr();return a.forEach(((h,f)=>{const _=o.get(h);_!==void 0&&kn(_.mutation,f,De.empty(),J.now()),Mi(t,f)&&(u=u.insert(h,f))})),u}))}}class yg{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return b.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Ht(s.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:ag(s.bundledQuery),readTime:Ht(s.readTime)}})(t)),b.resolve()}}class Eg{constructor(){this.overlays=new Te(M.comparator),this.qr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const r=wt();return b.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),b.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){const s=wt(),o=t.length+1,a=new M(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return b.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new Te(((f,_)=>f-_));const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let _=o.get(f.largestBatchId);_===null&&(_=wt(),o=o.insert(f.largestBatchId,_)),_.set(f.getKey(),f)}}const u=wt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,_)=>u.set(f,_))),!(u.size()>=s)););return b.resolve(u)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new zm(t,r));let o=this.qr.get(t);o===void 0&&(o=fe(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class Ig{constructor(){this.sessionToken=Fe.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class Fi{constructor(){this.Qr=new le(se.$r),this.Ur=new le(se.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new se(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new se(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new M(new X([])),r=new se(t,e),s=new se(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new M(new X([])),r=new se(t,e),s=new se(t,e+1);let o=fe();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new se(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class se{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return M.comparator(e.key,t.key)||j(e.Yr,t.Yr)}static Kr(e,t){return j(e.Yr,t.Yr)||M.comparator(e.key,t.key)}}class vg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new le(se.$r)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Hm(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new se(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(e,t){return b.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return b.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?Pi:this.tr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new se(t,0),s=new se(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),b.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new le(j);return t.forEach((s=>{const o=new se(s,0),a=new se(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),b.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;M.isDocumentKey(o)||(o=o.child(""));const a=new se(new M(o),0);let u=new le(j);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.Yr)),!0)}),a),b.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Z(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return b.forEach(t.mutations,(s=>{const o=new se(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new se(t,0),s=this.Zr.firstAfterOrEqual(r);return b.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Tg{constructor(e){this.ri=e,this.docs=(function(){return new Te(M.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():be.newInvalidDocument(t))}getEntries(e,t){let r=$r();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():be.newInvalidDocument(s))})),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=$r();const a=t.path,u=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:_}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||nm(tm(_),r)<=0||(s.has(_.key)||Mi(t,_))&&(o=o.insert(_.key,_.mutableCopy()))}return b.resolve(o)}getAllFromCollectionGroup(e,t,r,s){U(9500)}ii(e,t){return b.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new wg(this)}getSize(e){return b.resolve(this.size)}}class wg extends mg{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),b.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Ag{constructor(e){this.persistence=e,this.si=new Ot((t=>Oi(t)),Li),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.oi=0,this._i=new Fi,this.targetCount=0,this.ai=Zt.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),b.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Zt(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Pr(t),b.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)})),b.waitFor(o).next((()=>s))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),b.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this._i.containsKey(t))}}class zl{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ci(0),this.li=!1,this.li=!0,this.hi=new Ig,this.referenceDelegate=e(this),this.Pi=new Ag(this),this.indexManager=new cg,this.remoteDocumentCache=(function(s){return new Tg(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new og(t),this.Ii=new yg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Eg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new vg(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){D("MemoryPersistence","Starting transaction:",e);const s=new Sg(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return b.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class Sg extends sm{constructor(e){super(),this.currentSequenceNumber=e}}class Bi{constructor(e){this.persistence=e,this.Ri=new Fi,this.Vi=null}static mi(e){return new Bi(e)}get fi(){if(this.Vi)return this.Vi;throw U(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,(r=>{const s=M.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,Q.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class zr{constructor(e,t){this.persistence=e,this.pi=new Ot((r=>am(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=pg(this,t)}static mi(e,t){return new zr(e,t)}Ei(){}di(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return b.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?b.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((u=>{u||(r++,o.removeEntry(a,Q.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),b.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wr(e.data.value)),t}br(e,t,r){return b.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return b.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ji{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=fe(),s=fe();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new ji(e,t.fromCache,r,s)}}class bg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Rg{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return wh()?8:im(ge())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new bg;return this.Ss(e,t,a).next((u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Ft()<=F.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",wn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(Ft()<=F.DEBUG&&D("QueryEngine","Query:",wn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Ft()<=F.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",wn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bt(t))):b.resolve())}ys(e,t){if(Ba(t))return b.resolve(null);let r=bt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=ri(t,null,"F"),r=bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=fe(...o);return this.ps.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(t,u);return this.Cs(t,f,a,h.readTime)?this.ys(e,ri(t,null,"F")):this.vs(e,f,t,h)}))))})))))}ws(e,t,r,s){return Ba(t)||s.isEqual(Q.min())?b.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?b.resolve(null):(Ft()<=F.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),wn(t)),this.vs(e,a,t,em(s,On)).next((u=>u)))}))}Ds(e,t){let r=new le(Pm(e));return t.forEach(((s,o)=>{Mi(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Ft()<=F.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",wn(t)),this.ps.getDocumentsMatchingQuery(e,t,ut.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Cg="LocalStore";class Pg{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Te(j),this.xs=new Ot((o=>Oi(o)),Li),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _g(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function kg(n,e,t,r){return new Pg(n,e,t,r)}async function Gl(n,e){const t=G(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=fe();for(const f of s){a.push(f.batchId);for(const _ of f.mutations)h=h.add(_.key)}for(const f of o){u.push(f.batchId);for(const _ of f.mutations)h=h.add(_.key)}return t.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:a,addedBatchIds:u})))}))}))}function Dg(n,e){const t=G(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,f,_){const E=f.batch,S=E.keys();let P=b.resolve();return S.forEach((k=>{P=P.next((()=>_.getEntry(h,k))).next((L=>{const N=f.docVersions.get(k);Z(N!==null,48541),L.version.compareTo(N)<0&&(E.applyToRemoteDocument(L,f),L.isValidDocument()&&(L.setReadTime(f.commitVersion),_.addEntry(L)))}))})),P.next((()=>u.mutationQueue.removeMutationBatch(h,E)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=fe();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Ng(n){const e=G(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Vg(n,e){const t=G(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Pi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}class Qa{constructor(){this.activeTargetIds=Lm()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Og{constructor(){this.Mo=new Qa,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Qa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Lg{Oo(e){}shutdown(){}}const Ja="ConnectivityMonitor";class Xa{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(Ja,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){D(Ja,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let mr=null;function ai(){return mr===null?mr=(function(){return 268435456+Math.round(2147483648*Math.random())})():mr++,"0x"+mr.toString(16)}const Bs="RestConnection",Mg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xg{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Ur?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=ai(),u=this.zo(e,t.toUriEncodedString());D(Bs,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:f}=new URL(u),_=en(f);return this.Jo(e,u,h,r,_).then((E=>(D(Bs,`Received RPC '${e}' ${a}: `,E),E)),(E=>{throw Zr(Bs,`RPC '${e}' ${a} failed with error: `,E,"url: ",u,"request:",r),E}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+rn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=Mg[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class Ug{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const he="WebChannelConnection";class Fg extends xg{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=ai();return new Promise(((u,h)=>{const f=new sl;f.setWithCredentials(!0),f.listenOnce(il.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case Tr.NO_ERROR:const E=f.getResponseJson();D(he,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(E)),u(E);break;case Tr.TIMEOUT:D(he,`RPC '${e}' ${a} timed out`),h(new V(R.DEADLINE_EXCEEDED,"Request time out"));break;case Tr.HTTP_ERROR:const S=f.getStatus();if(D(he,`RPC '${e}' ${a} failed with status:`,S,"response text:",f.getResponseText()),S>0){let P=f.getResponseJson();Array.isArray(P)&&(P=P[0]);const k=P?.error;if(k&&k.status&&k.message){const L=(function($){const q=$.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(q)>=0?q:R.UNKNOWN})(k.status);h(new V(L,k.message))}else h(new V(R.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new V(R.UNAVAILABLE,"Connection failed."));break;default:U(9055,{l_:e,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{D(he,`RPC '${e}' ${a} completed.`)}}));const _=JSON.stringify(s);D(he,`RPC '${e}' ${a} sending request:`,s),f.send(t,"POST",_,r,15)}))}T_(e,t,r){const s=ai(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=cl(),u=al(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const _=o.join("");D(he,`Creating RPC '${e}' stream ${s}: ${_}`,h);const E=a.createWebChannel(_,h);this.I_(E);let S=!1,P=!1;const k=new Ug({Yo:N=>{P?D(he,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(S||(D(he,`Opening RPC '${e}' stream ${s} transport.`),E.open(),S=!0),D(he,`RPC '${e}' stream ${s} sending:`,N),E.send(N))},Zo:()=>E.close()}),L=(N,$,q)=>{N.listen($,(K=>{try{q(K)}catch(we){setTimeout((()=>{throw we}),0)}}))};return L(E,An.EventType.OPEN,(()=>{P||(D(he,`RPC '${e}' stream ${s} transport opened.`),k.o_())})),L(E,An.EventType.CLOSE,(()=>{P||(P=!0,D(he,`RPC '${e}' stream ${s} transport closed`),k.a_(),this.E_(E))})),L(E,An.EventType.ERROR,(N=>{P||(P=!0,Zr(he,`RPC '${e}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),k.a_(new V(R.UNAVAILABLE,"The operation could not be completed")))})),L(E,An.EventType.MESSAGE,(N=>{if(!P){const $=N.data[0];Z(!!$,16349);const q=$,K=q?.error||q[0]?.error;if(K){D(he,`RPC '${e}' stream ${s} received error:`,K);const we=K.status;let Se=(function(p){const g=ee[p];if(g!==void 0)return Wm(g)})(we),_e=K.message;Se===void 0&&(Se=R.INTERNAL,_e="Unknown error status: "+we+" with message "+K.message),P=!0,k.a_(new V(Se,_e)),E.close()}else D(he,`RPC '${e}' stream ${s} received:`,$),k.u_($)}})),L(u,ol.STAT_EVENT,(N=>{N.stat===Xs.PROXY?D(he,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===Xs.NOPROXY&&D(he,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{k.__()}),0),k}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function js(){return typeof document<"u"?document:null}function rs(n){return new Km(n,!0)}class Wl{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&D("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ya="PersistentStream";class Bg{constructor(e,t,r,s,o,a,u,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Wl(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Dt(t.toString()),Dt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new V(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return D(Ya,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(D(Ya,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class jg extends Bg{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Z(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Z(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Z(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=ng(e.writeResults,e.commitTime),r=Ht(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Zm(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>tg(this.serializer,r)))};this.q_(t)}}class $g{}class qg extends $g{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new V(R.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,ii(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(R.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(e,ii(t,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(R.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Hg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Dt(t),this.aa=!1):D("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Gn="RemoteStore";class zg{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{Kn(this)&&(D(Gn,"Restarting streams for network reachability change."),await(async function(h){const f=G(h);f.Ea.add(4),await Wn(f),f.Ra.set("Unknown"),f.Ea.delete(4),await ss(f)})(this))}))})),this.Ra=new Hg(r,s)}}async function ss(n){if(Kn(n))for(const e of n.da)await e(!0)}async function Wn(n){for(const e of n.da)await e(!1)}function Kn(n){return G(n).Ea.size===0}async function Kl(n,e,t){if(!Hn(e))throw e;n.Ea.add(1),await Wn(n),n.Ra.set("Offline"),t||(t=()=>Ng(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{D(Gn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ss(n)}))}function Ql(n,e){return e().catch((t=>Kl(n,t,e)))}async function is(n){const e=G(n),t=dt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Pi;for(;Gg(e);)try{const s=await Vg(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Wg(e,s)}catch(s){await Kl(e,s)}Jl(e)&&Xl(e)}function Gg(n){return Kn(n)&&n.Ta.length<10}function Wg(n,e){n.Ta.push(e);const t=dt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function Jl(n){return Kn(n)&&!dt(n).x_()&&n.Ta.length>0}function Xl(n){dt(n).start()}async function Kg(n){dt(n).ra()}async function Qg(n){const e=dt(n);for(const t of n.Ta)e.ea(t.mutations)}async function Jg(n,e,t){const r=n.Ta.shift(),s=Ui.from(r,e,t);await Ql(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await is(n)}async function Xg(n,e){e&&dt(n).X_&&await(async function(r,s){if((function(a){return Gm(a)&&a!==R.ABORTED})(s.code)){const o=r.Ta.shift();dt(r).B_(),await Ql(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await is(r)}})(n,e),Jl(n)&&Xl(n)}async function Za(n,e){const t=G(n);t.asyncQueue.verifyOperationInProgress(),D(Gn,"RemoteStore received new credentials");const r=Kn(t);t.Ea.add(3),await Wn(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ss(t)}async function Yg(n,e){const t=G(n);e?(t.Ea.delete(2),await ss(t)):e||(t.Ea.add(2),await Wn(t),t.Ra.set("Unknown"))}function dt(n){return n.fa||(n.fa=(function(t,r,s){const o=G(t);return o.sa(),new jg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Kg.bind(null,n),r_:Xg.bind(null,n),ta:Qg.bind(null,n),na:Jg.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await is(n)):(await n.fa.stop(),n.Ta.length>0&&(D(Gn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class $i{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new St,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new $i(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Yl(n,e){if(Dt("AsyncQueue",`${e}: ${n}`),Hn(n))return new V(R.UNAVAILABLE,`${e}: ${n}`);throw n}class Zg{constructor(){this.queries=ec(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=G(t),o=s.queries;s.queries=ec(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new V(R.ABORTED,"Firestore shutting down"))}}function ec(){return new Ot((n=>kl(n)),Pl)}function e_(n){n.Ca.forEach((e=>{e.next()}))}var tc,nc;(nc=tc||(tc={})).Ma="default",nc.Cache="cache";const t_="SyncEngine";class n_{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ot((u=>kl(u)),Pl),this.Iu=new Map,this.Eu=new Set,this.du=new Te(M.comparator),this.Au=new Map,this.Ru=new Fi,this.Vu={},this.mu=new Map,this.fu=Zt.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function r_(n,e,t){const r=a_(n);try{const s=await(function(a,u){const h=G(a),f=J.now(),_=u.reduce(((P,k)=>P.add(k.key)),fe());let E,S;return h.persistence.runTransaction("Locally write mutations","readwrite",(P=>{let k=$r(),L=fe();return h.Ns.getEntries(P,_).next((N=>{k=N,k.forEach((($,q)=>{q.isValidDocument()||(L=L.add($))}))})).next((()=>h.localDocuments.getOverlayedDocuments(P,k))).next((N=>{E=N;const $=[];for(const q of u){const K=$m(q,E.get(q.key).overlayedDocument);K!=null&&$.push(new Lt(q.key,K,Tl(K.value.mapValue),He.exists(!0)))}return h.mutationQueue.addMutationBatch(P,f,$,u)})).next((N=>{S=N;const $=N.applyToLocalDocumentSet(E,L);return h.documentOverlayCache.saveOverlays(P,N.batchId,$)}))})).then((()=>({batchId:S.batchId,changes:Nl(E)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let f=a.Vu[a.currentUser.toKey()];f||(f=new Te(j)),f=f.insert(u,h),a.Vu[a.currentUser.toKey()]=f})(r,s.batchId,t),await os(r,s.changes),await is(r.remoteStore)}catch(s){const o=Yl(s,"Failed to persist write");t.reject(o)}}function rc(n,e,t){const r=G(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=G(a);h.onlineState=u;let f=!1;h.queries.forEach(((_,E)=>{for(const S of E.Sa)S.va(u)&&(f=!0)})),f&&e_(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function s_(n,e){const t=G(n),r=e.batch.batchId;try{const s=await Dg(t.localStore,e);eu(t,r,null),Zl(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await os(t,s)}catch(s){await Ri(s)}}async function i_(n,e,t){const r=G(n);try{const s=await(function(a,u){const h=G(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let _;return h.mutationQueue.lookupMutationBatch(f,u).next((E=>(Z(E!==null,37113),_=E.keys(),h.mutationQueue.removeMutationBatch(f,E)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,_,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,_))).next((()=>h.localDocuments.getDocuments(f,_)))}))})(r.localStore,e);eu(r,e,t),Zl(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await os(r,s)}catch(s){await Ri(s)}}function Zl(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function eu(n,e,t){const r=G(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}async function os(n,e,t){const r=G(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,e,t).then((f=>{if((f||t)&&r.isPrimaryClient){const _=f?!f.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,_?"current":"not-current")}if(f){s.push(f);const _=ji.As(h.targetId,f);o.push(_)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,f){const _=G(h);try{await _.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>b.forEach(f,(S=>b.forEach(S.Es,(P=>_.persistence.referenceDelegate.addReference(E,S.targetId,P))).next((()=>b.forEach(S.ds,(P=>_.persistence.referenceDelegate.removeReference(E,S.targetId,P)))))))))}catch(E){if(!Hn(E))throw E;D(Cg,"Failed to update sequence numbers: "+E)}for(const E of f){const S=E.targetId;if(!E.fromCache){const P=_.Ms.get(S),k=P.snapshotVersion,L=P.withLastLimboFreeSnapshotVersion(k);_.Ms=_.Ms.insert(S,L)}}})(r.localStore,o))}async function o_(n,e){const t=G(n);if(!t.currentUser.isEqual(e)){D(t_,"User change. New user:",e.toKey());const r=await Gl(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new V(R.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await os(t,r.Ls)}}function a_(n){const e=G(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=s_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=i_.bind(null,e),e}class Gr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=rs(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return kg(this.persistence,new Rg,e.initialUser,this.serializer)}Cu(e){return new zl(Bi.mi,this.serializer)}Du(e){return new Og}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gr.provider={build:()=>new Gr};class c_ extends Gr{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Z(this.persistence.referenceDelegate instanceof zr,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new dg(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ve.withCacheSize(this.cacheSizeBytes):ve.DEFAULT;return new zl((r=>zr.mi(r,t)),this.serializer)}}class ci{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>rc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=o_.bind(null,this.syncEngine),await Yg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Zg})()}createDatastore(e){const t=rs(e.databaseInfo.databaseId),r=(function(o){return new Fg(o)})(e.databaseInfo);return(function(o,a,u,h){return new qg(o,a,u,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,u){return new zg(r,s,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>rc(this.syncEngine,t,0)),(function(){return Xa.v()?new Xa:new Lg})())}createSyncEngine(e,t){return(function(s,o,a,u,h,f,_){const E=new n_(s,o,a,u,h,f);return _&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=G(t);D(Gn,"RemoteStore shutting down."),r.Ea.add(5),await Wn(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ci.provider={build:()=>new ci};const ft="FirestoreClient";class l_{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=de.UNAUTHENTICATED,this.clientId=Si.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{D(ft,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(D(ft,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new St;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Yl(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function $s(n,e){n.asyncQueue.verifyOperationInProgress(),D(ft,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Gl(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function sc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await u_(n);D(ft,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Za(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Za(e.remoteStore,s))),n._onlineComponents=e}async function u_(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(ft,"Using user provided OfflineComponentProvider");try{await $s(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===R.FAILED_PRECONDITION||s.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Zr("Error using user provided cache. Falling back to memory cache: "+t),await $s(n,new Gr)}}else D(ft,"Using default OfflineComponentProvider"),await $s(n,new c_(void 0));return n._offlineComponents}async function h_(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(ft,"Using user provided OnlineComponentProvider"),await sc(n,n._uninitializedComponentsProvider._online)):(D(ft,"Using default OnlineComponentProvider"),await sc(n,new ci))),n._onlineComponents}function d_(n){return h_(n).then((e=>e.syncEngine))}function tu(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const ic=new Map;const nu="firestore.googleapis.com",oc=!0;class ac{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nu,this.ssl=oc}else this.host=e.host,this.ssl=e.ssl??oc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Hl;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ug)throw new V(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Zp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tu(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(R.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(R.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(R.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class as{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ac({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ac(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new qp;switch(r.type){case"firstParty":return new Wp(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=ic.get(t);r&&(D("ComponentProvider","Removing Datastore"),ic.delete(t),r.terminate())})(this),Promise.resolve()}}function f_(n,e,t,r={}){n=fl(n,as);const s=en(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(Ic(`https://${u}`),vc("Firestore",!0)),o.host!==nu&&o.host!==u&&Zr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Rt(h,a)&&(n._setSettings(h),r.mockUserToken)){let f,_;if(typeof r.mockUserToken=="string")f=r.mockUserToken,_=de.MOCK_USER;else{f=ph(r.mockUserToken,n._app?.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new V(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new de(E)}n._authCredentials=new Hp(new ul(f,_))}}class qi{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new qi(this.firestore,e,this._query)}}class pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pe(this.firestore,e,this._key)}toJSON(){return{type:pe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(qn(t,pe._jsonSchema))return new pe(e,r||null,new M(X.fromString(t.referencePath)))}}pe._jsonSchemaVersion="firestore/documentReference/1.0",pe._jsonSchema={type:te("string",pe._jsonSchemaVersion),referencePath:te("string")};class lt extends qi{constructor(e,t,r){super(e,t,bm(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new M(e))}withConverter(e){return new lt(this.firestore,e,this._path)}}function fy(n,e,...t){if(n=Ve(n),hl("collection","path",e),n instanceof as){const r=X.fromString(e,...t);return Pa(r),new lt(n,null,r)}{if(!(n instanceof pe||n instanceof lt))throw new V(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(e,...t));return Pa(r),new lt(n.firestore,null,r)}}function p_(n,e,...t){if(n=Ve(n),arguments.length===1&&(e=Si.newId()),hl("doc","path",e),n instanceof as){const r=X.fromString(e,...t);return Ca(r),new pe(n,null,new M(r))}{if(!(n instanceof pe||n instanceof lt))throw new V(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(e,...t));return Ca(r),new pe(n.firestore,n instanceof lt?n.converter:null,new M(r))}}const cc="AsyncQueue";class lc{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Wl(this,"async_queue_retry"),this._c=()=>{const r=js();r&&D(cc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=js();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=js();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new St;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Hn(e))throw e;D(cc,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Dt("INTERNAL UNHANDLED ERROR: ",uc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=$i.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&U(47125,{Pc:uc(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function uc(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class ru extends as{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new lc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new lc(e),this._firestoreClient=void 0,await e}}}function m_(n,e){const t=typeof n=="object"?n:Sc(),r=typeof n=="string"?n:Ur,s=di(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=dh("firestore");o&&f_(s,...o)}return s}function g_(n){if(n._terminated)throw new V(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||__(n),n._firestoreClient}function __(n){const e=n._freezeSettings(),t=(function(s,o,a,u){return new hm(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,tu(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new l_(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Pe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pe(Fe.fromBase64String(e))}catch(t){throw new V(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Pe(Fe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Pe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(qn(e,Pe._jsonSchema))return Pe.fromBase64String(e.bytes)}}Pe._jsonSchemaVersion="firestore/bytes/1.0",Pe._jsonSchema={type:te("string",Pe._jsonSchemaVersion),bytes:te("string")};class Hi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class su{constructor(e){this._methodName=e}}class ze{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ze._jsonSchemaVersion}}static fromJSON(e){if(qn(e,ze._jsonSchema))return new ze(e.latitude,e.longitude)}}ze._jsonSchemaVersion="firestore/geoPoint/1.0",ze._jsonSchema={type:te("string",ze._jsonSchemaVersion),latitude:te("number"),longitude:te("number")};class Ge{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ge._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(qn(e,Ge._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ge(e.vectorValues);throw new V(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ge._jsonSchemaVersion="firestore/vectorValue/1.0",Ge._jsonSchema={type:te("string",Ge._jsonSchemaVersion),vectorValues:te("object")};const y_=/^__.*__$/;class E_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new zn(e,this.data,t,this.fieldTransforms)}}function iu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U(40011,{Ac:n})}}class zi{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new zi({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Wr(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(iu(this.Ac)&&y_.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class I_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||rs(e)}Cc(e,t,r,s=!1){return new zi({Ac:e,methodName:t,Dc:r,path:ce.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function v_(n){const e=n._freezeSettings(),t=rs(n._databaseId);return new I_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function T_(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);lu("Data must be an object, but it was:",a,r);const u=au(r,a);let h,f;if(o.merge)h=new De(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const _=[];for(const E of o.mergeFields){const S=w_(e,E,t);if(!a.contains(S))throw new V(R.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);S_(_,S)||_.push(S)}h=new De(_),f=a.fieldTransforms.filter((E=>h.covers(E.field)))}else h=null,f=a.fieldTransforms;return new E_(new Ce(u),h,f)}function ou(n,e){if(cu(n=Ve(n)))return lu("Unsupported field value:",e,n),au(n,e);if(n instanceof su)return(function(r,s){if(!iu(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=ou(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=Ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Mm(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=J.fromDate(r);return{timestampValue:si(s.serializer,o)}}if(r instanceof J){const o=new J(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:si(s.serializer,o)}}if(r instanceof ze)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pe)return{bytesValue:Qm(s.serializer,r._byteString)};if(r instanceof pe){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:$l(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ge)return(function(a,u){return{mapValue:{fields:{[Il]:{stringValue:vl},[Zs]:{arrayValue:{values:a.toArray().map((f=>{if(typeof f!="number")throw u.Sc("VectorValues must only contain numeric values.");return xi(u.serializer,f)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${bi(r)}`)})(n,e)}function au(n,e){const t={};return ml(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):sn(n,((r,s)=>{const o=ou(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function cu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof J||n instanceof ze||n instanceof Pe||n instanceof pe||n instanceof su||n instanceof Ge)}function lu(n,e,t){if(!cu(t)||!dl(t)){const r=bi(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function w_(n,e,t){if((e=Ve(e))instanceof Hi)return e._internalPath;if(typeof e=="string")return uu(n,e);throw Wr("Field path arguments must be of type string or ",n,!1,void 0,t)}const A_=new RegExp("[~\\*/\\[\\]]");function uu(n,e,t){if(e.search(A_)>=0)throw Wr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Hi(...e.split("."))._internalPath}catch{throw Wr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Wr(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new V(R.INVALID_ARGUMENT,u+n+h)}function S_(n,e){return n.some((t=>t.isEqual(e)))}class hu{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new b_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(du("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class b_ extends hu{data(){return super.data()}}function du(n,e){return typeof e=="string"?uu(n,e):e instanceof Hi?e._internalPath:e._delegate._internalPath}function R_(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class gr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zt extends hu{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new br(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(du("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=zt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}zt._jsonSchemaVersion="firestore/documentSnapshot/1.0",zt._jsonSchema={type:te("string",zt._jsonSchemaVersion),bundleSource:te("string","DocumentSnapshot"),bundleName:te("string"),bundle:te("string")};class br extends zt{data(e={}){return super.data(e)}}class Dn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new gr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new br(this._firestore,this._userDataWriter,r.key,r,new gr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new br(s._firestore,s._userDataWriter,u.doc.key,u.doc,new gr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new br(s._firestore,s._userDataWriter,u.doc.key,u.doc,new gr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,_=-1;return u.type!==0&&(f=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),_=a.indexOf(u.doc.key)),{type:C_(u.type),doc:h,oldIndex:f,newIndex:_}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Dn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Si.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function C_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U(61501,{type:n})}}Dn._jsonSchemaVersion="firestore/querySnapshot/1.0",Dn._jsonSchema={type:te("string",Dn._jsonSchemaVersion),bundleSource:te("string","QuerySnapshot"),bundleName:te("string"),bundle:te("string")};function py(n,e){const t=fl(n.firestore,ru),r=p_(n),s=R_(n.converter,e);return P_(t,[T_(v_(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,He.exists(!1))]).then((()=>r))}function P_(n,e){return(function(r,s){const o=new St;return r.asyncQueue.enqueueAndForget((async()=>r_(await d_(r),s,o))),o.promise})(g_(n),e)}(function(e,t=!0){(function(s){rn=s})(tn),Wt(new Ct("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new ru(new zp(r.getProvider("auth-internal")),new Kp(a,r.getProvider("app-check-internal")),(function(f,_){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new V(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fr(f.options.projectId,_)})(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),ct(Aa,Sa,e),ct(Aa,Sa,"esm2020")})();const fu={apiKey:"AIzaSyB1WSIsFnVeWHSVT49d7F6oJ1fSKGy1Lqw",authDomain:"days-for-girls-solon.firebaseapp.com",projectId:"days-for-girls-solon",storageBucket:"days-for-girls-solon.firebasestorage.app",messagingSenderId:"346609262014",appId:"1:346609262014:web:84575a258a86b63069edef",measurementId:"G-WL4JF18LVH"};console.log("Loading API Key:",fu.apiKey);const pu=Ac(fu),my=m_(pu),k_=Fp(pu);async function D_(){const n=new je;try{const e=await Kf(k_,n);return console.log("Successfully signed in with Google:",e.user.uid),e}catch(e){throw Gt(`Error during Google Sign-In: ${e}`,"main-message","error"),e}}const mu=document.getElementById("page-wrapper");let _r=document.getElementById("mobile-nav-toggle");const Gi="https://raw.githubusercontent.com/ryan-montville/days-for-girls-solon/refs/heads/main/";async function gy(n,e){await new Promise(f=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>f(),{once:!0}):f()}),await V_(n),await O_(),await L_();const t=document.querySelector("nav"),r=document.getElementById("open-sign-in-modal-button"),s=document.getElementById("sign-out-button"),o=document.getElementById("sign-in-backdrop"),a=document.getElementById("sign-in-modal"),u=document.getElementById("close-modal-button");await M_(),U_(),th(),_r.addEventListener("click",()=>{console.log("toggling nav menu"),t.classList.toggle("open"),t.classList.contains("open")?_r.innerText="close":_r.innerText="menu"}),r.addEventListener("click",f=>{f.preventDefault(),t.classList.contains("open")&&(_r.innerText="menu",t.classList.remove("open")),o.style.display="flex",a.classList.add("opening"),a.setAttribute("aria-modal","true");const _=document.getElementById("username");_&&_.focus(),fc(a,o)}),a.addEventListener("submit",f=>{f.preventDefault();const _=new FormData(a),E=_.get("username"),S=_.get("password");if(E===null||E?.toString().trim()===""){Gt("Username must not be empty","sign-in-message","error");return}(S===null||S.toString().trim()==="")&&Gt("PAssword must not be empty","sign-in-message","error"),localStorage.setItem("username",E?.toString()),o.style.display="none",gu(),eh("Sign In Successful","main-message","check_circle"),window.location.reload()}),document.getElementById("google-login-button").addEventListener("click",async()=>{const f=document.getElementById("google-message");f.textContent="Opening Google window...";try{await D_(),f.textContent="Google Sign-In successful!"}catch(_){let E="Sign-In failed.";_.code==="auth/popup-closed-by-user"?E="Sign-In window closed.":_.code==="auth/cancelled-popup-request"?E="Sign-In request already in progress.":E=`Error: ${_.message}`,f.textContent=E,console.error("Google sign-in error details:",_)}}),s.addEventListener("click",()=>{x_()}),u.addEventListener("click",f=>{f.preventDefault(),It("sign-in-backdrop")}),document.addEventListener("keydown",f=>{let _=document.getElementById("delete-item-backdrop"),E=document.getElementById("sign-in-backdrop"),S=document.getElementById("edit-event-backdrop"),P=document.getElementById("add-inventory-backdrop"),k=document.getElementById("distribute-inventory-backdrop"),L=document.getElementById("manage-inventory-backdrop");f.key==="Escape"&&(f.preventDefault(),_&&_.style.display==="flex"?It("delete-item-backdrop"):E&&E.style.display==="flex"?It("sign-in-backdrop"):S&&S.style.display==="flex"?It("edit-event-backdrop"):P&&P.style.display==="flex"?It("add-inventory-backdrop"):k&&k.style.display==="flex"?It("distribute-inventory-backdrop"):L&&L.style.display==="flex"?It("manage-inventory-backdrop"):console.log("No modals are open"))})}function _y(){return!!localStorage.getItem("username")}async function N_(){await Promise.all([fetch("https://raw.githubusercontent.com/ryan-montville/days-for-girls-solon/refs/heads/main/src/inventory.json").then(n=>n.json()).then(n=>{Tn("currentInventory",n.currentInventory),Tn("donatedInventory",n.donatedInventory),Tn("distributedInventory",n.distributedInventory)}).catch(n=>{Gt("Error loading inventory data. Please try reloading the page","main-message","error"),console.error(`Error loading inventory data: ${n}`)}),fetch("https://raw.githubusercontent.com/ryan-montville/days-for-girls-solon/refs/heads/main/src/events.json").then(n=>n.json()).then(n=>{Tn("events",n.upcomingEvents),Tn("SignUpEntries",n.SignUpEntries)}).catch(n=>{Gt("Error loading events data. Please try reloading the page","main-message","error"),console.error(`Error loading events data: ${n}`)})])}async function V_(n,e){const t=document.getElementById("header-placeholder");try{const r=await fetch(Gi+"header.html");if(!r.ok)throw console.error(`${r.status}: ${r.statusText}`),new Error("Error fetching header");const s=await r.text();let o=document.createElement("header");o.innerHTML=s,mu.replaceChild(o,t),document.querySelector("nav").querySelectorAll("a").forEach(h=>{h.textContent===n&&h.setAttribute("aria-current","page")})}catch(r){console.error(`Failed to load the header: ${r}`)}}async function O_(){const n=document.getElementById("footer-placeholder");try{const e=await fetch(Gi+"footer.html");if(!e.ok)throw console.error(`${e.status}: ${e.statusText}`),new Error("Error fetching footer");const t=await e.text(),r=document.createElement("footer");r.innerHTML=t,mu.replaceChild(r,n)}catch(e){console.error(`Failed to load the footer: ${e}`)}}async function L_(){const n=document.querySelector("body"),e=document.getElementById("modal-placeholder");try{const t=await fetch(Gi+"modal.html");if(!t.ok)throw console.error(`${t.status}: ${t.statusText}`),new Error("Error fetching modals");const r=await t.text(),s=document.createElement("div");s.innerHTML=r,n.replaceChild(s,e)}catch(t){console.error(`Failed to load the modals: ${t}`)}}async function M_(){localStorage.getItem("currentInventory")||await N_()}function gu(){const n=document.getElementById("inventory-link"),e=document.getElementById("open-sign-in-modal-button"),t=document.getElementById("sign-out-button");n.style.display="block",e.style.display="none",t.style.display="block"}function x_(){const n=document.getElementById("inventory-link"),e=document.getElementById("sign-out-button");localStorage.removeItem("username"),n.style.display="none",e.style.display="none",window.location.reload()}function U_(){const n=document.getElementById("inventory-link");localStorage.getItem("username")?gu():n.style.display="none"}export{Yu as A,Z_ as B,X_ as C,B_ as D,W_ as E,z_ as F,F_ as G,li as H,ry as I,ty as J,ny as K,$_ as L,H_ as M,j_ as N,G_ as O,J as T,py as a,ay as b,fy as c,my as d,Gt as e,It as f,q_ as g,J_ as h,gy as i,K_ as j,Ju as k,uy as l,cy as m,oy as n,ly as o,hy as p,Q_ as q,nh as r,eh as s,fc as t,_y as u,Rr as v,sy as w,iy as x,ey as y,Y_ as z};
