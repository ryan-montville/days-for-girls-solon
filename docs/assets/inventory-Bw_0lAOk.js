import{i as R,y as N,a as k,g as x,o as T,e as C,t as S,z as I,b as m,h as w,n as h,c as $,A as q,k as E,l as P,B as M,C as F}from"./app-CGZ0d0uY.js";const p=document.getElementById("generateForm"),H=document.getElementById("maincontent"),v=document.getElementById("current-inventory-card"),b=document.getElementById("manage-inventory-card"),D=document.getElementById("manage-inventory-backdrop"),g=document.getElementById("manage-inventory-modal");function B(r,t){const a=["componentType","quantity"],n="componentId";if(t==="admin"){const d=E(r,a,n,3,"componentItem"),e=d.querySelector("button");return e&&e.addEventListener("click",()=>{const o=P(r,"Are you sure you want to delete this component?");if(o){const i=o.children[0],l=o.children[1];l&&l.addEventListener("click",async()=>{C("delete-item-backdrop");try{await M(r.componentId),m(`Deleted component "${r.componentType}"`,"main-message","delete"),d.remove()}catch(s){m(s,"main-message","error")}}),i&&i.addEventListener("click",()=>{C("delete-item-backdrop")})}}),d}else return E(r,a,n,2,"componentItem")}async function A(r){let t=[];try{t=await I()}catch(n){m(n,"main-message","error");return}if(t.length===0){const n=document.createElement("p"),d=document.createTextNode("There are not items currently in the inventory.");n.appendChild(d),v.appendChild(n)}else{let n=[];r==="admin"?n=["Component","Quantity","Delete"]:n=["Component","Quantity"];const d=document.getElementById("inventory-table-container");d&&d.remove();const e=document.createElement("div");e.setAttribute("id","inventory-table-container"),e.setAttribute("class","table-container");const o=w("current-inventory-table",n),i=t.reduce((l,s)=>{const c=B(s,r);return l.appendChild(c),l},document.createElement("tbody"));i.setAttribute("id","currentInventoryTableBody"),o.appendChild(i),e.appendChild(o),v.appendChild(e)}const a=document.getElementById("loading");a&&a.remove(),v.classList.remove("hide")}async function V(r,t){let a=[];try{a=await F()}catch{m("Error generating report. Please try reloading the page","main-message","error");return}return a.filter(e=>e.entryDate.toDate()>=r&&e.entryDate.toDate()<=t).sort((e,o)=>e.entryDate.toDate().getTime()-o.entryDate.toDate().getTime())}async function z(r){let t=[];try{t=await I()}catch(n){m(n,"main-message","error");return}return t.reduce((n,d)=>{const e={componentType:d.componentType,quantityDonated:0,quantityDistributed:0};return r.filter(i=>i.componentType===e.componentType).forEach(i=>{i.whoDonated?e.quantityDonated+=i.quantity:e.quantityDistributed+=i.quantity}),n.push(e),n},[])}function G(r){const t=document.createElement("div");t.setAttribute("id","summary-table-container"),t.setAttribute("class","table-container");const a=w("summary-table",["Total Donated","Total Distributed"]),n=r.reduce((d,e)=>{let o=document.createElement("tr"),i=document.createElement("td"),l=document.createTextNode(`${e.componentType}: ${e.quantityDonated}`);i.appendChild(l),o.appendChild(i);let s=document.createElement("td"),c=document.createTextNode(`${e.componentType}: ${e.quantityDistributed}`);return s.appendChild(c),o.appendChild(s),d.appendChild(o),d},document.createElement("tbody"));return a.appendChild(n),t.appendChild(a),t}function Q(r){const t=document.createElement("div");t.setAttribute("id","entries-table-container"),t.setAttribute("class","table-container");const a=w("entries-table",["Date","Entry"]),n=r.reduce((d,e)=>{const o=document.createElement("tr"),i=document.createElement("td"),l=document.createTextNode(h(e.entryDate,"shortDate"));i.appendChild(l),o.appendChild(i);const s=document.createElement("td");if(e.whoDonated){const c=document.createTextNode(`${e.quantity} ${e.componentType} donated by ${e.whoDonated}`);s.appendChild(c)}else{const c=document.createTextNode(`${e.quantity} ${e.componentType} distributed to ${e.destination}`);s.appendChild(c)}return o.appendChild(s),d.appendChild(o),d},document.createElement("tbody"));return a.appendChild(n),t.appendChild(a),t}async function U(){m("Generating inventory report...","report-message","info");let r=new FormData(p),t=r.get("startDate"),a=r.get("endDate");if(t&&a){if(new Date(t.toString())>new Date(a.toString())){m("Please make sure the end date is a later date than the start date","report-message","error");return}}else if(!t&&!a){m("Please select start and end dates","report-message","error");return}else if(!t&&a){m("Please select a start date","report-message","error");return}else if(t&&!a){m("Please select an end date","report-message","error");return}if(p.style.display="none",t&&a){let n=new Date(t.toString()),d=new Date(a.toString()),e=document.createElement("article");e.setAttribute("class","card");let o=await V(n,d);if(o){if(o.length===0){let s=document.createElement("h2"),c=document.createTextNode("No results");s.appendChild(c),e.appendChild(s);let u=document.createElement("p"),y=document.createTextNode(`No items where donated or distributed ${h(t.toString(),"shortDate")} to ${h(a.toString(),"shortDate")}`);u.appendChild(y),e.appendChild(u)}else{let s=document.createElement("h2"),c=document.createTextNode(`${h(t.toString(),"shortDate")} to ${h(a.toString(),"shortDate")} Report`);s.appendChild(c),e.appendChild(s);let u=await z(o);if(u){const y=G(u);e.appendChild(y);const f=Q(o);e.appendChild(f)}else return}const i=document.createElement("div");i.setAttribute("class","form-row");const l=T("Generate New Report","button","newReport","primary fulll");l.addEventListener("click",()=>{e.remove(),p.style.display="block"}),i.appendChild(l),e.appendChild(i),$(),H.appendChild(e),e.scrollIntoView({behavior:"smooth"})}}else return}async function K(r){const t={componentId:"",componentType:"",quantity:0},a=r.get("nameInput");if(a===null||a.toString().trim()===""){m("Please enter the name of the new component type","manage-inventory-message","error");return}else{t.componentType=a.toString().trim();try{const n=await q(t);if(C("manage-inventory-backdrop"),n){t.componentId=n,m(`Added '${t.componentType}' to inventory`,"main-message","check_circle"),t.componentId=n;const d=document.getElementById("currentInventoryTableBody");if(d){const e=B(t,"admin");d.appendChild(e)}else A("admin")}else m("Failed to add new component. Please try again.","main-message","error")}catch(n){m(n,"main-message","error")}}}async function O(r){let t=null;if(r){if(t=await x(r.uid),t==="admin"){p.classList.contains("hide")&&p.classList.remove("hide");const a=document.getElementById("inventory-log-links");a.classList.contains("hide")&&a.classList.remove("hide"),b.classList.contains("hide")&&b.classList.remove("hide")}}else b.classList.contains("hide")||b.classList.add("hide"),p.classList.contains("hide")||p.classList.add("hide");A(t),t==="admin"&&(p.addEventListener("submit",n=>{n.preventDefault(),U()}),document.getElementById("add-new-type").addEventListener("click",()=>{g.innerHTML="";const n=document.createElement("form"),d=document.createElement("h2"),e=document.createTextNode("Add a New Component Type");d.appendChild(e),n.appendChild(d);const o=document.createElement("section");o.setAttribute("class","form-row");const i=document.createElement("label");i.setAttribute("for","nameInput");const l=document.createTextNode("Name of new component type:");i.appendChild(l),o.appendChild(i);const s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("id","nameInput"),s.setAttribute("name","nameInput"),o.appendChild(s),n.appendChild(o);const c=document.createElement("section");c.setAttribute("class","form-row");const u=T("Cancel","button","cancelButton","secondary");u.addEventListener("click",()=>{C("manage-inventory-backdrop")}),c.appendChild(u);const y=T("Submit","submt","submitButton","primary");c.appendChild(y),n.appendChild(c),n.addEventListener("submit",f=>{f.preventDefault();const L=new FormData(n);K(L)}),g.appendChild(n),D.style.display="flex",g.classList.add("opening"),g.setAttribute("aria-modal","true"),s.focus(),S(n,D)}))}R("Inventory","Inventory").then(async()=>{await N(),k.onAuthStateChanged(async r=>{await O(r)})});
