import{i as A,s as f,a as d,n as L,l as m,h as k,k as N,f as S,o as P,b as I,p as x}from"./app-CWWncusU.js";import{c as M,x as H,y as R,z as F,A as U}from"./indexedService-CyxUA599.js";import{n as y}from"./navigate-CzB6ZO3P.js";const g=document.getElementById("sign-up-entires-card"),D=document.getElementById("deleteEventCard"),$=document.getElementById("delete-button"),V=document.getElementById("edit-event-backdrop"),h=document.getElementById("edit-event-modal"),c=document.getElementById("event-info"),z=new URLSearchParams(window.location.search),b=z.get("id"),p=b||"";let s=null;function T(e){c.innerHTML="";const t=document.createElement("h2"),r=document.createTextNode(e.eventTitle);t.appendChild(r),c.appendChild(t);const o=document.createElement("h3"),n=document.createTextNode(`${k(e.eventDate,"longDate")} ${e.eventTime}`);o.appendChild(n),c.appendChild(o);const a=document.createElement("h3"),i=document.createTextNode(e.eventLocation);a.appendChild(i),c.appendChild(a);const l=document.createElement("h3"),u=document.createTextNode(`Number Attending: ${e.numberAttending}`);l.appendChild(u),c.appendChild(l);const v=document.createElement("p"),w=document.createTextNode(e.eventDescription);v.appendChild(w),c.appendChild(v);const E=document.createElement("section");E.setAttribute("class","button-row left");const C=S("Edit Event Info","button","editButton","primary","edit_calendar");C.addEventListener("click",()=>{P(V,h,"eventTitle")}),E.appendChild(C),c.appendChild(E)}function B(e){let t=document.getElementById("eventTitle");t.value=e.eventTitle;let r=document.getElementById("eventDate"),o=e.eventDate;r.value=o.toISOString().split("T")[0];let n=document.getElementById("eventLocation");n.value=e.eventLocation;let a=document.getElementById("eventTime");a.value=e.eventTime;let i=document.getElementById("eventDescription");i.value=e.eventDescription}async function q(){if(d("Updating event data...","edit-event-modal-message","info"),!s){m("edit-event-backdrop"),d("Cannot update event. Please try reloading the page.","main-message","error");return}let e=new FormData(h),t={eventId:parseInt(p),eventTitle:"",eventDate:new Date(0),eventLocation:"",eventTime:"",eventDescription:"",numberAttending:0},r=e.get("eventTitle");if(r===null||r.toString().trim()===""){d("Please enter the title of the event","edit-event-modal-message","error");return}else t.eventTitle=I(r.toString());const o=e.get("eventDate");if(o===null||o===""){d("Please enter the date of the event","edit-event-modal-message","error");return}else t.eventDate=new Date(o.toString());let n=e.get("eventLocation");if(n===null||n.toString().trim()===""){d("Please enter the location of the event","edit-event-modal-message","error");return}else t.eventLocation=I(n.toString());let a=e.get("eventTime");if(a===null||a.toString().trim()===""){d("Please enter the time of the event","edit-event-modal-message","error");return}else t.eventTime=a.toString();let i=e.get("eventDescription");if(i===null||i.toString().trim()===""){d("Please enter a description for the event","edit-event-modal-message","error");return}else t.eventDescription=i.toString();try{await F(parseInt(p),t),m("edit-event-backdrop"),s=t,T(t),d("The event was successfully updated","main-message","check_circle")}catch(l){d(l,"edit-event-modal-message","error")}}function K(e,t){const n=x(e,["fullName","email","comments"],"entryId",4),a=n.querySelector("button");return a&&a.addEventListener("click",()=>{const i=L(e,"Are you sure you want to delete this entry?");if(i){const l=i.children[0],u=i.children[1];u&&u.addEventListener("click",async()=>{m("delete-item-backdrop");try{await U(e.entryId),d(`Deleted entry from ${e.fullName}`,"main-message","delete"),n.remove(),t.numberAttending-=1,T(t)}catch(v){d(v,"main-message","error")}}),l&&l.addEventListener("click",()=>{m("delete-item-backdrop")})}}),n}function _(e,t){if(t.length===0){let r=document.createElement("p"),o=document.createTextNode(`No one has signed up for ${e.eventTitle} yet`);r.appendChild(o),g.appendChild(r)}else{const r=document.getElementById("table-container");r&&r.remove();const o=document.createElement("div");o.setAttribute("id","entries-table-container"),o.setAttribute("class","table-container");const a=N("sign-up-table",["Name","Email","Comments","Delete"]);let i=t.reduce((l,u)=>{const v=K(u,e);return l.appendChild(v),l},document.createElement("tbody"));a.appendChild(i),o.appendChild(a),g.appendChild(o)}}async function G(){if(p===""){f("Error loading event. Please try again.","main-message","error"),y("/events");return}try{s=await M(parseInt(p))}catch(e){f(e,"main-message","error"),y("/events");return}if(s===null){d("Could not find event","main-message","error"),h.remove(),g.remove(),D.remove();let e=document.createElement("section");e.setAttribute("class","card");let t=document.createElement("h2"),r=document.createTextNode("Could not find event");t.appendChild(r),e.appendChild(t);let o=document.createElement("p"),n=document.createTextNode("The event you were looking for does not exist or the url is incorrect. Please go back to the events page and try again.");o.appendChild(n),e.appendChild(o);let a=document.querySelector("main");a&&a.appendChild(e)}else{B(s);const e=await H(parseInt(p));_(s,e),T(s);const t=document.getElementById("loading");t&&t.remove(),c.classList.remove("hide"),g.classList.remove("hide"),D.classList.remove("hide"),$.addEventListener("click",()=>{const n=L(s,"Are you sure you want to delete this event?");if(n){const a=n.children[0],i=n.children[1];i&&i.addEventListener("click",async()=>{m("delete-item-backdrop");try{await R(parseInt(p)),f(`Deleted event ${s.eventTitle} ${k(s.eventDate,"shortDate")}`,"main-message","delete"),y("/events")}catch(l){d(l,"main-message","error")}}),a&&a.addEventListener("click",()=>{m("delete-item-backdrop")})}}),document.getElementById("reset").addEventListener("click",n=>{n.preventDefault(),B(s)}),document.getElementById("cancel").addEventListener("click",()=>{m("edit-event-backdrop")}),h.addEventListener("submit",n=>{n.preventDefault(),q()})}}A("Upcoming Events","Manage Event").then(()=>{G()});
