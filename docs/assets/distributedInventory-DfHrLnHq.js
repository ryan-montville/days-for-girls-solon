import{i as h,e as u,p as f,t as v,f as D,b as a,h as B,T as y,j as E,k as T,l as I,m as w,n as k}from"./app-BBWCMP6O.js";const l=document.getElementById("distribute-inventory-modal"),p=document.getElementById("distribute-inventory-backdrop"),c=document.getElementById("previous-entries-card");function b(e){const o=T(e,["entryDate","componentType","quantity","destination"],"entryId",5,"shortDate"),i=o.querySelector("button");return i&&i.addEventListener("click",()=>{const r=I(e,"Are you sure you want to delete this entry?");if(r){const t=r.children[0],d=r.children[1];d&&d.addEventListener("click",async()=>{u("delete-item-backdrop");try{await w(e.entryId),a(`Deleted entry ${k(e.entryDate.toString(),"shortDate")}: ${e.quantity} ${e.componentType} to ${e.destination}`,"main-message","delete"),o.remove()}catch(m){a(m,"main-message","error")}}),t&&t.addEventListener("click",()=>{u("delete-item-backdrop")})}}),o}async function g(){let e=[];try{e=await D("distributed")}catch{a("Error loading log entries. Please try reloading the page","main-message","error")}if(e.length===0){let o=document.createElement("p"),i=document.createTextNode("No previous entries");o.appendChild(i),c.appendChild(o)}else{const i=B("previous-entries-table",["Date","Component","Quantity","Destination","Delete"]);let r=e.reduceRight((t,d)=>{const m=b(d);return t.appendChild(m),t},document.createElement("tbody"));r.setAttribute("id","distributedTableBody"),i.appendChild(r),c.appendChild(i)}const n=document.getElementById("newDistributedEntryButton"),s=document.getElementById("loading");s&&s.remove(),n.classList.contains("hide")&&n.classList.remove("hide"),c.classList.contains("hide")&&c.classList.remove("hide")}async function L(){a("Submitting entry log data...","distribute-modal-message","info");const e=new FormData(l);let n={entryId:"",entryDate:y.fromDate(new Date(0)),componentType:"",quantity:0,destination:""};const s=e.get("date");if(s===null||s===""){a("Please enter the date the components are leaving","distribute-modal-message","error");return}else{const t=new Date(s.toString());n.entryDate=y.fromDate(t)}const o=e.get("componentType");if(o===null||o.toString().trim()===""){a("Please select what component you are distributing","distribute-modal-message","error");return}else n.componentType=o.toString();const i=e.get("quantity");if(i===null){a("Please enter the quantity of the components being distributed","distribute-modal-message","error");return}else{const t=+i;if(t<1){a("Please enter a quantity greater that 0","distribute-modal-message","error");return}else n.quantity=t}const r=e.get("destination");if(r===null||r.toString().trim()===""){a("Please enter the destination","distribute-modal-message","error");return}else n.destination=r.toString();try{await E(n),u("distribute-inventory-backdrop"),a("The inventory has successfully been updated","main-message","check_circle"),l.reset();const t=document.getElementById("distributedTableBody");if(t){const d=b(n);t.prepend(d)}else g()}catch(t){a(t,"distribute-modal-message","error")}}h("Inventory").then(async()=>{await g(),l.addEventListener("submit",n=>{n.preventDefault(),L(),document.getElementById("cancel").addEventListener("click",()=>u("distribute-inventory-backdrop"))}),document.getElementById("newDistributedEntryButton").addEventListener("click",()=>{console.log("button clicked"),f("componentType"),p.style.display="flex",l.setAttribute("aria-modal","true"),document.getElementById("date").focus(),v(l,p)})});
