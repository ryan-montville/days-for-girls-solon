import{i as P,s as E,r as S,a as d,C as N,j as b,D as A,d as v,l as L,e as x,n as F,t as H,T as D,E as M,h as R,F as U}from"./app-p2LSsebp.js";const h=document.getElementById("sign-up-entires-card"),C=document.getElementById("deleteEventCard"),$=document.getElementById("delete-button"),I=document.getElementById("edit-event-backdrop"),p=document.getElementById("edit-event-modal"),c=document.getElementById("event-info"),V=new URLSearchParams(window.location.search),B=V.get("id"),u=B||"";let s=null;function y(e){c.innerHTML="";const t=document.createElement("h2"),r=document.createTextNode(e.eventTitle);t.appendChild(r),c.appendChild(t);const a=document.createElement("h3"),n=document.createTextNode(`${L(e.eventDate,"longDate")} ${e.eventTime}`);a.appendChild(n),c.appendChild(a);const o=document.createElement("h3"),i=document.createTextNode(e.eventLocation);o.appendChild(i),c.appendChild(o);const l=document.createElement("h3"),m=document.createTextNode(`Number Attending: ${e.numberAttending}`);l.appendChild(m),c.appendChild(l);const g=document.createElement("p"),k=document.createTextNode(e.eventDescription);g.appendChild(k),c.appendChild(g);const f=document.createElement("section");f.setAttribute("class","form-row");const T=F("Edit Event Info","button","editButton","primary","edit_calendar");T.addEventListener("click",()=>{I.style.display="flex",p.setAttribute("aria-modal","true"),document.getElementById("eventTitle").focus(),H(p,I)}),f.appendChild(T),c.appendChild(f)}function w(e){let t=document.getElementById("eventTitle");t.value=e.eventTitle;let r=document.getElementById("eventDate"),a=e.eventDate.toDate();r.value=a.toISOString().split("T")[0];let n=document.getElementById("eventLocation");n.value=e.eventLocation;let o=document.getElementById("eventTime");o.value=e.eventTime;let i=document.getElementById("eventDescription");i.value=e.eventDescription}async function q(){if(!s){d("Cannot update event. Please try reloading the page.","main-message","error");return}let e=new FormData(p),t={eventId:u,eventTitle:"",eventDate:D.fromDate(new Date(0)),eventLocation:"",eventTime:"",eventDescription:"",numberAttending:0},r=e.get("eventTitle");if(r===null||r.toString().trim()===""){d("Please enter the title of the event","edit-event-modal-message","error");return}else t.eventTitle=r.toString();const a=e.get("eventDate");if(a===null||a===""){d("Please enter the date of the event","edit-event-modal-message","error");return}else{const m=new Date(a.toString());t.eventDate=D.fromDate(m)}let n=e.get("eventLocation");if(n===null||n.toString().trim()===""){d("Please enter the location of the event","edit-event-modal-message","error");return}else t.eventLocation=n.toString();let o=e.get("eventTime");if(o===null||o.toString().trim()===""){d("Please enter the time of the event","edit-event-modal-message","error");return}else t.eventTime=o.toString();let i=e.get("eventDescription");if(i===null||i.toString().trim()===""){d("Please enter a description for the event","edit-event-modal-message","error");return}else t.eventDescription=i.toString();const l=await M(u,t);v("edit-event-backdrop"),l?(s=t,y(t),d("The event was successfully updated","main-message","check_circle")):d("Unable to update the event. Please reload the page and try again.","main-message","error")}function K(e,t){const n=R(e,["fullName","email","comments"],"entryId"),o=n.querySelector("button");return o&&o.addEventListener("click",()=>{const i=b(e,"Are you sure you want to delete this entry?");if(i){const l=i.children[0],m=i.children[1];m&&m.addEventListener("click",async()=>{const g=await U(e.entryId);v("delete-item-backdrop"),g?(d(`Deleted entry from ${e.fullName}`,"main-message","delete"),n.remove(),t.numberAttending-=1,y(t)):d("Error deleting entry. Please reload the page and try again","main-message","error")}),l&&l.addEventListener("click",()=>{v("delete-item-backdrop")})}}),n}function _(e,t){if(t.length===0){let r=document.createElement("p"),a=document.createTextNode(`No one has signed up for ${e.eventTitle} yet`);r.appendChild(a),h.appendChild(r)}else{const a=x("sign-up-table",["Name","Email","Comments","Delete"]);let n=t.reduce((o,i)=>{const l=K(i,e);return o.appendChild(l),o},document.createElement("tbody"));a.appendChild(n),h.appendChild(a)}}async function z(){if(u===""){E("Error loading event. Please try again.","main-message","error"),window.location.href="events.html";return}try{s=await S(u)}catch{E("Error loading event. Please try again.","main-message","error"),window.location.href="events.html";return}if(s===null){d("Could not find event","main-message","error"),p.remove(),h.remove(),C.remove();let e=document.createElement("section");e.setAttribute("class","card");let t=document.createElement("h2"),r=document.createTextNode("Could not find event");t.appendChild(r),e.appendChild(t);let a=document.createElement("p"),n=document.createTextNode("The event you were looking for does not exist or the url is incorrect. Please go back to the events page and try again.");a.appendChild(n),e.appendChild(a);let o=document.querySelector("main");o&&o.appendChild(e)}else{w(s);const e=await N(u);_(s,e),y(s);const t=document.getElementById("loading");t&&t.remove(),c.classList.remove("hide"),h.classList.remove("hide"),C.classList.remove("hide"),$.addEventListener("click",()=>{const n=b(s,"Are you sure you want to delete this event?");if(n){const o=n.children[0],i=n.children[1];i&&i.addEventListener("click",async()=>{const l=await A(u);v("delete-item-backdrop"),l?(E(`Deleted event ${s.eventTitle} ${L(s.eventDate,"shortDate")}`,"main-message","delete"),window.location.href="events.html"):d("Unable to delete event. Please reload the page and try agian.","main-message","error")}),o&&o.addEventListener("click",()=>{v("delete-item-backdrop")})}}),document.getElementById("reset").addEventListener("click",n=>{n.preventDefault(),w(s)}),document.getElementById("cancel").addEventListener("click",()=>{v("edit-event-backdrop")}),p.addEventListener("submit",n=>{n.preventDefault(),q()})}}P("Upcoming Events").then(()=>{z()});
